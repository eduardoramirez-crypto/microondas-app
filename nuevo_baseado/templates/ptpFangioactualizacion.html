<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fangio Telecom - Gestor de Enlaces PtP con Análisis de Factibilidad</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <!-- Favicon files not found - commented out to prevent errors -->
  <!-- <link rel="icon" type="image/png" href="img/favicon-32x32-light.png" sizes="32x32"> -->
  <!-- <link rel="icon" type="image/png" href="img/favicon-32x32-light.png" sizes="32x32" media="(prefers-color-scheme: light)"> -->
  <!-- <link rel="icon" type="image/png" href="img/favicon-32x32-dark.png" sizes="32x32" media="(prefers-color-scheme: dark)"> -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="../estilos_mejorados.css">
  
  <!-- ===== FUNCIONES GLOBALES NECESARIAS ===== -->
  
  <style>
  /* ===== VARIABLES CSS MODERNAS ===== */
  :root {
    --primary: #2563eb;
    --primary-dark: #1d4ed8;
    --primary-light: #3b82f6;
    --secondary: #7c3aed;
    --secondary-dark: #6d28d9;
    --accent: #06b6d4;
    --accent-dark: #0891b2;
    --success: #10b981;
    --success-dark: #059669;
    --warning: #f59e0b;
    --warning-dark: #d97706;
    --danger: #ef4444;
    --danger-dark: #dc2626;
    --dark: #0f172a;
    --dark-light: #1e293b;
    --dark-lighter: #334155;
    --gray: #64748b;
    --gray-light: #94a3b8;
    --gray-lighter: #cbd5e1;
    --white: #ffffff;
    --glass: rgba(255, 255, 255, 0.1);
    --glass-dark: rgba(0, 0, 0, 0.2);
    --radius: 12px;
    --radius-lg: 16px;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    --gradient-primary: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    --gradient-secondary: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
    --gradient-accent: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
    --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    --gradient-dark: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  }

  /* ===== RESET Y BASE ===== */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body, html {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 30%, #334155 70%, #475569 100%);
    color: var(--white);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ===== ANIMACIONES GLOBALES ===== */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  /* ===== COMPONENTES BASE ===== */
  .tab-content {
  display: none;
    animation: fadeInUp 0.6s ease-out;
}
  
.tab-content.active {
  display: block;
}
* {
  box-sizing: border-box;
  font-family: 'Inter', sans-serif;
}
body, html {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(135deg, #081421 0%, #122434 100%);
  color: var(--text-light);
}
  /* ===== LAYOUT PRINCIPAL ===== */
.container {
    max-width: 1400px;
  margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 1;
  }

  /* ===== HEADER MODERNO ===== */
  .banner-hero {
    position: relative;
    width: 100%;
    min-height: 280px;
    max-height: 380px;
    height: 320px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: 24px;
    margin-bottom: 40px;
    background: linear-gradient(135deg, var(--dark) 0%, var(--dark-light) 100%);
    box-shadow: var(--shadow-lg);
    position: relative;
  }

  .banner-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
      rgba(37, 99, 235, 0.1) 0%, 
      rgba(124, 58, 237, 0.1) 50%, 
      rgba(6, 182, 212, 0.1) 100%);
    z-index: 1;
  }

  .banner-hero video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.7) contrast(1.1);
    opacity: 0.8;
    z-index: 0;
    border-radius: 24px;
  }

  .banner-hero-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    background: linear-gradient(135deg, 
      rgba(15, 23, 42, 0.8) 0%, 
      rgba(30, 41, 59, 0.6) 100%);
    border-radius: 24px;
  }

  .banner-hero-content {
    display: flex;
    align-items: center;
    gap: 40px;
    z-index: 3;
    background: rgba(15, 23, 42, 0.9);
    border-radius: 20px;
    padding: 40px 50px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    animation: fadeInUp 1s ease-out;
  }

  .logo-container-modern {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .banner-hero-logo {
    width: 100px;
    height: 100px;
    border-radius: 20px;
    background: var(--white);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
    padding: 15px;
    position: relative;
    z-index: 2;
    animation: float 3s ease-in-out infinite;
  }

  .logo-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 140px;
    height: 140px;
    background: radial-gradient(circle, rgba(37, 99, 235, 0.3) 0%, transparent 70%);
    border-radius: 50%;
    animation: pulse 3s ease-in-out infinite;
    z-index: 1;
  }

  .title-container-modern {
    text-align: left;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .banner-hero-title {
    font-size: 3.2rem;
    font-weight: 800;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0;
    letter-spacing: -0.02em;
    line-height: 1.1;
    animation: slideInLeft 1s ease-out 0.3s both;
  }

  .banner-hero-subtitle {
    font-size: 1.4rem;
    color: var(--gray-light);
    font-weight: 500;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideInLeft 1s ease-out 0.5s both;
  }

  .banner-hero-subtitle i {
    color: var(--accent);
    font-size: 1.2em;
  }

  .banner-hero-link {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    padding: 14px 28px;
    background: var(--gradient-primary);
    color: var(--white);
    text-decoration: none;
    border-radius: 50px;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
    animation: slideInLeft 1s ease-out 0.7s both;
    position: relative;
    overflow: hidden;
  }

  .banner-hero-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  .banner-hero-link:hover::before {
    left: 100%;
  }

  .banner-hero-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
  }

  .link-arrow {
    font-size: 18px;
    transition: transform 0.3s ease;
  }

  .banner-hero-link:hover .link-arrow {
    transform: translateX(5px);
}
.header {
  background: transparent;
  box-shadow: none;
  border: none;
  border-radius: 0;
  padding: 0;
  margin-bottom: 30px;
  display: flex;
  align-items: center;
  gap: 30px;
}
.logo-container .logo-wrapper {
  width: 110px;
  height: 110px;
}
.logo img {
  width: 100%;
  height: 100%;
  border-radius: 16px;
  background: transparent;
  box-shadow: 0 2px 12px rgba(0,188,212,0.10);
}
.company-info h1 {
  font-size: 2.8rem;
  font-weight: 700;
  color: var(--accent);
  text-shadow: 0 0 8px var(--accent);
  margin-bottom: 10px;
  background: none;
  -webkit-text-fill-color: unset;
}
.company-info .subtitle {
  font-size: 1.2rem;
  color: var(--primary);
  font-weight: 600;
  margin-top: 10px;
  padding-left: 0;
}
.premium-badge {
  display: none;
}
.main-content {
  background: rgba(11, 17, 31, 0.98);
  border-radius: 20px;
  box-shadow: 0 6px 32px 0 rgba(0,188,212,0.10);
  border: 2px solid var(--accent);
  padding: 32px 28px 18px 28px;
  margin-top: 24px;
  color: var(--text-light);
}
.tabs {
  display: flex;
  gap: 18px;
  margin-bottom: 32px;
  justify-content: center;
}
.tab-button {
  background: rgba(0,188,212,0.12);
  color: #e0f7fa;
  border: none;
  border-radius: 14px;
  padding: 16px 32px;
  font-size: 1.1rem;
  font-weight: 600;
  transition: background 0.2s, color 0.2s, box-shadow 0.2s;
  box-shadow: 0 2px 8px rgba(30,136,229,0.08);
}
.tab-button.active, .tab-button:hover {
  background: linear-gradient(135deg, #00bcd4 60%, #1e88e5 100%);
  color: #fff;
  box-shadow: 0 4px 16px rgba(30,136,229,0.18);
}
  /* ===== INFORMACIÓN DE FRECUENCIA MODERNA ===== */
  .frecuencia-info-modern {
    background: rgba(15, 23, 42, 0.9);
    border: 2px solid var(--accent);
    border-radius: 20px;
    margin-bottom: 32px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(6, 182, 212, 0.15);
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
  }

  .frecuencia-info-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .frecuencia-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
    color: var(--accent);
  }

  .frecuencia-header i {
    font-size: 24px;
    color: var(--accent);
  }

  .frecuencia-header h3 {
    font-size: 1.4rem;
    font-weight: 700;
    margin: 0;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .frecuencia-rules {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }

  .rule-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
  border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .rule-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
      rgba(6, 182, 212, 0.1), 
      rgba(37, 99, 235, 0.1));
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .rule-item:hover::before {
    opacity: 1;
  }

  .rule-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(6, 182, 212, 0.2);
    border-color: rgba(6, 182, 212, 0.5);
  }

  .rule-distance {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--white);
    text-align: center;
    z-index: 2;
    position: relative;
  }

  .rule-frequency {
    font-size: 1.3rem;
    font-weight: 800;
  color: var(--accent);
    text-align: center;
    z-index: 2;
    position: relative;
    text-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
  }

  .rule-icon {
    font-size: 2rem;
    color: var(--accent);
    z-index: 2;
    position: relative;
    transition: transform 0.3s ease;
  }

  .rule-item:hover .rule-icon {
    transform: scale(1.1);
}
.file-upload {
  background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
  border: 2px dashed rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 30px;
  margin-bottom: 30px;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}
.file-upload label {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 16px 32px;
  background: linear-gradient(135deg, #00bcd4, #1e88e5);
  color: #fff;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.3s ease;
  box-shadow: 0 8px 25px rgba(0,188,212,0.13);
}
.file-upload label:hover {
  background: linear-gradient(135deg, #1e88e5, #00bcd4);
}
.file-upload input[type="file"] {
  display: none;
}
.form-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 18px 32px;
  background: transparent;
  padding: 0;
  border-radius: 0;
  margin-top: 0;
  max-width: 1150px;
  width: 100%;
  box-shadow: none;
  border: none;
}
@media (max-width: 1200px) {
  .form-grid { grid-template-columns: repeat(2, 1fr); max-width: 900px; }
}
@media (max-width: 900px) {
  .main-content { padding: 16px 4px 10px 4px; max-width: 100vw; }
  .form-grid { grid-template-columns: 1fr; padding: 0; max-width: 100vw; }
}
.form-grid label {
  font-weight: 600;
  color: var(--accent);
  margin-bottom: 6px;
  display: block;
  letter-spacing: 0.5px;
}
.form-grid input, .form-grid select {
  width: 100%;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1.5px solid var(--primary);
  margin-top: 4px;
  font-size: 1rem;
  background: #1a2636;
  color: var(--text-light);
  outline: none;
  transition: background 0.2s, border 0.2s;
  box-shadow: 0 1px 4px 0 rgba(30,136,229,0.08);
}
.form-grid input:focus, .form-grid select:focus {
  background: #22304a;
  border-color: var(--accent);
}
.form-grid input[readonly] {
  background: #16202e;
  color: #b2ebf2;
  border-style: dashed;
}
.action-buttons .btn,
.btn {
  background: var(--accent);
  color: #000;
  font-weight: 700;
  padding: 14px 30px;
  border-radius: var(--radius);
  cursor: pointer;
  font-size: 1.1rem;
  border: none;
  margin: 6px 8px 6px 0;
  transition: background 0.3s, color 0.3s;
  box-shadow: 0 2px 12px rgba(0,188,212,0.10);
}
.btn:hover {
  background: var(--primary);
  color: #fff;
}
.table-container {
  background: rgba(11, 17, 31, 0.98);
  border-radius: 16px;
  box-shadow: 0 6px 32px 0 rgba(0,188,212,0.10);
  border: 2px solid var(--accent);
  padding: 12px;
  overflow-x: auto;
}
table {
  background: rgba(15, 23, 42, 0.95);
  color: var(--white);
  min-width: 1200px;
  width: 100%;
}
th, td {
  padding: 12px 14px;
  text-align: left;
  font-size: 14px;
  border-bottom: 1px solid rgba(0,188,212,0.10);
  background: rgba(15, 23, 42, 0.95);
  color: var(--white);
  white-space: nowrap;
  min-width: 120px;
}
th {
  background: rgba(0,188,212,0.15);
  color: var(--accent);
  font-weight: 700;
}
tr {
  background: rgba(15, 23, 42, 0.95);
  color: var(--white);
}
tr:hover {
  background: rgba(0,188,212,0.12);
  color: var(--white);
}
tr.selected {
  background: var(--accent) !important;
  color: #000 !important;
}
  /* ===== SCROLLBAR PERSONALIZADO ===== */
::-webkit-scrollbar {
    width: 12px;
    background: rgba(15, 23, 42, 0.8);
  border-radius: 8px;
}

::-webkit-scrollbar-thumb {
    background: var(--gradient-accent);
  border-radius: 8px;
    border: 2px solid rgba(15, 23, 42, 0.8);
    transition: all 0.3s ease;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--gradient-primary);
    box-shadow: 0 0 15px rgba(37, 99, 235, 0.5);
  }

  ::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
  }

  /* ===== EFECTOS ADICIONALES ===== */
  .glass-effect {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
  }

  .glow-effect {
    box-shadow: 0 0 30px rgba(6, 182, 212, 0.3);
  }

  .glow-effect:hover {
    box-shadow: 0 0 50px rgba(6, 182, 212, 0.5);
  }

  /* ===== LOADING STATES ===== */
  .loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    padding: 30px;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(255, 255, 255, 0.1);
    border-top: 4px solid var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* ===== TOOLTIPS ===== */
  [title] {
    position: relative;
    cursor: help;
  }

  [title]:hover::after {
    content: attr(title);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(15, 23, 42, 0.95);
    color: var(--white);
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 1000;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
  }

  /* ===== DASHBOARD INTERACTIVO ===== */
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin: 30px 0;
  }

  .metric-card {
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    cursor: pointer;
  }

  .metric-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
      rgba(37, 99, 235, 0.1), 
      rgba(6, 182, 212, 0.1));
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .metric-card:hover::before {
    opacity: 1;
  }

  .metric-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    border-color: rgba(37, 99, 235, 0.5);
  }

  .metric-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .metric-icon {
    width: 50px;
    height: 50px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: var(--white);
    position: relative;
    z-index: 2;
  }

  .metric-icon.primary { background: var(--gradient-primary); }
  .metric-icon.success { background: var(--gradient-accent); }
  .metric-icon.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .metric-icon.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }

  .metric-trend {
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 12px;
    font-weight: 600;
    position: relative;
    z-index: 2;
  }

  .metric-trend.positive {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.3);
  }

  .metric-trend.negative {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
  }

  .metric-value {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--white);
    margin-bottom: 10px;
    position: relative;
    z-index: 2;
  }

  .metric-label {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
    position: relative;
    z-index: 2;
  }

  .metric-chart {
    height: 60px;
    margin-top: 20px;
    position: relative;
    z-index: 2;
  }

  /* ===== MAPA AVANZADO ===== */
  .map-container-advanced {
    background: rgba(15, 23, 42, 0.9);
    border-radius: 20px;
    padding: 25px;
    margin: 30px 0;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
  }

  .map-container-advanced::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .map-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
    gap: 20px;
  }

  .map-title {
    display: flex;
    align-items: center;
    gap: 15px;
    color: var(--white);
    margin: 0;
  }

  .map-title i {
    font-size: 28px;
    color: var(--accent);
  }

  .map-title h3 {
    font-size: 1.5rem;
    font-weight: 700;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .map-controls {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }

  .map-control-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    color: var(--white);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .map-control-btn:hover {
    background: rgba(37, 99, 235, 0.2);
    border-color: rgba(37, 99, 235, 0.5);
    transform: translateY(-2px);
  }

  .map-control-btn.active {
    background: var(--gradient-primary);
    border-color: var(--primary);
    box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
  }

  .map-filters {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .map-filter-group {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .map-filter-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    font-weight: 600;
  }

  .map-filter-select {
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: var(--white);
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .map-filter-select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
  }

  .map-filter-select option {
    background: var(--dark);
    color: var(--white);
  }

  #mapa-enlaces {
    width: 100%;
    height: 500px;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 2;
  }

  .map-legend {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    font-size: 13px;
    color: var(--white);
    font-weight: 500;
  }

  .legend-color {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.3);
  }

  .legend-color.factible { background: var(--success); }
  .legend-color.no-factible { background: var(--danger); }
  .legend-color.indef { background: var(--warning); }

  /* ===== SISTEMA DE NOTIFICACIONES ===== */
  .notification-center {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-width: 400px;
  }

  .notification {
    background: rgba(15, 23, 42, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    backdrop-filter: blur(20px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    transform: translateX(100%);
    animation: slideInRight 0.5s ease-out forwards;
    position: relative;
    overflow: hidden;
  }

  .notification::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--gradient-accent);
  }

  .notification.success::before { background: var(--gradient-accent); }
  .notification.warning::before { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .notification.error::before { background: linear-gradient(135deg, #ef4444, #dc2626); }

  @keyframes slideInRight {
    to { transform: translateX(0); }
  }

  .notification-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .notification-title {
    font-weight: 600;
    color: var(--white);
    font-size: 14px;
  }

  .notification-close {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.6);
    cursor: pointer;
    font-size: 18px;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
  }

  .notification-close:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--white);
  }

  .notification-message {
    color: rgba(255, 255, 255, 0.8);
    font-size: 13px;
    line-height: 1.5;
  }

  /* ===== BÚSQUEDA Y FILTROS AVANZADOS ===== */
  .search-filters-container {
    background: rgba(15, 23, 42, 0.8);
    border-radius: 20px;
    padding: 25px;
    margin: 30px 0;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  }

  .search-bar {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
  }

  .search-input {
    flex: 1;
    min-width: 300px;
    padding: 15px 20px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    color: var(--white);
    font-size: 15px;
    transition: all 0.3s ease;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 25px rgba(6, 182, 212, 0.3);
    background: rgba(255, 255, 255, 0.15);
  }

  .search-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
  }

  .search-btn {
    padding: 15px 25px;
    background: var(--gradient-primary);
    border: none;
    border-radius: 12px;
    color: var(--white);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .search-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
  }

  .filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .filter-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 13px;
    font-weight: 600;
  }

  .filter-select {
    padding: 10px 15px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: var(--white);
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .filter-select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
  }

  .filter-select option {
    background: var(--dark);
    color: var(--white);
  }

  /* ===== GRÁFICOS Y ANALYTICS ===== */
  .analytics-container {
    background: rgba(15, 23, 42, 0.9);
    border-radius: 20px;
    padding: 25px;
    margin: 30px 0;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  }

  .analytics-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
    gap: 20px;
  }

  .analytics-title {
    display: flex;
    align-items: center;
    gap: 15px;
    color: var(--white);
    margin: 0;
  }

  .analytics-title i {
    font-size: 24px;
    color: var(--accent);
  }

  .analytics-title h3 {
    font-size: 1.4rem;
    font-weight: 700;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .chart-container {
    height: 300px;
    margin: 20px 0;
    position: relative;
  }

  /* ===== MODO OSCURO/CLARO ===== */
  body.modo-claro {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);    color: var(--white);
  }

  body.modo-claro .main-content,
  body.modo-claro .table-container,
  body.modo-claro .form-card,
  body.modo-claro .metric-card,
  body.modo-claro .map-container-advanced,
  body.modo-claro .search-filters-container,
  body.modo-claro .analytics-container {
    background: rgba(30, 41, 59, 0.95) !important;
color: var(--white) !important;
border-color: rgba(59, 130, 246, 0.3) !important;
  }

  body.modo-claro .input-modern {
    background: rgba(255, 255, 255, 0.1);
border-color: rgba(255, 255, 255, 0.2);
color: var(--white);
  }

  body.modo-claro .input-modern:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: var(--accent);
  }

  body.modo-claro .badge-factible { background: var(--success); }
  body.modo-claro .badge-nofactible { background: var(--danger); }
  body.modo-claro .badge-indef { background: var(--warning); }

  /* ===== ANIMACIONES AVANZADAS ===== */
  .fade-in-up {
    animation: fadeInUp 0.8s ease-out;
  }

  .slide-in-left {
    animation: slideInLeft 0.8s ease-out;
  }

  .bounce-in {
    animation: bounceIn 0.8s ease-out;
  }

  @keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
  }

  .pulse-glow {
    animation: pulseGlow 2s ease-in-out infinite alternate;
  }

  @keyframes pulseGlow {
    0% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); }
    100% { box-shadow: 0 0 40px rgba(6, 182, 212, 0.6); }
  }

  /* ===== INTERFAZ EMPRESARIAL PROFESIONAL ===== */
  
  /* ===== HEADER CORPORATIVO ===== */
  .corporate-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 70px;
    background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
    border-bottom: 3px solid var(--accent);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 30px;
    backdrop-filter: blur(20px);
  }

  .corporate-logo {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .corporate-logo-icon {
    width: 45px;
    height: 45px;
    background: var(--gradient-accent);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: var(--white);
    box-shadow: 0 4px 15px rgba(6, 182, 212, 0.4);
  }

  .corporate-logo-text {
    display: flex;
    flex-direction: column;
  }

  .corporate-logo-title {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--white);
    line-height: 1.2;
  }

  .corporate-logo-subtitle {
    font-size: 0.8rem;
    color: var(--gray-light);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .corporate-nav {
    display: flex;
    align-items: center;
    gap: 30px;
  }

  .corporate-nav-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    color: var(--gray-light);
    text-decoration: none;
    font-weight: 500;
    border-radius: 8px;
    transition: all 0.3s ease;
    position: relative;
  }

  .corporate-nav-item:hover {
    color: var(--danger);
    background: rgba(255, 255, 255, 0.1);
  }

  .corporate-nav-item.active {
    color: var(--accent);
    background: rgba(6, 182, 212, 0.1);
    border: 1px solid rgba(6, 182, 212, 0.3);
  }

  .corporate-nav-item .badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: var(--danger);
    color: var(--white);
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
    font-weight: 700;
  }

  .corporate-user-menu {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .user-profile {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 25px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .user-profile:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(6, 182, 212, 0.5);
  }

  .user-avatar {
    width: 32px;
    height: 32px;
    background: var(--gradient-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: var(--white);
    font-weight: 700;
  }

  .user-info {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .user-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--white);
    line-height: 1.2;
  }

  .user-role {
    font-size: 11px;
    color: var(--gray-light);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* ===== SIDEBAR EMPRESARIAL ===== */
  .corporate-sidebar {
    position: fixed;
    left: 0;
    top: 70px;
    width: 280px;
    height: calc(100vh - 70px);
    background: linear-gradient(180deg, #1a202c 0%, #2d3748 100%);
    border-right: 2px solid rgba(6, 182, 212, 0.3);
    overflow-y: auto;
    z-index: 999;
    transition: all 0.3s ease;
  }

  .sidebar-section {
    padding: 20px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .sidebar-section:last-child {
    border-bottom: none;
  }

  .sidebar-section-title {
    padding: 0 25px 15px 25px;
    font-size: 12px;
    font-weight: 700;
    color: var(--gray-light);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .sidebar-menu {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .sidebar-menu-item {
    margin: 0;
  }

  .sidebar-menu-link {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 25px;
    color: var(--gray-light);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
    border-left: 3px solid transparent;
  }

  .sidebar-menu-link:hover {
    color: var(--white);
    background: rgba(255, 255, 255, 0.05);
    border-left-color: rgba(6, 182, 212, 0.5);
  }

  .sidebar-menu-link.active {
    color: var(--accent);
    background: rgba(6, 182, 212, 0.1);
    border-left-color: var(--accent);
  }

  .sidebar-menu-link i {
    font-size: 18px;
    width: 20px;
    text-align: center;
  }

  .sidebar-menu-link .menu-badge {
    margin-left: auto;
    background: var(--gradient-secondary);
    color: var(--white);
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
    font-weight: 700;
  }

  .sidebar-menu-link .menu-arrow {
    margin-left: auto;
    font-size: 12px;
    transition: transform 0.3s ease;
  }

  .sidebar-menu-link:hover .menu-arrow {
    transform: rotate(90deg);
  }

  /* ===== CONTENIDO PRINCIPAL EMPRESARIAL ===== */
  .corporate-main-content {
    margin-left: 280px;
    margin-top: 70px;
    padding: 30px;
    min-height: calc(100vh - 70px);
    background: linear-gradient(135deg, #0f1419 0%, #1a202c 100%);
  }

  .corporate-page-header {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 30px;
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
  }

  .corporate-page-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .page-header-content {
    position: relative;
    z-index: 2;
  }

  .page-title {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--white);
    margin: 0 0 10px 0;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .page-subtitle {
    font-size: 1.1rem;
    color: var(--gray-light);
    margin: 0 0 25px 0;
    line-height: 1.6;
  }

  .page-actions {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }

  .corporate-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    position: relative;
    overflow: hidden;
  }

  .corporate-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  .corporate-btn:hover::before {
    left: 100%;
  }

  .corporate-btn.primary {
    background: var(--gradient-primary);
    color: var(--white);
    box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
  }

  .corporate-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
  }

  .corporate-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: var(--white);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .corporate-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(6, 182, 212, 0.5);
  }

  .corporate-btn.success {
    background: var(--gradient-accent);
    color: var(--white);
    box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
  }

  .corporate-btn.success:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
  }

  /* ===== DASHBOARD EJECUTIVO ===== */
  .executive-dashboard {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
  }

  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }

  .kpi-card {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    backdrop-filter: blur(20px);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .kpi-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .kpi-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    border-color: rgba(6, 182, 212, 0.3);
  }

  .kpi-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .kpi-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: var(--white);
  }

  .kpi-icon.primary { background: var(--gradient-primary); }
  .kpi-icon.success { background: var(--gradient-accent); }
  .kpi-icon.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .kpi-icon.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }

  .kpi-trend {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 12px;
  }

  .kpi-trend.positive {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
  }

  .kpi-trend.negative {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
  }

  .kpi-value {
    font-size: 2.2rem;
    font-weight: 800;
    color: var(--white);
    margin-bottom: 8px;
  }

  .kpi-label {
    font-size: 13px;
    color: var(--gray-light);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .kpi-chart {
    height: 50px;
    margin-top: 15px;
    background: linear-gradient(90deg, rgba(6, 182, 212, 0.2), rgba(37, 99, 235, 0.2));
    border-radius: 8px;
    position: relative;
    overflow: hidden;
  }

  .kpi-chart::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent 0%, rgba(6, 182, 212, 0.3) 50%, transparent 100%);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* ===== PANEL DE ACTIVIDAD ===== */
  .activity-panel {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    backdrop-filter: blur(20px);
    height: fit-content;
  }

  .activity-panel-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .activity-panel-header i {
    font-size: 20px;
    color: var(--accent);
  }

  .activity-panel-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--white);
    margin: 0;
  }

  .activity-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .activity-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 15px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: var(--white);
    flex-shrink: 0;
  }

  .activity-icon.create { background: var(--gradient-accent); }
  .activity-icon.update { background: var(--gradient-primary); }
  .activity-icon.delete { background: linear-gradient(135deg, #ef4444, #dc2626); }
  .activity-icon.export { background: linear-gradient(135deg, #f59e0b, #d97706); }

  .activity-content {
    flex: 1;
  }

  .activity-text {
    font-size: 13px;
    color: var(--white);
    margin: 0 0 5px 0;
    line-height: 1.4;
  }

  .activity-time {
    font-size: 11px;
    color: var(--gray-light);
    font-weight: 500;
  }

  /* ===== RESPONSIVE EMPRESARIAL ===== */
  @media (max-width: 1200px) {
    .corporate-sidebar {
      transform: translateX(-100%);
    }
    
    .corporate-main-content {
      margin-left: 0;
    }
    
    .executive-dashboard {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .corporate-header {
      padding: 0 20px;
    }
    
    .corporate-nav {
      display: none;
    }
    
    .corporate-main-content {
      padding: 20px;
    }
    
    .kpi-grid {
      grid-template-columns: 1fr;
    }
    
    .page-actions {
      flex-direction: column;
    }
  }

  /* ===== ELEMENTOS INTERACTIVOS EMPRESARIALES ===== */
  .interactive-element {
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .interactive-element:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  }

  /* ===== SISTEMA DE PROCESAMIENTO AVANZADO ===== */
  
  /* ===== OVERLAY DE PROCESAMIENTO ===== */
  .processing-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(20px);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.5s ease;
  }

  .processing-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .processing-container {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(6, 182, 212, 0.3);
    border-radius: 24px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    text-align: center;
    backdrop-filter: blur(20px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    position: relative;
    overflow: hidden;
  }

  .processing-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .processing-header {
    margin-bottom: 30px;
  }

  .processing-icon {
    width: 80px;
    height: 80px;
    background: var(--gradient-accent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    font-size: 36px;
    color: var(--white);
    animation: spin 2s linear infinite;
    box-shadow: 0 0 30px rgba(6, 182, 212, 0.5);
  }

  .processing-title {
    font-size: 2rem;
    font-weight: 800;
    color: var(--white);
    margin: 0 0 10px 0;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .processing-subtitle {
    font-size: 1.1rem;
    color: var(--gray-light);
    margin: 0;
  }

  /* ===== BARRA DE PROGRESO AVANZADA ===== */
  .progress-container {
    margin: 30px 0;
    position: relative;
  }

  .progress-bar {
    width: 100%;
    height: 12px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .progress-fill {
    height: 100%;
    background: var(--gradient-accent);
    border-radius: 6px;
    width: 0%;
    transition: width 0.5s ease;
    position: relative;
    overflow: hidden;
    overflow: hidden;
  }

  .progress-fill::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
  }

  .progress-text {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    color: var(--white);
    font-weight: 600;
  }

  .progress-percentage {
    font-size: 1.2rem;
    color: var(--accent);
  }

  .progress-count {
    font-size: 1rem;
    color: var(--gray-light);
  }

  /* ===== ESTADO DEL PROCESAMIENTO ===== */
  .processing-status {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 20px;
    margin: 25px 0;
    text-align: left;
  }

  .status-item {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .status-item:last-child {
    margin-bottom: 0;
  }

  .status-item.active {
    background: rgba(6, 182, 212, 0.1);
    border: 1px solid rgba(6, 182, 212, 0.3);
  }

  .status-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: var(--white);
    flex-shrink: 0;
  }

  .status-icon.pending { background: var(--gray); }
  .status-icon.processing { background: var(--accent); animation: pulse 1.5s infinite; }
  .status-icon.completed { background: var(--success); }
  .status-icon.error { background: var(--danger); }

  .status-text {
    flex: 1;
    color: var(--white);
    font-size: 14px;
    font-weight: 500;
  }

  .status-time {
    color: var(--gray-light);
    font-size: 12px;
    font-weight: 400;
  }

  /* ===== MODO TURBO MEJORADO ===== */
  .turbo-mode {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2));
    border: 2px solid rgba(245, 158, 11, 0.4);
    border-radius: 16px;
    padding: 20px;
    margin: 20px 0;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .turbo-mode::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(245, 158, 11, 0.1), transparent);
    animation: slideInLeft 2s ease-in-out infinite;
  }

  .turbo-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .turbo-icon {
    font-size: 24px;
    color: #f59e0b;
    animation: pulse 1s infinite;
  }

  .turbo-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #f59e0b;
    margin: 0;
  }

  .turbo-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 15px;
  }

  .turbo-feature {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--white);
    font-size: 13px;
    font-weight: 500;
  }

  .turbo-feature i {
    color: #f59e0b;
    font-size: 14px;
  }

  /* ===== RECURSOS DEL SISTEMA ===== */
  .system-resources {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin: 25px 0;
    flex-wrap: wrap;
  }

  .resource-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--white);
    font-size: 13px;
    font-weight: 500;
  }

  .resource-icon {
    color: var(--accent);
    font-size: 14px;
  }

  /* ===== BOTONES DE CONTROL ===== */
  .processing-controls {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 30px;
    flex-wrap: wrap;
  }

  .control-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .control-btn.primary {
    background: var(--gradient-primary);
    color: var(--white);
  }

  .control-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
  }

  .control-btn.danger {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: var(--white);
    color: var(--white);
  }

  .control-btn.danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
  }

  .control-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: var(--white);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .control-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(6, 182, 212, 0.5);
  }

  .corporate-btn.info {
    background: linear-gradient(135deg, #06b6d4, #0891b2);
    color: var(--white);
  }

  .corporate-btn.info:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
  }

  /* ===== ANIMACIONES DE PROCESAMIENTO ===== */
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  @keyframes slideInLeft {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* ===== ESTADOS DE ERROR Y ÉXITO ===== */
  .processing-success {
    border-color: var(--success);
    background: rgba(16, 185, 129, 0.1);
  }

  .processing-error {
    border-color: var(--danger);
    background: rgba(239, 68, 68, 0.1);
  }

  .processing-warning {
    border-color: var(--warning);
    background: rgba(245, 158, 11, 0.1);
  }

  /* ===== RESPONSIVE PARA PROCESAMIENTO ===== */
  @media (max-width: 768px) {
    .processing-container {
      padding: 30px 20px;
      margin: 20px;
    }
    
    .processing-title {
      font-size: 1.5rem;
    }
    
    .turbo-features {
      grid-template-columns: 1fr;
    }
    
    .system-resources {
      flex-direction: column;
      align-items: center;
    }
    
    .processing-controls {
      flex-direction: column;
      align-items: center;
    }
  }

  /* Indicadores de estado */
  .status-indicator {
    position: relative;
  }

  .status-indicator::after {
    content: '';
    position: absolute;
    top: -2px;
    right: -2px;
    width: 8px;
    height: 8px;
    background: var(--success);
    border-radius: 50%;
    border: 2px solid var(--white);
    animation: pulse 2s infinite;
  }

  /* Mejoras para formularios */
  .form-card:hover .form-card-header i {
    transform: scale(1.1) rotate(5deg);
    color: var(--accent);
  }

  /* Mejoras para tablas */
  .table-container-modern:hover {
    border-color: rgba(6, 182, 212, 0.3);
  }

  /* Mejoras para botones */
  .btn-modern:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.3);
  }

  /* Mejoras para inputs */
  .input-modern:focus {
    transform: translateY(-1px);
  }

  /* Efectos de carga */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(15, 23, 42, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    backdrop-filter: blur(10px);
  }

  .loading-spinner {
    width: 60px;
    height: 60px;
    border: 4px solid rgba(255, 255, 255, 0.1);
    border-top: 4px solid var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  /* Tooltips mejorados */
  .tooltip {
    position: relative;
    display: inline-block;
  }

  .tooltip .tooltiptext {
    visibility: hidden;
    width: 200px;
    background-color: rgba(15, 23, 42, 0.95);
    color: var(--white);
    text-align: center;
    border-radius: 8px;
    padding: 10px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  .tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
  }

  /* Scrollbar personalizado para Firefox */
  * {
    scrollbar-width: thin;
    scrollbar-color: var(--accent) rgba(15, 23, 42, 0.8);
  }

  /* Selección de texto personalizada */
  ::selection {
    background: rgba(6, 182, 212, 0.3);
    color: var(--white);
  }

  ::-moz-selection {
    background: rgba(6, 182, 212, 0.3);
    color: var(--white);
  }

  /* Mejoras para dispositivos táctiles */
  @media (hover: none) and (pointer: coarse) {
    .btn-modern:hover {
      transform: none;
    }
    
    .form-card:hover {
      transform: none;
    }
    
    .metric-card:hover {
      transform: none;
    }
  }

  /* Optimizaciones de rendimiento */
  .hardware-accelerated {
    transform: translateZ(0);
    will-change: transform;
  }

  /* Estados de carga para botones */
  .btn-loading {
    position: relative;
    color: transparent !important;
  }

  .btn-loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid transparent;
    border-top: 2px solid var(--white);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
@media (max-width: 768px) {
  .container { padding: 10px; }
  .main-content { padding: 10px; }
  .form-grid { gap: 12px 8px; }
  th, td { padding: 8px 6px; }
}
.fangio-header {
  display: flex;
  align-items: center;
  gap: 32px;
  background: linear-gradient(120deg, #0b111f 60%, #1e88e5 120%);
  border-radius: 24px;
  box-shadow: 0 6px 32px 0 rgba(0,188,212,0.10);
  padding: 24px 40px 24px 32px;
  margin-bottom: 36px;
  position: relative;
  overflow: hidden;
  min-height: 140px;
  justify-content: flex-start;
}
.fangio-logo-box {
  background: rgba(15, 23, 42, 0.9);
  border-radius: 18px;
  box-shadow: 0 2px 12px rgba(0,188,212,0.10);
  padding: 12px 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 110px;
  min-height: 110px;
}
.fangio-logo-img {
  width: 80px;
  height: 80px;
  object-fit: contain;
  display: block;
}
.fangio-title-box {
  display: flex;
  flex-direction: column;
  justify-content: center;
  z-index: 2;
}
.fangio-title {
  font-size: 2.8rem;
  font-weight: 800;
  color: #00e6ff;
  text-shadow: 0 0 18px #00e6ff55, 0 2px 8px #1e88e5cc;
  margin: 0 0 10px 0;
  letter-spacing: 2px;
}
.fangio-subtitle {
  font-size: 1.3rem;
  color: #2196f3;
  font-weight: 600;
  margin-top: 0;
  letter-spacing: 1px;
  text-shadow: 0 1px 8px #1e88e555;
}
.fangio-header-decoration {
  position: absolute;
  right: -80px;
  top: -60px;
  width: 320px;
  height: 320px;
  background: radial-gradient(circle at 60% 40%, #00bcd4 0%, #1e88e5 60%, transparent 100%);
  opacity: 0.18;
  z-index: 1;
  pointer-events: none;
}
@media (max-width: 900px) {
  .fangio-header {
    flex-direction: column;
    align-items: flex-start;
    padding: 18px 10px 18px 10px;
    min-height: 0;
    gap: 18px;
  }
  .fangio-header-decoration {
    width: 180px;
    height: 180px;
    right: -40px;
    top: -30px;
  }
  .fangio-logo-box {
    min-width: 70px;
    min-height: 70px;
    padding: 6px 8px;
  }
  .fangio-logo-img {
    width: 48px;
    height: 48px;
  }
  .fangio-title {
    font-size: 1.5rem;
  }
  .fangio-subtitle {
    font-size: 1rem;
  }
}
.btn-institucional {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(90deg, #00bcd4 60%, #1e88e5 100%);
  color: #fff;
  font-weight: 700;
  font-size: 1.08rem;
  padding: 12px 26px;
  border-radius: 14px;
  text-decoration: none;
  box-shadow: 0 2px 12px rgba(30,136,229,0.10);
  margin-left: auto;
  transition: background 0.2s, box-shadow 0.2s, color 0.2s;
  border: none;
  outline: none;
}
.btn-institucional:hover {
  background: linear-gradient(90deg, #1e88e5 60%, #00bcd4 100%);
  color: #fff;
  box-shadow: 0 4px 18px rgba(30,136,229,0.18);
  text-decoration: none;
}
@media (max-width: 700px) {
  .btn-institucional {
   display: none;
  }
}
.fangio-tower-bg {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 100%;
  width: 160px;
  pointer-events: none;
  z-index: 0;
  opacity: 0.18;
  display: flex;
  align-items: flex-end;
  justify-content: flex-start;
}
.fangio-tower-bg svg {
  height: 90%;
  width: auto;
  min-width: 80px;
  max-width: 120px;
  display: block;
}
@media (max-width: 900px) {
  .fangio-tower-bg {
    opacity: 0.10;
    width: 80px;
  }
  .fangio-tower-bg svg {
    min-width: 40px;
    max-width: 60px;
  }
}
#mapa-enlaces {
  margin-left: 340px; 
}
table, th, td {
  white-space: nowrap;
  vertical-align: middle;
}
tbody tr {
  height: 36px;
  min-height: 36px;
  max-height: 40px;
}
#panel-detalle-enlace {
  display: none;
  position: fixed;
  right: 0;
  top: 120px;
  width: 340px;
  max-width: 95vw;
  height: calc(100vh - 120px); 
  background: rgba(15, 23, 42, 0.95);
  color: #fff;
  border-radius: 18px 0 0 18px;
  box-shadow: 2px 0 18px #00bcd455;
  z-index: 2000;
  padding: 24px 18px 24px 18px;
  overflow-y: auto;
  font-size: 1rem;
}
#mapa-enlaces {
  margin-left: 0 !important;
  margin-right: 340px !important;
}
@media (max-width: 700px) {
  #panel-detalle-enlace {
    width: 98vw;
    border-radius: 0 0 18px 18px;
    height: auto;
    max-height: 80vh;
  }
  #mapa-enlaces {
    margin-left: 0 !important;
  }
}
#panel-detalle-enlace {
  z-index: 999999 !important;
  top: 0 !important;
  height: 100vh !important;
}
#detalle-enlace-contenido {
  padding-bottom: 40px;
}
#panel-detalle-enlace {
  top: 0 !important;
  height: 100vh !important;
  max-height: 100vh !important;
  overflow-y: auto !important;
}
.table-container {
  max-width: 100vw;
  overflow-x: auto;
  margin-bottom: 24px;
}
#tab-mismoTransporte .table-container {
  max-height: 60vh;
  overflow-y: auto;
}
#tab-mismoTransporte {
  overflow: visible !important;
}
#tab-mismoTransporte table {
  font-size: 13px;
  border-radius: 12px;
  background: #101a2a;
}
#tab-mismoTransporte th, #tab-mismoTransporte td {
  padding: 7px 10px;
  border-bottom: 1px solid #1e88e533;
  white-space: nowrap;
}
#tab-mismoTransporte th {
  background: #0b111f;
  color: #00e6ff;
  position: sticky;
  top: 0;
  z-index: 2;
}
#tab-mismoTransporte tr:hover {
  background: #1e88e522;
}
#tab-mismoTransporte .table-container {
  max-width: 100vw;
  overflow-x: auto;
  background: #101a2a;
  border-radius: 14px;
  border: 1.5px solid #00e6ff44;
  box-shadow: 0 2px 18px #00e6ff22;
  margin-bottom: 18px;
  padding: 0;
}
#tab-mismoTransporte table {
  font-size: 13px;
  border-radius: 12px;
  background: #101a2a;
  min-width: 1200px;
}
#tab-mismoTransporte th, #tab-mismoTransporte td {
  padding: 7px 10px;
  border-bottom: 1px solid #1e88e533;
  white-space: nowrap;
  text-align: center;
}
#tab-mismoTransporte th {
  background: #0b111f;
  color: #00e6ff;
  position: sticky;
  top: 0;
  z-index: 2;
  font-size: 13px;
  letter-spacing: 0.5px;
}
#tab-mismoTransporte tr:hover {
  background: #1e88e522;
}
#tab-mismoTransporte td:last-child {
  min-width: 120px;
  max-width: 140px;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
}
#tab-mismoTransporte button.btn-info {
  padding: 4px 10px;
  font-size: 12px;
  border-radius: 8px;
}
#tab-mismoTransporte .action-buttons {
  display: flex;
  gap: 12px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
#tab-mismoTransporte .enlaces-counter {
  margin-bottom: 8px;
  font-size: 1.08rem;
  color: #00e6ff;
  font-weight: 600;
}
#tab-mismoTransporte table {
  font-size: 13px;
  border-radius: 12px;
  background: #101a2a;
}
#tab-mismoTransporte th, #tab-mismoTransporte td {
  padding: 7px 10px;
  border-bottom: 1px solid #1e88e533;
  white-space: nowrap;
}
#tab-mismoTransporte th {
  background: #0b111f;
  color: #00e6ff;
  position: sticky;
  top: 0;
  z-index: 2;
}
#tab-mismoTransporte tr:hover {
  background: #1e88e522;
}
.fangio-video-wrapper {
  position: relative;
  width: 100%;
  max-width: 600px;
  aspect-ratio: 16/9;
  margin: 32px auto 0 auto;
  border-radius: 22px;
  overflow: hidden;
  box-shadow: 0 0 32px #00e6ff66, 0 2px 18px #00e6ff33;
  background: linear-gradient(135deg, #0b111f 60%, #1e88e5 100%);
  display: flex;
  align-items: center;
  justify-content: center;
}
.fangio-video-glow {
  position: absolute;
  inset: 0;
  border-radius: 22px;
  pointer-events: none;
  z-index: 1;
  box-shadow: 0 0 60px 10px #00e6ff88, 0 0 0 8px #00e6ff33 inset;
  animation: fangio-glow 2.5s infinite alternate;
}
@keyframes fangio-glow {
  0% { box-shadow: 0 0 60px 10px #00e6ff88, 0 0 0 8px #00e6ff33 inset; }
  100% { box-shadow: 0 0 90px 18px #00e6ffcc, 0 0 0 12px #00e6ff44 inset; }
}
.fangio-video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 22px;
  z-index: 2;
  background: #000;
  display: block;
}
@media (max-width: 700px) {
  .fangio-video-wrapper {
    max-width: 98vw;
    border-radius: 12px;
  }
  .fangio-video-glow {
    border-radius: 12px;
  }
  .fangio-video {
    border-radius: 12px;
  }
}
.video-hero-bg {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  max-width: 700px;
  margin: 40px auto 32px auto;
  background: linear-gradient(135deg, #101a2a 60%, #1e88e5 100%);
  border-radius: 24px;
  box-shadow: 0 8px 40px #00e6ff22, 0 2px 18px #00e6ff11;
  padding: 0;
  overflow: hidden;
}
.video-hero {
  width: 100%;
  aspect-ratio: 16/9;
  border-radius: 24px;
  object-fit: cover;
  display: block;
  box-shadow: 0 2px 24px #000a;
}
@media (max-width: 900px) {
  .video-hero-bg { max-width: 98vw; border-radius: 12px; }
  .video-hero { border-radius: 12px; }
}
.video-banner {
  width: 100%;
  max-width: 1200px;
  height: 280px;
  margin: 32px auto 32px auto;
  position: relative;
  overflow: hidden;
  border-radius: 0;
  box-shadow: none;
  background: #000;
  display: flex;
  align-items: center;
  justify-content: center;
}
.video-banner-video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 0;
  box-shadow: none;
  background: #000;
}
.video-banner-overlay {
  position: absolute;
  left: 0; top: 0; width: 100%; height: 100%;
  display: flex; align-items: center; justify-content: center;
  color: #fff;
  font-size: 2.2rem;
  font-weight: 800;
  background: rgba(0,0,0,0.18);
  text-shadow: 0 2px 16px #000;
  pointer-events: none;
}
@media (max-width: 900px) {
  .video-banner { height: 180px; }
  .video-banner-overlay { font-size: 1.2rem; }
}
.banner-hero {
  position: relative;
  width: 100%;
  min-height: 220px;
  max-height: 320px;
  height: 280px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  border-radius: 0 0 32px 32px;
  margin-bottom: 32px;
  background: none;
  box-shadow: 0 8px 40px #00e6ff22, 0 2px 18px #00e6ff11;
}
.banner-hero video {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  min-height: 220px;
  max-height: 320px;
  object-fit: cover;
  filter: blur(0.01px) brightness(0.95);
  opacity: 0.96;
  z-index: 0;
  border-radius: 0 0 32px 32px;
}
.banner-hero-overlay {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2;
  background: linear-gradient(120deg, rgba(11,17,31,0.55) 60%, rgba(30,136,229,0.18) 100%);
  pointer-events: none;
}

.banner-hero-content {
  display: flex;
  align-items: center;
  gap: 32px;
  z-index: 3;
  background: rgba(10,20,40,0.72);
  border-radius: 22px;
  padding: 32px 38px;
  box-shadow: 0 4px 32px #00e6ff22;
  pointer-events: auto;
  margin: 0 auto;
}
  
.banner-hero-logo {
  width: 90px;
  height: 90px;
  border-radius: 18px;
  background: rgba(15, 23, 42, 0.9);
  box-shadow: 0 2px 12px #00e6ff33;
  margin-right: 18px;
}
.banner-hero-title {
  font-size: 2.8rem;
  font-weight: 800;
  color: #00e6ff;
  text-shadow: 0 0 18px #00e6ff55, 0 2px 8px #1e88e5cc;
  margin: 0 0 10px 0;
  letter-spacing: 2px;
}
.banner-hero-subtitle {
  font-size: 1.3rem;
  color: #2196f3;
  font-weight: 600;
  margin-bottom: 10px;
  letter-spacing: 1px;
  text-shadow: 0 1px 8px #1e88e555;
}
.banner-hero-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(90deg, #00bcd4 60%, #1e88e5 100%);
  color: #fff;
  font-weight: 700;
  font-size: 1.08rem;
  padding: 12px 26px;
  border-radius: 14px;
  text-decoration: none;
  box-shadow: 0 2px 12px rgba(30,136,229,0.10);
  margin-top: 8px;
  transition: background 0.2s, box-shadow 0.2s, color 0.2s;
  border: none;
  outline: none;
}
.banner-hero-link:hover {
  background: linear-gradient(90deg, #1e88e5 60%, #00bcd4 100%);
  color: #fff;
  box-shadow: 0 4px 18px rgba(30,136,229,0.18);
  text-decoration: none;
}
@media (max-width: 900px) {
  .banner-hero {
    min-height: 120px;
    max-height: 180px;
    height: 160px;
    border-radius: 0 0 18px 18px;
  }
  .banner-hero-logo {
    margin: 0 0 10px 0;
  }
  .banner-hero-title {
    font-size: 1.7rem;
  }
  .banner-hero-subtitle {
    font-size: 1.05rem;
  }
  .banner-hero {
    min-height: 160px;
    max-height: 220px;
    border-radius: 0 0 18px 18px;
  }
  .banner-hero-video {
    min-height: 160px;
    max-height: 220px;
  }
}
.container {
  .container,
.fangio-header,
.fangio-header-decoration,
.banner-hero,
.banner-hero::before,
.banner-hero::after {
  background: none !important;
  box-shadow: none !important;
}
}
#toggleMismoTransporte {
  position: relative;
  font-weight: 700;
  border: 2.5px solid #00e6ff;
  background: linear-gradient(90deg, #00bcd4 60%, #1e88e5 100%);
  color: #fff;
  box-shadow: 0 2px 12px #00e6ff33;
  transition: background 0.2s, color 0.2s, border 0.2s, box-shadow 0.2s;
  outline: none;
  min-width: 320px;
  padding-right: 48px;
}
#toggleMismoTransporte.btn-outline-info {
  background: #0b111f;
  color: #00e6ff;
  border: 2.5px solid #00e6ff;
  box-shadow: none;
}
#toggleMismoTransporte.btn-info {
  background: linear-gradient(90deg, #00e6ff 60%, #00bcd4 100%);
  color: #0b111f;
  border: 2.5px solid #00e6ff;
  box-shadow: 0 4px 18px #00e6ff44;
}
#toggleMismoTransporte .toggle-icon {
  position: absolute;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.5em;
  transition: color 0.2s;
}
#toggleMismoTransporte.btn-info .toggle-icon {
  color: #10b981;
  text-shadow: 0 0 8px #10b98188;
}
#toggleMismoTransporte.btn-outline-info .toggle-icon {
  color: #888;
  text-shadow: none;
}
button, .tab-button, .btn {
  transition: background 0.2s, color 0.2s, box-shadow 0.2s, transform 0.15s;
}
button:hover, .tab-button:hover, .btn:hover {
  transform: translateY(-2px) scale(1.03);
}
.badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 0.95em;
  font-weight: 700;
  color: #fff;
}
.badge-factible { background: #10b981; }
.badge-nofactible { background: #ef4444; }
.badge-indef { background: #f59e42; }
body.modo-claro {
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
  color: #fff;
}
body.modo-claro .main-content,
body.modo-claro .table-container {
  background: rgba(30, 41, 59, 0.95) !important;
  color: #fff !important;
}
body.modo-claro .badge-factible { background: #059669; }
body.modo-claro .badge-nofactible { background: #dc2626; }
body.modo-claro .badge-indef { background: #f59e42; }

    /* ===== ESTILOS MODERNOS COMPLETOS ===== */
    
    /* Header y Logo Modernizados */
    .logo-container-modern {
      position: relative;
      display: inline-block;
    }
    
    .logo-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, rgba(0, 230, 255, 0.3) 0%, transparent 70%);
      border-radius: 50%;
      animation: logoGlow 3s ease-in-out infinite alternate;
    }
    
    @keyframes logoGlow {
      0% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.2); }
    }
    
    .title-container-modern {
      text-align: center;
    }
    
    .title-text {
      position: relative;
      display: inline-block;
    }
    
    .title-underline {
      width: 0;
      height: 3px;
      background: linear-gradient(90deg, #00e6ff, #f59e42);
      margin: 10px auto 0;
      border-radius: 2px;
      animation: titleUnderline 2s ease-out forwards;
    }
    
    @keyframes titleUnderline {
      to { width: 100%; }
    }
    
    .banner-hero-link {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 25px;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .banner-hero-link:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 230, 255, 0.3);
    }
    
    .link-arrow {
      font-size: 18px;
      transition: transform 0.3s ease;
    }
    
    .banner-hero-link:hover .link-arrow {
      transform: translateX(5px);
    }
    
    
      /* ===== BOTONES DE ACCIÓN ===== */
    .action-buttons-modern {
      display: flex;
      flex-direction: column;
    gap: 20px;
    align-items: center;
    margin-top: 25px;
  }

  .button-group-primary,
  .button-group-secondary,
  .button-group-utility {
    display: flex;
      gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
      align-items: center;
    }

  /* ===== BOTONES MODERNOS ===== */
  .btn-modern {
    position: relative;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 24px;
    border: none;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    text-decoration: none;
    color: var(--white);
    min-width: 180px;
    justify-content: center;
  }

  .btn-modern::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    transition: all 0.6s ease;
    transform: translate(-50%, -50%);
  }

  .btn-modern:hover::before {
    width: 300px;
    height: 300px;
  }

  .btn-modern:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
  }

  .btn-modern:active {
    transform: translateY(-1px);
  }

  .btn-icon {
    font-size: 18px;
    z-index: 2;
    position: relative;
    transition: transform 0.3s ease;
  }

  .btn-modern:hover .btn-icon {
    transform: scale(1.1);
  }

  .btn-text {
    z-index: 2;
    position: relative;
    font-weight: 600;
  }

  /* ===== VARIANTES DE BOTONES ===== */
  .btn-modern.btn-primary {
    background: var(--gradient-primary);
    box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
    border: 1px solid rgba(37, 99, 235, 0.3);
  }

  .btn-modern.btn-primary:hover {
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
    border-color: rgba(37, 99, 235, 0.6);
  }

  .btn-modern.btn-success {
    background: var(--gradient-success);
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    border: 1px solid rgba(16, 185, 129, 0.3);
  }

  .btn-modern.btn-success:hover {
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    border-color: rgba(16, 185, 129, 0.6);
  }

  .btn-modern.btn-warning {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
  }

  .btn-modern.btn-warning:hover {
    box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
  }

  .btn-modern.btn-danger {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
  }

  .btn-modern.btn-danger:hover {
    box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
  }

  .btn-modern.btn-info {
    background: linear-gradient(135deg, #06b6d4, #0891b2);
    box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
  }

  .btn-modern.btn-info:hover {
    box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
  }

  .btn-modern.btn-secondary {
    background: linear-gradient(135deg, #6b7280, #4b5563);
    box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
  }

  .btn-modern.btn-secondary:hover {
    box-shadow: 0 8px 25px rgba(107, 114, 128, 0.4);
  }

  .btn-modern.btn-toggle {
    background: var(--gradient-secondary);
    box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
    position: relative;
    padding-right: 60px;
  }

  .btn-modern.btn-toggle:hover {
    box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
  }

  .toggle-switch {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
  }

  .toggle-icon {
    font-size: 20px;
    transition: all 0.3s ease;
  }

  .btn-modern.btn-toggle:hover .toggle-icon {
    transform: scale(1.1);
    }
    
    .button-group-primary,
    .button-group-secondary,
    .button-group-utility {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    /* Botones Modernos */
    .btn-modern {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      overflow: hidden;
      text-decoration: none;
      color: white;
    }
    
    .btn-modern:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    .btn-modern:active {
      transform: translateY(0);
    }
    
    .btn-icon {
      font-size: 16px;
      z-index: 2;
    }
    
    .btn-text {
      z-index: 2;
      position: relative;
    }
    
    .btn-ripple {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transition: all 0.6s ease;
    }
    
    .btn-modern:hover .btn-ripple {
      width: 300px;
      height: 300px;
    }
    
    /* Variantes de Botones */
    .btn-modern.btn-primary {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    }
    
    .btn-modern.btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
    }
    
    .btn-modern.btn-warning {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }
    
    .btn-modern.btn-danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }
    
    .btn-modern.btn-info {
      background: linear-gradient(135deg, #06b6d4, #0891b2);
    }
    
    .btn-modern.btn-secondary {
      background: linear-gradient(135deg, #6b7280, #4b5563);
    }
    
    .btn-modern.btn-toggle {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    }
    
    .toggle-switch {
      margin-left: 10px;
    }
    
    /* Formulario Modernizado */
      /* ===== FORMULARIOS MODERNOS ===== */
    .form-grid-modern {
      display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 25px;
    margin: 30px 0;
  }

  .form-card {
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 30px;
    backdrop-filter: blur(20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  }

  .form-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-primary);
    z-index: 1;
  }

  .form-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    border-color: rgba(37, 99, 235, 0.3);
  }

  .form-card-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    z-index: 2;
  }

  .form-card-header i {
    font-size: 24px;
    color: var(--accent);
    background: rgba(6, 182, 212, 0.1);
    padding: 12px;
    border-radius: 12px;
    border: 1px solid rgba(6, 182, 212, 0.2);
  }

  .form-card-header h3 {
    margin: 0;
    color: var(--white);
    font-size: 1.3rem;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .form-card-content {
    display: grid;
    grid-template-columns: 1fr;
      gap: 20px;
    position: relative;
    z-index: 2;
  }

  .input-group-modern {
    position: relative;
  }

  .input-group-modern label {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    color: rgba(255, 255, 255, 0.9);
    font-size: 14px;
    font-weight: 600;
    transition: color 0.3s ease;
  }

  .input-group-modern label i {
    color: var(--accent);
    font-size: 16px;
    width: 20px;
    text-align: center;
  }

  .input-group-modern:hover label {
    color: var(--accent);
  }

  .input-modern {
    width: 100%;
    padding: 16px 20px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    color: var(--white);
    font-size: 15px;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
    position: relative;
  }

  .input-modern:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 25px rgba(6, 182, 212, 0.3);
    background: rgba(255, 255, 255, 0.12);
    transform: translateY(-2px);
  }

  .input-modern::placeholder {
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
  }

  .input-readonly {
    background: rgba(6, 182, 212, 0.1);
    border-color: rgba(6, 182, 212, 0.3);
    color: rgba(255, 255, 255, 0.9);
    font-weight: 600;
    cursor: not-allowed;
  }

  .input-highlight {
    background: rgba(245, 158, 11, 0.15);
    border-color: rgba(245, 158, 11, 0.4);
    color: #fbbf24;
    font-weight: 700;
    text-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
  }

  .input-focus-border {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 3px;
    background: var(--gradient-accent);
    border-radius: 2px;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .input-modern:focus + .input-focus-border {
    width: 100%;
    }
    
    .form-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    
    .form-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      border-color: rgba(0, 230, 255, 0.3);
    }
    
    .form-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .form-card-header i {
      font-size: 20px;
      color: #00e6ff;
    }
    
    .form-card-header h3 {
      margin: 0;
      color: white;
      font-size: 18px;
      font-weight: 600;
    }
    
    .form-card-content {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .input-group-modern {
      position: relative;
    }
    
    .input-group-modern label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      color: rgba(255, 255, 255, 0.9);
      font-size: 14px;
      font-weight: 500;
    }
    
    .input-group-modern label i {
      color: #00e6ff;
      font-size: 14px;
    }
    
    .input-modern {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 14px;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }
    
    .input-modern:focus {
      outline: none;
      border-color: #00e6ff;
      box-shadow: 0 0 15px rgba(0, 230, 255, 0.3);
      background: rgba(255, 255, 255, 0.15);
    }
    
    .input-modern::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    .input-readonly {
      background: rgba(0, 230, 255, 0.1);
      border-color: rgba(0, 230, 255, 0.3);
      color: rgba(255, 255, 255, 0.8);
    }
    
    .input-highlight {
      background: rgba(245, 158, 66, 0.2);
      border-color: rgba(245, 158, 66, 0.5);
      color: #f59e42;
      font-weight: 600;
    }
    
    .input-focus-border {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #00e6ff, #f59e42);
      transition: width 0.3s ease;
    }
    
    .input-modern:focus + .input-focus-border {
      width: 100%;
    }
    
    /* Tabla de Enlaces Modernizada */
    .enlaces-header-modern {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .enlaces-title-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .enlaces-title {
      display: flex;
      align-items: center;
      gap: 15px;
      color: white;
      margin: 0;
    }
    
    .enlaces-title i {
      font-size: 28px;
      color: #00e6ff;
    }
    
    .enlaces-title .title-underline {
      width: 0;
      height: 3px;
      background: linear-gradient(90deg, #00e6ff, #f59e42);
      border-radius: 2px;
      animation: titleUnderline 2s ease-out forwards;
    }
    
    .enlaces-stats {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      min-width: 80px;
    }
    
    .stat-item i {
      font-size: 20px;
      color: #00e6ff;
    }
    
    .stat-item span {
      font-size: 24px;
      font-weight: 700;
      color: white;
    }
    
    .stat-item label {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .enlaces-controls-modern {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
      /* ===== TABLAS MODERNAS ===== */
    .table-container-modern {
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.9) 100%);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(37, 99, 235, 0.2);
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(37, 99, 235, 0.1);
    position: relative;
  }

  .table-container-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .table-wrapper {
    overflow-x: auto;
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  /* ===== ESTILOS DE TABLA ===== */
  table {
    border-collapse: collapse;
    width: 100%;
    background: transparent;
    color: var(--white);
    font-size: 14px;
  }

  th, td {
    padding: 16px 20px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
  }

  th {
    background: linear-gradient(135deg, rgba(37, 99, 235, 0.2) 0%, rgba(6, 182, 212, 0.15) 100%);
    color: var(--white);
    font-weight: 700;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
    z-index: 10;
    backdrop-filter: blur(10px);
    border-bottom: 2px solid rgba(37, 99, 235, 0.3);
  }

  th i {
    margin-right: 8px;
    color: var(--accent);
  }

  tr {
    transition: all 0.3s ease;
    position: relative;
  }

  tr:hover {
    background: linear-gradient(135deg, rgba(37, 99, 235, 0.12) 0%, rgba(6, 182, 212, 0.08) 100%);
    transform: scale(1.01);
    box-shadow: 0 4px 20px rgba(37, 99, 235, 0.25);
    border-left: 3px solid var(--primary);
  }

  tr.selected {
    background: linear-gradient(135deg, 
      rgba(37, 99, 235, 0.2), 
      rgba(6, 182, 212, 0.2)) !important;
    color: var(--white) !important;
    box-shadow: 0 0 20px rgba(37, 99, 235, 0.3);
  }

  /* ===== BADGES MODERNOS ===== */
  .badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--white);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
  }

  .badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  }

  .badge-factible { 
    background: var(--gradient-accent);
    box-shadow: 0 2px 8px rgba(6, 182, 212, 0.3);
  }

  .badge-nofactible { 
    background: linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
  }

  .badge-indef { 
    background: linear-gradient(135deg, #f59e0b, #d97706);
    box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }
    
    .table-wrapper {
      overflow-x: auto;
      border-radius: 10px;
    }
    
    /* Estado Vacío Modernizado */
    .mensaje-sin-enlaces-modern {
      text-align: center;
      padding: 60px 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      border: 2px dashed rgba(255, 255, 255, 0.2);
      margin: 40px 0;
      backdrop-filter: blur(10px);
    }
    
    .empty-state-icon {
      font-size: 80px;
      color: rgba(0, 230, 255, 0.5);
      margin-bottom: 20px;
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .empty-state-title {
      color: white;
      font-size: 24px;
      margin: 0 0 15px 0;
      font-weight: 600;
    }
    
    .empty-state-description {
      color: rgba(255, 255, 255, 0.7);
      font-size: 16px;
      margin: 0 0 30px 0;
      line-height: 1.5;
    }
    
      /* ===== ESTADO VACÍO MODERNO ===== */
  .mensaje-sin-enlaces-modern {
    text-align: center;
    padding: 80px 40px;
    background: rgba(15, 23, 42, 0.8);
    border-radius: 24px;
    border: 2px dashed rgba(255, 255, 255, 0.2);
    margin: 50px 0;
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
  }

  .mensaje-sin-enlaces-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .empty-state-icon {
    font-size: 100px;
    color: rgba(6, 182, 212, 0.3);
    margin-bottom: 30px;
    animation: float 4s ease-in-out infinite;
    position: relative;
    z-index: 2;
  }

  .empty-state-title {
    color: var(--white);
    font-size: 2rem;
    margin: 0 0 20px 0;
    font-weight: 700;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    z-index: 2;
  }

  .empty-state-description {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1.1rem;
    margin: 0 0 40px 0;
    line-height: 1.6;
    position: relative;
    z-index: 2;
  }

  /* ===== RESPONSIVE DESIGN ===== */
  @media (max-width: 1200px) {
      .form-grid-modern {
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }
      
    .banner-hero-content {
        flex-direction: column;
        text-align: center;
      gap: 25px;
    }
    
    .banner-hero-title {
      font-size: 2.5rem;
    }
  }

  @media (max-width: 768px) {
    .container {
      padding: 15px;
    }
    
    .banner-hero {
      min-height: 200px;
      max-height: 280px;
      height: 250px;
      border-radius: 16px;
    }
    
    .banner-hero-content {
      padding: 25px 30px;
      gap: 20px;
    }
    
    .banner-hero-title {
      font-size: 2rem;
    }
    
    .banner-hero-subtitle {
      font-size: 1.1rem;
    }
    
    .banner-hero-logo {
      width: 70px;
      height: 70px;
    }
    
    .form-grid-modern {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .form-card {
      padding: 20px;
    }
    
    .navigation-container-modern {
      padding: 20px;
      margin: 20px 0;
      }
      
      .tab-navigation {
        flex-direction: column;
        align-items: center;
      gap: 15px;
    }
    
    .tab-button-modern {
      min-width: 140px;
      padding: 18px 20px;
    }
    
    .enlaces-title-section {
      flex-direction: column;
      text-align: center;
      gap: 20px;
    }
    
    .enlaces-stats {
      justify-content: center;
      gap: 15px;
      }
      
      .button-group-primary,
      .button-group-secondary,
      .button-group-utility {
        flex-direction: column;
        align-items: center;
      gap: 12px;
    }
    
    .btn-modern {
      min-width: 160px;
      padding: 14px 20px;
    }
    
    .frecuencia-rules {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .rule-item {
      padding: 15px;
    }
    
    .table-container-modern {
      padding: 15px;
    }
    
    th, td {
      padding: 12px 15px;
      font-size: 13px;
    }
  }

  @media (max-width: 480px) {
    .banner-hero-title {
      font-size: 1.8rem;
    }
    
    .banner-hero-subtitle {
      font-size: 1rem;
    }
    
    .banner-hero-logo {
      width: 60px;
      height: 60px;
    }
    
    .form-card {
      padding: 15px;
    }
    
    .input-modern {
      padding: 14px 16px;
      font-size: 14px;
    }
    
    .btn-modern {
      min-width: 140px;
      padding: 12px 18px;
      font-size: 14px;
      }
    }
    
    /* Animaciones de Entrada */
    .form-card,
    .enlaces-header-modern,
    .table-container-modern {
      animation: slideInUp 0.6s ease-out;
    }
    
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Efectos de Hover Mejorados */
    .form-card:hover,
    .enlaces-header-modern:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }
    
    /* Transiciones Suaves */
    * {
      transition: all 0.3s ease;
    }
    
    /* Footer Profesional */
    .footer-modern {
      background: linear-gradient(135deg, rgba(11, 17, 31, 0.95), rgba(30, 136, 229, 0.1));
      border-top: 1px solid rgba(0, 230, 255, 0.2);
      margin-top: 60px;
      padding: 40px 0 20px 0;
      backdrop-filter: blur(10px);
    }
    
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 40px;
      padding: 0 20px;
    }
    
    .footer-section {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .footer-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      color: #00e6ff;
    }
    
    .footer-logo i {
      font-size: 28px;
      color: #00e6ff;
    }
    
    .footer-description {
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.6;
      font-size: 14px;
    }
    
    .footer-title {
      color: white;
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 15px 0;
      border-bottom: 2px solid rgba(0, 230, 255, 0.3);
      padding-bottom: 8px;
    }
    
    .footer-features {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .footer-features li {
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
    }
    
    .footer-features li i {
      color: #10b981;
      font-size: 12px;
    }
    
    .footer-info {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .info-item {
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
    }
    
    .info-item i {
      color: #00e6ff;
      font-size: 14px;
      width: 16px;
    }
    
    .footer-bottom {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 30px;
      padding: 20px 20px 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .footer-copyright {
      display: flex;
      align-items: center;
      gap: 8px;
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
    }
    
    .footer-copyright i {
      color: #00e6ff;
    }
    
    .footer-links {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .footer-link {
      display: flex;
      align-items: center;
      gap: 8px;
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      font-size: 14px;
      padding: 8px 16px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .footer-link:hover {
      background: rgba(0, 230, 255, 0.1);
      border-color: rgba(0, 230, 255, 0.3);
      color: #00e6ff;
      transform: translateY(-2px);
    }
    
    .footer-link i {
      font-size: 14px;
    }
    
    /* Responsive Footer */
    @media (max-width: 768px) {
      .footer-content {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      
      .footer-bottom {
        flex-direction: column;
        text-align: center;
      }
      
      .footer-links {
        justify-content: center;
      }
    }

  </style>
</head>
<body> 
  <script>
if (localStorage.getItem('fangioSesion') !== 'activa') {
  window.location.href = 'login.html';
}
</script>

<button id="logoutBtn" style="
  display:none;
  position:fixed;
  top:18px;
  right:24px;
  z-index:9999;
  background: linear-gradient(90deg,#00bcd4 60%,#1e88e5 100%);
  color: #fff;
  font-weight: 700;
  padding: 12px 26px 12px 18px;
  border-radius: 12px;
  font-size: 1.08rem;
  border: none;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s;
  display: flex;
  align-items: center;
  gap: 10px;
">
  <i class="fas fa-sign-out-alt" style="font-size:1.2em;"></i> Cerrar sesión
  
</button>

<script>
// ===== VARIABLES GLOBALES =====
window.dataExcel = [];
window.dataPares = [];

// ===== FUNCIÓN CONVERTIR GRADOS A RADIANES (GLOBAL) =====
function convertirGradosARadianes(grados) {
  if (isNaN(grados)) return 0;
  return grados * Math.PI / 180;
}

// ===== FUNCIÓN CALCULAR DISTANCIA (GLOBAL) =====
function calcularDistancia(lat1, lon1, lat2, lon2) {
  if (isNaN(lat1) || isNaN(lon1) || isNaN(lat2) || isNaN(lon2)) return NaN;
  const rad = x => x * Math.PI / 180;
  const R = 6371.0088;
  const φ1 = rad(lat1), φ2 = rad(lat2);
  const Δφ = rad(lat2 - lat1);
  const Δλ = rad(lon2 - lon1);
  const a = Math.sin(Δφ / 2) ** 2 +
            Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) ** 2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

// ===== FUNCIÓN ASIGNAR FRECUENCIA (GLOBAL) =====
function asignarFrecuencia(distanciaKm) {
  if (isNaN(distanciaKm)) return ''; 
  if (distanciaKm <= 5) {
    return '80';
  } else if (distanciaKm <= 15) {
    return '15';
  } else {
    return '8';
  }
}

// ===== FUNCIÓN FORMATEAR ALTURA (GLOBAL) =====
function formatearAltura(altura) {
  if (altura === null || altura === undefined || altura === '') return 'N/A';
  if (isNaN(altura)) return 'N/A';
  return altura.toString() + ' m';
}

// ===== FUNCIÓN ACTUALIZAR CONTADOR ENLACES (GLOBAL) =====
function actualizarContadorEnlaces() {
  try {
    const enlaces = JSON.parse(localStorage.getItem('enlaces') || '[]');
    const enlacesPtP = JSON.parse(localStorage.getItem('enlacesPtP') || '[]');
    const enlacesMismoTransporte = JSON.parse(localStorage.getItem('enlacesMismoTransporte') || '[]');
    
    const totalEnlaces = enlaces.length + enlacesPtP.length + enlacesMismoTransporte.length;
    
    // Actualizar contadores en la UI
    const contadorEnlaces = document.getElementById('contador-enlaces');
    if (contadorEnlaces) {
      contadorEnlaces.textContent = totalEnlaces.toString();
    }
    
    const contadorPtP = document.getElementById('contador-ptp');
    if (contadorPtP) {
      contadorPtP.textContent = enlacesPtP.length.toString();
    }
    
    const contadorMismoTransporte = document.getElementById('contador-mismo-transporte');
    if (contadorMismoTransporte) {
      contadorMismoTransporte.textContent = enlacesMismoTransporte.length.toString();
    }
    
    console.log(`✅ Contador de enlaces actualizado: ${totalEnlaces} totales`);
  } catch (error) {
    console.error('❌ Error actualizando contador de enlaces:', error);
  }
}

// ===== FUNCIÓN VERIFICAR ENLACES VACÍOS (GLOBAL) =====
function verificarEnlacesVacios() {
  try {
    const enlaces = JSON.parse(localStorage.getItem('enlaces') || '[]');
    const enlacesPtP = JSON.parse(localStorage.getItem('enlacesPtP') || '[]');
    const enlacesMismoTransporte = JSON.parse(localStorage.getItem('enlacesMismoTransporte') || '[]');
    
    const totalEnlaces = enlaces.length + enlacesPtP.length + enlacesMismoTransporte.length;
    
    if (totalEnlaces === 0) {
      console.log('⚠️ No hay enlaces almacenados');
      return false;
    }
    
    console.log(`✅ Verificación completada: ${totalEnlaces} enlaces disponibles`);
    return true;
  } catch (error) {
    console.error('❌ Error verificando enlaces:', error);
    return false;
  }
}

// ===== FUNCIÓN MOSTRAR PESTAÑA (GLOBAL) =====
function mostrarPestana(pestana, event) {
  // PROTECCIÓN CONTRA BUCLE INFINITO
  if (window.navegandoPestana) {
    console.log('⚠️ Navegación ya en curso, ignorando llamada...');
    return;
  }
  
  window.navegandoPestana = true;
  console.log('🔄 Cambiando a pestaña:', pestana);
  
  try {
    // Ocultar todas las pestañas
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    
    // Mostrar la pestaña seleccionada
    const tabContent = document.getElementById('tab-' + pestana);
    if (tabContent) {
      tabContent.classList.add('active');
      console.log('✅ Pestaña activada:', pestana);
    } else {
      console.log('⚠️ Pestaña no encontrada:', pestana);
    }
    
    // Activar el botón correspondiente
    if (event) {
      event.currentTarget.classList.add('active');
    }
    
    // Lógica específica para cada pestaña
    if (pestana === 'enlaces') {
      console.log('📊 Cargando enlaces normales...');
      if (permitirMismoTransporte) {
        const tabla = document.querySelector('#tabla tbody');
        if (tabla) tabla.innerHTML = '';
        if (typeof actualizarContadorEnlaces === 'function') {
          actualizarContadorEnlaces();
        }
        if (typeof verificarEnlacesVacios === 'function') {
          verificarEnlacesVacios();
        }
      } else {
        if (typeof cargarEnlacesDeStorageModo === 'function') {
          cargarEnlacesDeStorageModo("normal");
        }
        if (typeof ordenarTablaPorFactibilidad === 'function') {
          ordenarTablaPorFactibilidad();
        }
      }
    }
    
    if (pestana === 'resumen') {
      console.log('📈 Cargando resumen...');
      if (typeof mostrarMapaEnlaces === 'function') {
        mostrarMapaEnlaces(null);
      }
    }
    
    if (pestana === 'mismoTransporte') {
      console.log('🔄 Cargando mismo transporte...');
      if (typeof mostrarTablaMismoTransporte === 'function') {
        mostrarTablaMismoTransporte();
      }
    }
    
    // Actualizar contadores
    if (typeof actualizarContadorEnlaces === 'function') {
      actualizarContadorEnlaces();
    }
    if (typeof verificarEnlacesVacios === 'function') {
      verificarEnlacesVacios();
    }
    
    console.log('✅ Navegación completada a:', pestana);
    
  } catch (error) {
    console.error('❌ Error en navegación:', error);
  } finally {
    // Limpiar flag de navegación
    window.navegandoPestana = false;
  }
}

// ===== FUNCIÓN ANALIZAR FACTIBILIDAD (GLOBAL) =====
function analizarFactibilidad(distanciaKm, arreA, arreB, transA, transB, torreA, torreB, OnA, OnB, esFactibleLOS = true) {
  let factible = false;
  let razon = '';
  let diametroAntena = '';
  let tipoEnlace = '';
  let detallesValidacion = [];
  
  if (!distanciaKm || isNaN(distanciaKm) || distanciaKm <= 0) {
    return {
      factible: false,
      razon: 'No factible - Distancia inválida o cero',
      diametroAntena: 'N/A',
      tipoEnlace: 'Error de Datos',
      distancia: distanciaKm,
      detalles: ['❌ Error en cálculo de distancia']
    };
  }
  
  const DISTANCIA_MAXIMA = 50;
  if (distanciaKm > DISTANCIA_MAXIMA) {
    return {
      factible: false,
      razon: `No factible - Distancia excesiva (${distanciaKm.toFixed(2)}km > ${DISTANCIA_MAXIMA}km)`,
      diametroAntena: 'N/A',
      tipoEnlace: 'Fuera de Rango',
      distancia: distanciaKm,
      detalles: [`❌ Distancia ${distanciaKm.toFixed(2)}km supera el límite máximo de ${DISTANCIA_MAXIMA}km`]
    };
  }
  
  if (!esFactibleLOS) {
    return {
      factible: false,
      razon: 'No factible - Línea de vista obstruida (perfil de elevación)',
      diametroAntena: 'N/A',
      tipoEnlace: 'LOS Obstruida',
      distancia: distanciaKm,
      detalles: ['❌ Línea de vista obstruida según perfil de elevación']
    };
  }
  
  const arreANorm = (arreA || '').toLowerCase().trim();
  const arreBNorm = (arreB || '').toLowerCase().trim();
  const transANorm = (transA || '').toLowerCase().trim();
  const transBNorm = (transB || '').toLowerCase().trim();
  const torreANorm = (torreA || '').toLowerCase().trim();
  const torreBNorm = (torreB || '').toLowerCase().trim();
  const onAirANorm = (OnA || '').toLowerCase().trim();
  const onAirBNorm = (OnB || '').toLowerCase().trim();
  
  function estaOnAir(estadoOnAir) {
    return estadoOnAir.includes('on air') ||
           estadoOnAir.includes('onair') ||
           estadoOnAir.includes('operativo') ||
           estadoOnAir.includes('activo') ||
           estadoOnAir.includes('funcionando') ||
           estadoOnAir === 'si' ||
           estadoOnAir === 'sí' ||
           estadoOnAir === 'yes';
  }
  
  function estaPendiente(estadoOnAir) {
    return estadoOnAir.includes('pendiente') ||
           estadoOnAir.includes('construcción') ||
           estadoOnAir.includes('construccion') ||
           estadoOnAir.includes('instalación') ||
           estadoOnAir.includes('instalacion') ||
           estadoOnAir.includes('desarrollo') ||
           estadoOnAir.includes('proyecto') ||
           estadoOnAir.includes('planeado') ||
           estadoOnAir.includes('no operativo') ||
           estadoOnAir.includes('inactivo') ||
           estadoOnAir === 'no';
  }
  
  const onAirAActivo = estaOnAir(onAirANorm);
  const onAirBActivo = estaOnAir(onAirBNorm);
  const onAirAPendiente = estaPendiente(onAirANorm);
  const onAirBPendiente = estaPendiente(onAirBNorm);
  
  if (onAirAPendiente) {
    let motivoOnAir = `Torre A está pendiente: "${OnA}"`;
    detallesValidacion.push(`❌ Torre A: "${OnA}" - Estado pendiente/inactivo`);
    if (onAirBPendiente) {
      detallesValidacion.push(`✅ Torre B: "${OnB}" - Estado pendiente/inactivo (no bloquea factibilidad)`);
    } else {
      detallesValidacion.push(`✅ Torre B: "${OnB}" - Estado operativo`);
    }
    detallesValidacion.push('⚠️ La torre A debe estar "On Air" (operativa) para establecer enlaces PtP');
    return {
      factible: false,
      razon: `No factible - ${motivoOnAir}`,
      diametroAntena: 'N/A',
      tipoEnlace: 'Torre No Operativa',
      distancia: distanciaKm,
      detalles: detallesValidacion
    };
  }
  
  if (onAirAActivo && onAirBActivo) {
    detallesValidacion.push(`✅ Torre A: "${OnA}" - Estado operativo confirmado`);
    detallesValidacion.push(`✅ Torre B: "${OnB}" - Estado operativo confirmado`);
  } else {
    detallesValidacion.push(`⚠️ Torre A: "${OnA}" - Estado no claramente definido`);
    detallesValidacion.push(`⚠️ Torre B: "${OnB}" - Estado no claramente definido`);
    detallesValidacion.push(`ℹ️ Se asume estado operativo, pero verificar manualmente`);
  }
  
  function esTorreNoFactible(tipoTorre) {
    const t = tipoTorre.toLowerCase();
    return t.includes('poste') ||
           t.includes('monopolo') ||
           t.includes('mono polo') ||
           t.includes('mono-polo') ||
           t.includes('mastil') ||
           t.includes('mástil');
  }
  
  const torreANoFactible = esTorreNoFactible(torreANorm);
  const torreBNoFactible = esTorreNoFactible(torreBNorm);
  
  if (torreANoFactible || torreBNoFactible) {
    let motivoTorre = '';
    if (torreANoFactible && torreBNoFactible) {
      motivoTorre = `Ambas torres son de tipo no compatible (A: ${torreA}, B: ${torreB})`;
      detallesValidacion.push(`❌ Torre A: "${torreA}" - Tipo no factible`);
      detallesValidacion.push(`❌ Torre B: "${torreB}" - Tipo no factible`);
    } else if (torreANoFactible) {
      motivoTorre = `Torre A es de tipo no compatible: "${torreA}"`;
      detallesValidacion.push(`❌ Torre A: "${torreA}" - Tipo no factible`);
      detallesValidacion.push(`✅ Torre B: "${torreB}" - Tipo compatible`);
    } else {
      motivoTorre = `Torre B es de tipo no compatible: "${torreB}"`;
      detallesValidacion.push(`✅ Torre A: "${torreA}" - Tipo compatible`);
      detallesValidacion.push(`❌ Torre B: "${torreB}" - Tipo no factible`);
    }
    detallesValidacion.push('⚠️ Los tipos de torre "poste" y "monopolo" no son compatibles para enlaces PtP');
    return {
      factible: false,
      razon: `No factible - ${motivoTorre}`,
      diametroAntena: 'N/A',
      tipoEnlace: 'Torre Incompatible',
      distancia: distanciaKm,
      detalles: detallesValidacion
    };
  }
  
  detallesValidacion.push(`✅ Torre A: "${torreA}" - Tipo compatible para enlace PtP`);
  detallesValidacion.push(`✅ Torre B: "${torreB}" - Tipo compatible para enlace PtP`);
  
  const alturaLibre = parseFloat(document.getElementById('alturaLibre').value);
  const alturaDisponible = parseFloat(document.getElementById('alturaDisponible').value);
  
  if (!isNaN(alturaLibre) && !isNaN(alturaDisponible)) {
    if (alturaDisponible < alturaLibre) {
      detallesValidacion.push(`❌ Línea de vista obstruida: Altura disponible (${alturaDisponible.toFixed(2)} m) < Altura libre necesaria (${alturaLibre.toFixed(2)} m)`);
      return {
        factible: false,
        razon: 'No factible - Línea de vista obstruida (altura insuficiente)',
        diametroAntena: 'N/A',
        tipoEnlace: 'LOS Obstruida',
        distancia: distanciaKm,
        detalles: detallesValidacion
      };
    } else {
      detallesValidacion.push(`✅ Línea de vista: Altura disponible (${alturaDisponible.toFixed(2)} m) ≥ Altura libre necesaria (${alturaLibre.toFixed(2)} m)`);
    }
  }
  
  function calcularDiametroAntena(distancia, esArrendamiento = false) {
    if (esArrendamiento) {
      if (distancia <= 3.1) return '1 pie';
      if (distancia <= 8) return '2 pies';
      if (distancia <= 13.5) return '3 pies';
      return 'No factible';
    }
    if (distancia >= 0 && distancia <= 3) return '1 pie';
    if (distancia > 3 && distancia <= 5) return '2 pies';
    if (distancia > 5 && distancia <= 10) return '3 pies';
    if (distancia > 10 && distancia <= 20) return '4 pies';
    if (distancia > 20) return '6 pies';
    return 'No factible';
  }
  
  function validarCapacidadAntena(distancia, diametro, esArrendamiento = false) {
    if (esArrendamiento) {
      if (diametro === '1 pie') return distancia <= 3.1;
      if (diametro === '2 pies') return distancia > 3.1 && distancia <= 8;
      if (diametro === '3 pies') return distancia > 8 && distancia <= 14;
      return false;
    }
    if (diametro === '1 pie') return distancia >= 0 && distancia <= 3;
    if (diametro === '2 pies') return distancia > 3 && distancia <= 5;
    if (diametro === '3 pies') return distancia > 5 && distancia <= 10;
    return false;
  }
  
  function esArrendada(tipoArrendamiento) {
    return tipoArrendamiento.includes('arrendada') ||
           tipoArrendamiento.includes('arrendamiento') ||
           tipoArrendamiento.includes('renta');
  }
  
  function esAdquisicion(tipoArrendamiento) {
    return tipoArrendamiento.includes('adquisición') ||
           tipoArrendamiento.includes('adquisicion') ||
           tipoArrendamiento.includes('compra') ||
           tipoArrendamiento.includes('propia');
  }
  
  function esFibra(tipoTransporte) {
    return tipoTransporte.includes('fibra') ||
           tipoTransporte.includes('óptica') ||
           tipoTransporte.includes('optica') ||
           tipoTransporte.includes('fo');
  }
  
  function esSatelital(tipoTransporte) {
    return tipoTransporte.includes('starlink') ||
           tipoTransporte.includes('orbita') ||
           tipoTransporte.includes('satelite-oa') ||
           tipoTransporte.includes('satelital') ||
           tipoTransporte.includes('satellite');
  }
  
  const transporteBNulo = transBNorm === 'n/a' || transBNorm === '0' || transBNorm === '' || transBNorm === 'na';
  
  if (transporteBNulo) {
    const fibraA = esFibra(transANorm);
    detallesValidacion.push('✅ Transporte en B está vacío/N/A/0, se permite enlace si A tiene fibra óptica');
    if (!fibraA) {
      detallesValidacion.push('❌ Torre A debe tener Fibra Óptica');
      return {
        factible: false,
        razon: `No factible - Torre A debe tener Fibra Óptica`,
        diametroAntena: 'N/A',
        tipoEnlace: 'Transporte Incompatible',
        distancia: distanciaKm,
        detalles: detallesValidacion
      };
    }
    diametroAntena = calcularDiametroAntena(distanciaKm, false);
    detallesValidacion.push(`📡 Antenas requeridas: ${diametroAntena} (según distancia ${distanciaKm.toFixed(2)}km)`);
    if (validarCapacidadAntena(distanciaKm, diametroAntena)) {
      detallesValidacion.push(`✅ Distancia ${distanciaKm.toFixed(2)}km compatible con antenas de ${diametroAntena}`);
      factible = true;
      razon = `Enlace factible - Fibra en A, B vacío, distancia: ${distanciaKm.toFixed(2)}km, antenas: ${diametroAntena}`;
    } else {
      detallesValidacion.push(`❌ Distancia ${distanciaKm.toFixed(2)}km excede capacidad de antenas de ${diametroAntena}`);
      factible = false;
      razon = `No factible - Distancia ${distanciaKm.toFixed(2)}km excede capacidad de antenas ${diametroAntena}`;
    }
    return {
      factible,
      razon,
      diametroAntena,
      tipoEnlace: 'Fibra A / B vacío',
      distancia: distanciaKm,
      detalles: detallesValidacion
    };
  }
  
  if (!transA || !transB) {
    detallesValidacion.push('⚠️ Falta información de tipo de transporte');
    return {
      factible: false,
      razon: 'No factible - Información incompleta de transporte',
      diametroAntena: 'N/A',
      tipoEnlace: 'Datos Incompletos',
      distancia: distanciaKm,
      detalles: detallesValidacion
    };
  }
  
  if (transANorm === transBNorm) {
    const esStarlinkOA = (t) => t.includes('starlink') || t.includes('satelite-oa') || t.includes('satélite-oa');
    if (esStarlinkOA(transANorm) || esStarlinkOA(transBNorm)) {
      detallesValidacion.push(`✅ Ambos sitios tienen el mismo transporte (${transA}) y al menos uno es Starlink o Satelite-OA. Se considera FACTIBLE.`);
      return {
        factible: true,
        razon: `Enlace factible - Mismo tipo de transporte (${transA}) con Starlink/Satelite-OA en A o B.`,
        diametroAntena: 'N/A',
        tipoEnlace: 'Mismo Transporte Satelital',
        distancia: distanciaKm,
        detalles: detallesValidacion
      };
    }
    detallesValidacion.push(`⚠️ Permitiendo mismo tipo de transporte: "${transA}"`);
  }
  
  const esArrendadaA = esArrendada(arreANorm);
  const esArrendadaB = esArrendada(arreBNorm);
  
  if (esArrendadaA || esArrendadaB) {
    diametroAntena = calcularDiametroAntena(distanciaKm, true);
    tipoEnlace = 'Torres Arrendadas';
    
    detallesValidacion.push(`📍 Torre A: ${esArrendadaA ? 'Arrendada' : 'Propia'}`);
    detallesValidacion.push(`📍 Torre B: ${esArrendadaB ? 'Arrendada' : 'Propia'}`);
    detallesValidacion.push(`📡 Antena asignada: ${diametroAntena} (según distancia)`);
    
    if (diametroAntena === '1 pie' || diametroAntena === '2 pies') {
      detallesValidacion.push(`✅ Antena de ${diametroAntena} permitida en arrendada`);
      factible = true;
      razon = `Enlace factible - Antena de ${diametroAntena} en torre arrendada`;
    } else if (diametroAntena === '3 pies') {
      detallesValidacion.push('⚠️ Antena de 3 pies en torre arrendada: requiere análisis adicional.');
      return {
        factible: true,
        razon: 'FACTIBLE (Requiere análisis: antena de 3 pies en torre arrendada)',
        diametroAntena,
        tipoEnlace,
        distancia: distanciaKm,
        detalles: detallesValidacion,
        advertencia: true
      };
    } else {
      detallesValidacion.push(`❌ Antena de ${diametroAntena} NO permitida en torre arrendada (solo 1, 2 o 3 pies)`);
      return {
        factible: false,
        razon: `No factible - Solo se permiten antenas de 1, 2 o 3 pies en torres arrendadas`,
        diametroAntena,
        tipoEnlace,
        distancia: distanciaKm,
        detalles: detallesValidacion
      };
    }
    return { factible, razon, diametroAntena, tipoEnlace, distancia: distanciaKm, detalles: detallesValidacion };
  }
  
  const esAdquisicionA = esAdquisicion(arreANorm);
  const esAdquisicionB = esAdquisicion(arreBNorm);
  
  if (esAdquisicionA && esAdquisicionB) {
    tipoEnlace = 'Torres de Adquisición';
    detallesValidacion.push('🏢 Ambas torres son de adquisición (mayor flexibilidad)');
    
    if (distanciaKm > 50) {
      factible = false;
      razon = `No factible - Distancia excesiva (${distanciaKm.toFixed(2)}km > 50km)`;
      diametroAntena = 'Cualquiera';
      detallesValidacion.push(`❌ Distancia ${distanciaKm.toFixed(2)}km supera el límite máximo de 50km`);
    } else {
      factible = true;
      razon = `Enlace factible - Torres de adquisición, sin restricción de diámetro de antena`;
      if (distanciaKm <= 5) {
        diametroAntena = '1 a 2 pies';
      } else if (distanciaKm <= 15) {
        diametroAntena = '3 a 4 pies';
      } else {
        diametroAntena = '4 a 6 pies';
      }
      detallesValidacion.push(`✅ Antena recomendada para adquisición: ${diametroAntena}`);
    }
    return {
      factible,
      razon,
      diametroAntena,
      tipoEnlace,
      distancia: distanciaKm,
      detalles: detallesValidacion
    };
  } else {
    tipoEnlace = 'Torres Mixtas';
    detallesValidacion.push(`🏢 Torre A: ${esAdquisicionA ? 'Adquisición' : 'Otro'}, Torre B: ${esAdquisicionB ? 'Adquisición' : 'Otro'}`);
    
    diametroAntena = calcularDiametroAntena(distanciaKm, false);
    detallesValidacion.push(`📡 Antenas requeridas: ${diametroAntena} (según distancia ${distanciaKm.toFixed(2)}km)`);
    
    if (validarCapacidadAntena(distanciaKm, diametroAntena)) {
      detallesValidacion.push(`✅ Distancia ${distanciaKm.toFixed(2)}km compatible con antenas de ${diametroAntena}`);
      factible = true;
      razon = `Enlace factible - Fibra+Satelital, distancia: ${distanciaKm.toFixed(2)}km, antenas: ${diametroAntena}`;
    } else {
      detallesValidacion.push(`❌ Distancia ${distanciaKm.toFixed(2)}km excede capacidad de antenas de ${diametroAntena}`);
      factible = false;
      razon = `No factible - Distancia ${distanciaKm.toFixed(2)}km excede capacidad de antenas ${diametroAntena}`;
    }
    return {
      factible,
      razon,
      diametroAntena,
      tipoEnlace,
      distancia: distanciaKm,
      detalles: detallesValidacion
    };
  }
}

// Debug: Verificar que las variables estén disponibles
console.log('🔍 Variables globales inicializadas:', {
  dataExcel: dataExcel,
  filaEditando: filaEditando,
  dataPares: dataPares
});

function togglePermitirMismoTransporte() {
  permitirMismoTransporte = !permitirMismoTransporte;
  localStorage.setItem('permitirMismoTransporte', permitirMismoTransporte);
  const btn = document.getElementById('toggleMismoTransporte');
  const icon = btn.querySelector('.toggle-icon i');
  if (permitirMismoTransporte) {
    btn.classList.remove('btn-outline-info');
    btn.classList.add('btn-info');
    icon.className = 'fas fa-toggle-on';
  } else {
    btn.classList.remove('btn-info');
    btn.classList.add('btn-outline-info');
    icon.className = 'fas fa-toggle-off';
  }
}

// ===== FUNCIÓN DE PRUEBA PARA VERIFICAR CARGA =====
function probarCargaArchivos() {
  console.log('🧪 FUNCIÓN DE PRUEBA EJECUTÁNDOSE...');
  console.log('🔍 Verificando elementos del DOM...');
  
  const inputExcel = document.getElementById('inputFile');
  const inputPares = document.getElementById('inputFilePairs');
  
  console.log('📁 inputFile encontrado:', inputExcel);
  console.log('📁 inputFilePairs encontrado:', inputPares);
  
  if (inputExcel) {
    console.log('✅ inputFile está en el DOM');
    console.log('📁 inputFile type:', inputExcel.type);
    console.log('📁 inputFile accept:', inputExcel.accept);
  } else {
    console.error('❌ inputFile NO está en el DOM');
  }
  
  if (inputPares) {
    console.log('✅ inputFilePairs está en el DOM');
    console.log('📁 inputFilePairs type:', inputPares.type);
    console.log('📁 inputFilePairs accept:', inputPares.accept);
  } else {
    console.error('❌ inputFilePairs NO está en el DOM');
  }
  
  // Verificar que XLSX esté disponible
  if (typeof XLSX !== 'undefined') {
    console.log('✅ XLSX está disponible');
  } else {
    console.error('❌ XLSX NO está disponible');
  }
  
  // Verificar variables globales
  console.log('📊 dataExcel:', dataExcel);
  console.log('📊 dataPares:', dataPares);
  
  alert('🧪 Prueba completada. Revisa la consola para más detalles.');
}

// ===== FUNCIÓN PARA CONFIGURAR CARGA DE ARCHIVOS =====
</script>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fangio Telecom - Gestor de Enlaces PtP con Análisis de Factibilidad</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <!-- Favicon files not found - commented out to prevent errors -->
  <!-- <link rel="icon" type="image/png" href="img/favicon-32x32-light.png" sizes="32x32"> -->
  <!-- <link rel="icon" type="image/png" href="img/favicon-32x32-light.png" sizes="32x32" media="(prefers-color-scheme: light)"> -->
  <!-- <link rel="icon" type="image/png" href="img/favicon-32x32-dark.png" sizes="32x32" media="(prefers-color-scheme: dark)"> -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  
  <!-- ===== FUNCIONES GLOBALES NECESARIAS ===== -->
  
  <style>
  /* ===== VARIABLES CSS MODERNAS ===== */
  :root {
    --primary: #2563eb;
    --primary-dark: #1d4ed8;
    --primary-light: #3b82f6;
    --secondary: #7c3aed;
    --secondary-dark: #6d28d9;
    --accent: #06b6d4;
    --accent-dark: #0891b2;
    --success: #10b981;
    --success-dark: #059669;
    --warning: #f59e0b;
    --warning-dark: #d97706;
    --danger: #ef4444;
    --danger-dark: #dc2626;
    --dark: #0f172a;
    --dark-light: #1e293b;
    --dark-lighter: #334155;
    --gray: #64748b;
    --gray-light: #94a3b8;
    --gray-lighter: #cbd5e1;
    --white: #ffffff;
    --glass: rgba(255, 255, 255, 0.1);
    --glass-dark: rgba(0, 0, 0, 0.2);
    --radius: 12px;
    --radius-lg: 16px;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    --gradient-primary: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    --gradient-secondary: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
    --gradient-accent: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
    --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    --gradient-dark: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  }

  /* ===== RESET Y BASE ===== */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body, html {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
    color: var(--white);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ===== ANIMACIONES GLOBALES ===== */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  /* ===== COMPONENTES BASE ===== */
  .tab-content {
  display: none;
    animation: fadeInUp 0.6s ease-out;
}
  
.tab-content.active {
  display: block;
}
* {
  box-sizing: border-box;
  font-family: 'Inter', sans-serif;
}
body, html {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(135deg, #081421 0%, #122434 100%);
  color: var(--text-light);
}
  /* ===== LAYOUT PRINCIPAL ===== */
.container {
    max-width: 1400px;
  margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 1;
  }

  /* ===== HEADER MODERNO ===== */
  .banner-hero {
    position: relative;
    width: 100%;
    min-height: 280px;
    max-height: 380px;
    height: 320px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: 24px;
    margin-bottom: 40px;
    background: linear-gradient(135deg, var(--dark) 0%, var(--dark-light) 100%);
    box-shadow: var(--shadow-lg);
    position: relative;
  }

  .banner-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
      rgba(37, 99, 235, 0.1) 0%, 
      rgba(124, 58, 237, 0.1) 50%, 
      rgba(6, 182, 212, 0.1) 100%);
    z-index: 1;
  }

  .banner-hero video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.7) contrast(1.1);
    opacity: 0.8;
    z-index: 0;
    border-radius: 24px;
  }

  .banner-hero-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    background: linear-gradient(135deg, 
      rgba(15, 23, 42, 0.8) 0%, 
      rgba(30, 41, 59, 0.6) 100%);
    border-radius: 24px;
  }

  .banner-hero-content {
    display: flex;
    align-items: center;
    gap: 40px;
    z-index: 3;
    background: rgba(15, 23, 42, 0.9);
    border-radius: 20px;
    padding: 40px 50px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    animation: fadeInUp 1s ease-out;
  }

  .logo-container-modern {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .banner-hero-logo {
    width: 100px;
    height: 100px;
    border-radius: 20px;
    background: var(--white);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
    padding: 15px;
    position: relative;
    z-index: 2;
    animation: float 3s ease-in-out infinite;
  }

  .logo-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 140px;
    height: 140px;
    background: radial-gradient(circle, rgba(37, 99, 235, 0.3) 0%, transparent 70%);
    border-radius: 50%;
    animation: pulse 3s ease-in-out infinite;
    z-index: 1;
  }

  .title-container-modern {
    text-align: left;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .banner-hero-title {
    font-size: 3.2rem;
    font-weight: 800;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0;
    letter-spacing: -0.02em;
    line-height: 1.1;
    animation: slideInLeft 1s ease-out 0.3s both;
  }

  .banner-hero-subtitle {
    font-size: 1.4rem;
    color: var(--gray-light);
    font-weight: 500;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideInLeft 1s ease-out 0.5s both;
  }

  .banner-hero-subtitle i {
    color: var(--accent);
    font-size: 1.2em;
  }

  .banner-hero-link {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    padding: 14px 28px;
    background: var(--gradient-primary);
    color: var(--white);
    text-decoration: none;
    border-radius: 50px;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
    animation: slideInLeft 1s ease-out 0.7s both;
    position: relative;
    overflow: hidden;
  }

  .banner-hero-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  .banner-hero-link:hover::before {
    left: 100%;
  }

  .banner-hero-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
  }

  .link-arrow {
    font-size: 18px;
    transition: transform 0.3s ease;
  }

  .banner-hero-link:hover .link-arrow {
    transform: translateX(5px);
}
.header {
  background: transparent;
  box-shadow: none;
  border: none;
  border-radius: 0;
  padding: 0;
  margin-bottom: 30px;
  display: flex;
  align-items: center;
  gap: 30px;
}
.logo-container .logo-wrapper {
  width: 110px;
  height: 110px;
}
.logo img {
  width: 100%;
  height: 100%;
  border-radius: 16px;
  background: transparent;
  box-shadow: 0 2px 12px rgba(0,188,212,0.10);
}
.company-info h1 {
  font-size: 2.8rem;
  font-weight: 700;
  color: var(--accent);
  text-shadow: 0 0 8px var(--accent);
  margin-bottom: 10px;
  background: none;
  -webkit-text-fill-color: unset;
}
.company-info .subtitle {
  font-size: 1.2rem;
  color: var(--primary);
  font-weight: 600;
  margin-top: 10px;
  padding-left: 0;
}
.premium-badge {
  display: none;
}
.main-content {
  background: rgba(11, 17, 31, 0.98);
  border-radius: 20px;
  box-shadow: 0 6px 32px 0 rgba(0,188,212,0.10);
  border: 2px solid var(--accent);
  padding: 32px 28px 18px 28px;
  margin-top: 24px;
  color: var(--text-light);
}
.tabs {
  display: flex;
  gap: 18px;
  margin-bottom: 32px;
  justify-content: center;
}
.tab-button {
  background: rgba(0,188,212,0.12);
  color: #e0f7fa;
  border: none;
  border-radius: 14px;
  padding: 16px 32px;
  font-size: 1.1rem;
  font-weight: 600;
  transition: background 0.2s, color 0.2s, box-shadow 0.2s;
  box-shadow: 0 2px 8px rgba(30,136,229,0.08);
}
.tab-button.active, .tab-button:hover {
  background: linear-gradient(135deg, #00bcd4 60%, #1e88e5 100%);
  color: #fff;
  box-shadow: 0 4px 16px rgba(30,136,229,0.18);
}
  /* ===== INFORMACIÓN DE FRECUENCIA MODERNA ===== */
  .frecuencia-info-modern {
    background: rgba(15, 23, 42, 0.9);
    border: 2px solid var(--accent);
    border-radius: 20px;
    margin-bottom: 32px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(6, 182, 212, 0.15);
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
  }

  .frecuencia-info-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .frecuencia-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
    color: var(--accent);
  }

  .frecuencia-header i {
    font-size: 24px;
    color: var(--accent);
  }

  .frecuencia-header h3 {
    font-size: 1.4rem;
    font-weight: 700;
    margin: 0;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .frecuencia-rules {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }

  .rule-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
  border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .rule-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
      rgba(6, 182, 212, 0.1), 
      rgba(37, 99, 235, 0.1));
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .rule-item:hover::before {
    opacity: 1;
  }

  .rule-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(6, 182, 212, 0.2);
    border-color: rgba(6, 182, 212, 0.5);
  }

  .rule-distance {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--white);
    text-align: center;
    z-index: 2;
    position: relative;
  }

  .rule-frequency {
    font-size: 1.3rem;
    font-weight: 800;
  color: var(--accent);
    text-align: center;
    z-index: 2;
    position: relative;
    text-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
  }

  .rule-icon {
    font-size: 2rem;
    color: var(--accent);
    z-index: 2;
    position: relative;
    transition: transform 0.3s ease;
  }

  .rule-item:hover .rule-icon {
    transform: scale(1.1);
}
.file-upload {
  background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
  border: 2px dashed rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 30px;
  margin-bottom: 30px;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}
.file-upload label {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 16px 32px;
  background: linear-gradient(135deg, #00bcd4, #1e88e5);
  color: #fff;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.3s ease;
  box-shadow: 0 8px 25px rgba(0,188,212,0.13);
}
.file-upload label:hover {
  background: linear-gradient(135deg, #1e88e5, #00bcd4);
}
.file-upload input[type="file"] {
  display: none;
}
.form-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 18px 32px;
  background: transparent;
  padding: 0;
  border-radius: 0;
  margin-top: 0;
  max-width: 1150px;
  width: 100%;
  box-shadow: none;
  border: none;
}
@media (max-width: 1200px) {
  .form-grid { grid-template-columns: repeat(2, 1fr); max-width: 900px; }
}
@media (max-width: 900px) {
  .main-content { padding: 16px 4px 10px 4px; max-width: 100vw; }
  .form-grid { grid-template-columns: 1fr; padding: 0; max-width: 100vw; }
}
.form-grid label {
  font-weight: 600;
  color: var(--accent);
  margin-bottom: 6px;
  display: block;
  letter-spacing: 0.5px;
}
.form-grid input, .form-grid select {
  width: 100%;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1.5px solid var(--primary);
  margin-top: 4px;
  font-size: 1rem;
  background: #1a2636;
  color: var(--text-light);
  outline: none;
  transition: background 0.2s, border 0.2s;
  box-shadow: 0 1px 4px 0 rgba(30,136,229,0.08);
}
.form-grid input:focus, .form-grid select:focus {
  background: #22304a;
  border-color: var(--accent);
}
.form-grid input[readonly] {
  background: #16202e;
  color: #b2ebf2;
  border-style: dashed;
}


  .metric-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .metric-icon {
    width: 50px;
    height: 50px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: var(--white);
    position: relative;
    z-index: 2;
  }

  .metric-icon.primary { background: var(--gradient-primary); }
  .metric-icon.success { background: var(--gradient-accent); }
  .metric-icon.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .metric-icon.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }

  .metric-trend {
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 12px;
    font-weight: 600;
    position: relative;
    z-index: 2;
  }

  .metric-trend.positive {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.3);
  }

  .metric-trend.negative {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
  }

  .metric-value {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--white);
    margin-bottom: 10px;
    position: relative;
    z-index: 2;
  }

  .metric-label {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
    position: relative;
    z-index: 2;
  }

  .metric-chart {
    height: 60px;
    margin-top: 20px;
    position: relative;
    z-index: 2;
  }

  /* ===== MAPA AVANZADO ===== */
  .map-container-advanced {
    background: rgba(15, 23, 42, 0.9);
    border-radius: 20px;
    padding: 25px;
    margin: 30px 0;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
  }

  .map-container-advanced::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .map-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
    gap: 20px;
  }

  .map-title {
    display: flex;
    align-items: center;
    gap: 15px;
    color: var(--white);
    margin: 0;
  }

  .map-title i {
    font-size: 28px;
    color: var(--accent);
  }

  .map-title h3 {
    font-size: 1.5rem;
    font-weight: 700;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .map-controls {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }

  .map-control-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    color: var(--white);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .map-control-btn:hover {
    background: rgba(37, 99, 235, 0.2);
    border-color: rgba(37, 99, 235, 0.5);
    transform: translateY(-2px);
  }

  .map-control-btn.active {
    background: var(--gradient-primary);
    border-color: var(--primary);
    box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
  }

  .map-filters {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .map-filter-group {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .map-filter-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    font-weight: 600;
  }

  .map-filter-select {
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: var(--white);
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .map-filter-select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
  }

  .map-filter-select option {
    background: var(--dark);
    color: var(--white);
  }

  #mapa-enlaces {
    width: 100%;
    height: 500px;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 2;
  }

  .map-legend {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    font-size: 13px;
    color: var(--white);
    font-weight: 500;
  }

  .legend-color {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.3);
  }

  .legend-color.factible { background: var(--success); }
  .legend-color.no-factible { background: var(--danger); }
  .legend-color.indef { background: var(--warning); }

  /* ===== SISTEMA DE NOTIFICACIONES ===== */
  .notification-center {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-width: 400px;
  }

  .notification {
    background: rgba(15, 23, 42, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    backdrop-filter: blur(20px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    transform: translateX(100%);
    animation: slideInRight 0.5s ease-out forwards;
    position: relative;
    overflow: hidden;
  }

  .notification::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--gradient-accent);
  }

  .notification.success::before { background: var(--gradient-accent); }
  .notification.warning::before { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .notification.error::before { background: linear-gradient(135deg, #ef4444, #dc2626); }

  @keyframes slideInRight {
    to { transform: translateX(0); }
  }

  .notification-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .notification-title {
    font-weight: 600;
    color: var(--white);
    font-size: 14px;
  }

  .notification-close {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.6);
    cursor: pointer;
    font-size: 18px;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
  }

  .notification-close:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--white);
  }

  .notification-message {
    color: rgba(255, 255, 255, 0.8);
    font-size: 13px;
    line-height: 1.5;
  }

  /* ===== BÚSQUEDA Y FILTROS AVANZADOS ===== */
  .search-filters-container {
    background: rgba(15, 23, 42, 0.8);
    border-radius: 20px;
    padding: 25px;
    margin: 30px 0;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  }

  .search-bar {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
  }

  .search-input {
    flex: 1;
    min-width: 300px;
    padding: 15px 20px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    color: var(--white);
    font-size: 15px;
    transition: all 0.3s ease;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 25px rgba(6, 182, 212, 0.3);
    background: rgba(255, 255, 255, 0.15);
  }

  .search-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
  }

  .search-btn {
    padding: 15px 25px;
    background: var(--gradient-primary);
    border: none;
    border-radius: 12px;
    color: var(--white);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .search-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
  }

  .filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .filter-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 13px;
    font-weight: 600;
  }

  .filter-select {
    padding: 10px 15px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: var(--white);
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .filter-select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
  }

  .filter-select option {
    background: var(--dark);
    color: var(--white);
  }

  @keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
  }

  .pulse-glow {
    animation: pulseGlow 2s ease-in-out infinite alternate;
  }

  @keyframes pulseGlow {
    0% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); }
    100% { box-shadow: 0 0 40px rgba(6, 182, 212, 0.6); }
  }

  /* ===== INTERFAZ EMPRESARIAL PROFESIONAL ===== */
  
  /* ===== HEADER CORPORATIVO ===== */
  .corporate-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 70px;
    background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
    border-bottom: 3px solid var(--accent);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 30px;
    backdrop-filter: blur(20px);
  }

  .corporate-logo {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .corporate-logo-icon {
    width: 45px;
    height: 45px;
    background: var(--gradient-accent);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: var(--white);
    box-shadow: 0 4px 15px rgba(6, 182, 212, 0.4);
  }

  .corporate-logo-text {
    display: flex;
    flex-direction: column;
  }

  .corporate-logo-title {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--white);
    line-height: 1.2;
  }

  .corporate-logo-subtitle {
    font-size: 0.8rem;
    color: var(--gray-light);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .corporate-nav {
    display: flex;
    align-items: center;
    gap: 30px;
  }

  .corporate-nav-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    color: var(--gray-light);
    text-decoration: none;
    font-weight: 500;
    border-radius: 8px;
    transition: all 0.3s ease;
    position: relative;
  }

  .corporate-nav-item:hover {
    color: var(--white);
    background: rgba(255, 255, 255, 0.1);
  }

  .corporate-nav-item.active {
    color: var(--accent);
    background: rgba(6, 182, 212, 0.1);
    border: 1px solid rgba(6, 182, 212, 0.3);
  }

  .corporate-nav-item .badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: var(--danger);
    color: var(--white);
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
    font-weight: 700;
  }

  .corporate-user-menu {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .user-profile {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 25px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .user-profile:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(6, 182, 212, 0.5);
  }

  .user-avatar {
    width: 32px;
    height: 32px;
    background: var(--gradient-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: var(--white);
    font-weight: 700;
  }

  .user-info {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .user-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--white);
    line-height: 1.2;
  }

  .user-role {
    font-size: 11px;
    color: var(--gray-light);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* ===== SIDEBAR EMPRESARIAL ===== */
  .corporate-sidebar {
    position: fixed;
    left: 0;
    top: 70px;
    width: 280px;
    height: calc(100vh - 70px);
    background: linear-gradient(180deg, #1a202c 0%, #2d3748 100%);
    border-right: 2px solid rgba(6, 182, 212, 0.3);
    overflow-y: auto;
    z-index: 999;
    transition: all 0.3s ease;
  }

  .sidebar-section {
    padding: 20px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .sidebar-section:last-child {
    border-bottom: none;
  }

  .sidebar-section-title {
    padding: 0 25px 15px 25px;
    font-size: 12px;
    font-weight: 700;
    color: var(--gray-light);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .sidebar-menu {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .sidebar-menu-item {
    margin: 0;
  }

  .sidebar-menu-link {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 25px;
    color: var(--gray-light);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
    border-left: 3px solid transparent;
  }

  .sidebar-menu-link:hover {
    color: var(--white);
    background: rgba(255, 255, 255, 0.05);
    border-left-color: rgba(6, 182, 212, 0.5);
  }

  .sidebar-menu-link.active {
    color: var(--accent);
    background: rgba(6, 182, 212, 0.1);
    border-left-color: var(--accent);
  }

  .sidebar-menu-link i {
    font-size: 18px;
    width: 20px;
    text-align: center;
  }

  .sidebar-menu-link .menu-badge {
    margin-left: auto;
    background: var(--gradient-secondary);
    color: var(--white);
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
    font-weight: 700;
  }

  .sidebar-menu-link .menu-arrow {
    margin-left: auto;
    font-size: 12px;
    transition: transform 0.3s ease;
  }

  .sidebar-menu-link:hover .menu-arrow {
    transform: rotate(90deg);
  }

  /* ===== CONTENIDO PRINCIPAL EMPRESARIAL ===== */
  .corporate-main-content {
    margin-left: 280px;
    margin-top: 70px;
    padding: 30px;
    min-height: calc(100vh - 70px);
    background: linear-gradient(135deg, #0f1419 0%, #1a202c 100%);
  }

  .corporate-page-header {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 30px;
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
  }

  .corporate-page-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .page-header-content {
    position: relative;
    z-index: 2;
  }

  .page-title {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--white);
    margin: 0 0 10px 0;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .page-subtitle {
    font-size: 1.1rem;
    color: var(--gray-light);
    margin: 0 0 25px 0;
    line-height: 1.6;
  }

  .page-actions {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }

  .corporate-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    position: relative;
    overflow: hidden;
  }

  .corporate-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  .corporate-btn:hover::before {
    left: 100%;
  }

  .corporate-btn.primary {
    background: var(--gradient-primary);
    color: var(--white);
    box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
  }

  .corporate-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
  }

  .corporate-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: var(--white);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .corporate-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(6, 182, 212, 0.5);
  }

  .corporate-btn.success {
    background: var(--gradient-accent);
    color: var(--white);
    box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
  }

  .corporate-btn.success:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
  }

  /* ===== DASHBOARD EJECUTIVO ===== */
  .executive-dashboard {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
  }

  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }

  .kpi-card {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    backdrop-filter: blur(20px);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .kpi-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .kpi-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    border-color: rgba(6, 182, 212, 0.3);
  }

  .kpi-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .kpi-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: var(--white);
  }

  .kpi-icon.primary { background: var(--gradient-primary); }
  .kpi-icon.success { background: var(--gradient-accent); }
  .kpi-icon.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .kpi-icon.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }

  .kpi-trend {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 12px;
  }

  .kpi-trend.positive {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
  }

  .kpi-trend.negative {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
  }

  .kpi-value {
    font-size: 2.2rem;
    font-weight: 800;
    color: var(--white);
    margin-bottom: 8px;
  }

  .kpi-label {
    font-size: 13px;
    color: var(--gray-light);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .kpi-chart {
    height: 50px;
    margin-top: 15px;
    background: linear-gradient(90deg, rgba(6, 182, 212, 0.2), rgba(37, 99, 235, 0.2));
    border-radius: 8px;
    position: relative;
    overflow: hidden;
  }

  .kpi-chart::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent 0%, rgba(6, 182, 212, 0.3) 50%, transparent 100%);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* ===== PANEL DE ACTIVIDAD ===== */
  .activity-panel {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    backdrop-filter: blur(20px);
    height: fit-content;
  }

  .activity-panel-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .activity-panel-header i {
    font-size: 20px;
    color: var(--accent);
  }

  .activity-panel-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--white);
    margin: 0;
  }

  .activity-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .activity-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 15px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: var(--white);
    flex-shrink: 0;
  }

  .activity-icon.create { background: var(--gradient-accent); }
  .activity-icon.update { background: var(--gradient-primary); }
  .activity-icon.delete { background: linear-gradient(135deg, #ef4444, #dc2626); }
  .activity-icon.export { background: linear-gradient(135deg, #f59e0b, #d97706); }

  .activity-content {
    flex: 1;
  }

  .activity-text {
    font-size: 13px;
    color: var(--white);
    margin: 0 0 5px 0;
    line-height: 1.4;
  }

  .activity-time {
    font-size: 11px;
    color: var(--gray-light);
    font-weight: 500;
  }

  /* ===== RESPONSIVE EMPRESARIAL ===== */
  @media (max-width: 1200px) {
    .corporate-sidebar {
      transform: translateX(-100%);
    }
    
    .corporate-main-content {
      margin-left: 0;
    }
    
    .executive-dashboard {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .corporate-header {
      padding: 0 20px;
    }
    
    .corporate-nav {
      display: none;
    }
    
    .corporate-main-content {
      padding: 20px;
    }
    
    .kpi-grid {
      grid-template-columns: 1fr;
    }
    
    .page-actions {
      flex-direction: column;
    }
  }

  /* ===== ELEMENTOS INTERACTIVOS EMPRESARIALES ===== */
  .interactive-element {
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .interactive-element:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  }

  /* ===== SISTEMA DE PROCESAMIENTO AVANZADO ===== */
  
  /* ===== OVERLAY DE PROCESAMIENTO ===== */
  .processing-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(20px);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.5s ease;
  }

  .processing-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .processing-container {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(6, 182, 212, 0.3);
    border-radius: 24px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    text-align: center;
    backdrop-filter: blur(20px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    position: relative;
    overflow: hidden;
  }

  .processing-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .processing-header {
    margin-bottom: 30px;
  }

  .processing-icon {
    width: 80px;
    height: 80px;
    background: var(--gradient-accent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    font-size: 36px;
    color: var(--white);
    animation: spin 2s linear infinite;
    box-shadow: 0 0 30px rgba(6, 182, 212, 0.5);
  }

  .processing-title {
    font-size: 2rem;
    font-weight: 800;
    color: var(--white);
    margin: 0 0 10px 0;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .processing-subtitle {
    font-size: 1.1rem;
    color: var(--gray-light);
    margin: 0;
  }

  /* ===== BARRA DE PROGRESO AVANZADA ===== */
  .progress-container {
    margin: 30px 0;
    position: relative;
  }

  .progress-bar {
    width: 100%;
    height: 12px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .progress-fill {
    height: 100%;
    background: var(--gradient-accent);
    border-radius: 6px;
    width: 0%;
    transition: width 0.5s ease;
    position: relative;
    overflow: hidden;
    overflow: hidden;
  }

  .progress-fill::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
  }

  .progress-text {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    color: var(--white);
    font-weight: 600;
  }

  .progress-percentage {
    font-size: 1.2rem;
    color: var(--accent);
  }

  .progress-count {
    font-size: 1rem;
    color: var(--gray-light);
  }

  /* ===== ESTADO DEL PROCESAMIENTO ===== */
  .processing-status {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 20px;
    margin: 25px 0;
    text-align: left;
  }

  .status-item {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .status-item:last-child {
    margin-bottom: 0;
  }

  .status-item.active {
    background: rgba(6, 182, 212, 0.1);
    border: 1px solid rgba(6, 182, 212, 0.3);
  }

  .status-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: var(--white);
    flex-shrink: 0;
  }

  .status-icon.pending { background: var(--gray); }
  .status-icon.processing { background: var(--accent); animation: pulse 1.5s infinite; }
  .status-icon.completed { background: var(--success); }
  .status-icon.error { background: var(--danger); }

  .status-text {
    flex: 1;
    color: var(--white);
    font-size: 14px;
    font-weight: 500;
  }

  .status-time {
    color: var(--gray-light);
    font-size: 12px;
    font-weight: 400;
  }

  /* ===== MODO TURBO MEJORADO ===== */
  .turbo-mode {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2));
    border: 2px solid rgba(245, 158, 11, 0.4);
    border-radius: 16px;
    padding: 20px;
    margin: 20px 0;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .turbo-mode::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(245, 158, 11, 0.1), transparent);
    animation: slideInLeft 2s ease-in-out infinite;
  }

  .turbo-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .turbo-icon {
    font-size: 24px;
    color: #f59e0b;
    animation: pulse 1s infinite;
  }

  .turbo-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #f59e0b;
    margin: 0;
  }

  .turbo-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 15px;
  }

  .turbo-feature {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--white);
    font-size: 13px;
    font-weight: 500;
  }

  .turbo-feature i {
    color: #f59e0b;
    font-size: 14px;
  }

  /* ===== RECURSOS DEL SISTEMA ===== */
  .system-resources {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin: 25px 0;
    flex-wrap: wrap;
  }

  .resource-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--white);
    font-size: 13px;
    font-weight: 500;
  }

  .resource-icon {
    color: var(--accent);
    font-size: 14px;
  }

  /* ===== BOTONES DE CONTROL ===== */
  .processing-controls {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 30px;
    flex-wrap: wrap;
  }

  .control-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .control-btn.primary {
    background: var(--gradient-primary);
    color: var(--white);
  }

  .control-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
  }

  .control-btn.danger {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: var(--white);
    color: var(--white);
  }

  .control-btn.danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
  }

  .control-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: var(--white);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .control-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(6, 182, 212, 0.5);
  }

  .corporate-btn.info {
    background: linear-gradient(135deg, #06b6d4, #0891b2);
    color: var(--white);
  }

  .corporate-btn.info:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
  }

  /* ===== ANIMACIONES DE PROCESAMIENTO ===== */
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  @keyframes slideInLeft {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* ===== ESTADOS DE ERROR Y ÉXITO ===== */
  .processing-success {
    border-color: var(--success);
    background: rgba(16, 185, 129, 0.1);
  }

  .processing-error {
    border-color: var(--danger);
    background: rgba(239, 68, 68, 0.1);
  }

  .processing-warning {
    border-color: var(--warning);
    background: rgba(245, 158, 11, 0.1);
  }

  /* ===== RESPONSIVE PARA PROCESAMIENTO ===== */
  @media (max-width: 768px) {
    .processing-container {
      padding: 30px 20px;
      margin: 20px;
    }
    
    .processing-title {
      font-size: 1.5rem;
    }
    
    .turbo-features {
      grid-template-columns: 1fr;
    }
    
    .system-resources {
      flex-direction: column;
      align-items: center;
    }
    
    .processing-controls {
      flex-direction: column;
      align-items: center;
    }
  }

  /* Indicadores de estado */
  .status-indicator {
    position: relative;
  }

  .status-indicator::after {
    content: '';
    position: absolute;
    top: -2px;
    right: -2px;
    width: 8px;
    height: 8px;
    background: var(--success);
    border-radius: 50%;
    border: 2px solid var(--white);
    animation: pulse 2s infinite;
  }

  /* Mejoras para formularios */
  .form-card:hover .form-card-header i {
    transform: scale(1.1) rotate(5deg);
    color: var(--accent);
  }

  /* Mejoras para tablas */
  .table-container-modern:hover {
    border-color: rgba(6, 182, 212, 0.3);
  }

  /* Mejoras para botones */
  .btn-modern:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.3);
  }

  /* Mejoras para inputs */
  .input-modern:focus {
    transform: translateY(-1px);
  }

  /* Efectos de carga */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(15, 23, 42, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    backdrop-filter: blur(10px);
  }

  .loading-spinner {
    width: 60px;
    height: 60px;
    border: 4px solid rgba(255, 255, 255, 0.1);
    border-top: 4px solid var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  /* Tooltips mejorados */
  .tooltip {
    position: relative;
    display: inline-block;
  }

  .tooltip .tooltiptext {
    visibility: hidden;
    width: 200px;
    background-color: rgba(15, 23, 42, 0.95);
    color: var(--white);
    text-align: center;
    border-radius: 8px;
    padding: 10px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  .tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
  }

  /* Scrollbar personalizado para Firefox */
  * {
    scrollbar-width: thin;
    scrollbar-color: var(--accent) rgba(15, 23, 42, 0.8);
  }

  /* Selección de texto personalizada */
  ::selection {
    background: rgba(6, 182, 212, 0.3);
    color: var(--white);
  }

  ::-moz-selection {
    background: rgba(6, 182, 212, 0.3);
    color: var(--white);
  }

  /* Mejoras para dispositivos táctiles */
  @media (hover: none) and (pointer: coarse) {
    .btn-modern:hover {
      transform: none;
    }
    
    .form-card:hover {
      transform: none;
    }
    
    .metric-card:hover {
      transform: none;
    }
  }

  /* Optimizaciones de rendimiento */
  .hardware-accelerated {
    transform: translateZ(0);
    will-change: transform;
  }

  /* Estados de carga para botones */
  .btn-loading {
    position: relative;
    color: transparent !important;
  }

  .btn-loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid transparent;
    border-top: 2px solid var(--white);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}


.table-container {
  max-width: 100vw;
  overflow-x: auto;
  margin-bottom: 24px;
}
#tab-mismoTransporte .table-container {
  max-height: 60vh;
  overflow-y: auto;
}
#tab-mismoTransporte {
  overflow: visible !important;
}
#tab-mismoTransporte table {
  font-size: 13px;
  border-radius: 12px;
  background: #101a2a;
}
#tab-mismoTransporte th, #tab-mismoTransporte td {
  padding: 7px 10px;
  border-bottom: 1px solid #1e88e533;
  white-space: nowrap;
}
#tab-mismoTransporte th {
  background: #0b111f;
  color: #00e6ff;
  position: sticky;
  top: 0;
  z-index: 2;
}
#tab-mismoTransporte tr:hover {
  background: #1e88e522;
}
#tab-mismoTransporte .table-container {
  max-width: 100vw;
  overflow-x: auto;
  background: #101a2a;
  border-radius: 14px;
  border: 1.5px solid #00e6ff44;
  box-shadow: 0 2px 18px #00e6ff22;
  margin-bottom: 18px;
  padding: 0;
}
#tab-mismoTransporte table {
  font-size: 13px;
  border-radius: 12px;
  background: #101a2a;
  min-width: 1200px;
}
#tab-mismoTransporte th, #tab-mismoTransporte td {
  padding: 7px 10px;
  border-bottom: 1px solid #1e88e533;
  white-space: nowrap;
  text-align: center;
}
#tab-mismoTransporte th {
  background: #0b111f;
  color: #00e6ff;
  position: sticky;
  top: 0;
  z-index: 2;
  font-size: 13px;
  letter-spacing: 0.5px;
}
#tab-mismoTransporte tr:hover {
  background: #1e88e522;
}
#tab-mismoTransporte td:last-child {
  min-width: 120px;
  max-width: 140px;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
}
#tab-mismoTransporte button.btn-info {
  padding: 4px 10px;
  font-size: 12px;
  border-radius: 8px;
}
#tab-mismoTransporte .action-buttons {
  display: flex;
  gap: 12px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
#tab-mismoTransporte .enlaces-counter {
  margin-bottom: 8px;
  font-size: 1.08rem;
  color: #00e6ff;
  font-weight: 600;
}
#tab-mismoTransporte table {
  font-size: 13px;
  border-radius: 12px;
  background: #101a2a;
}
#tab-mismoTransporte th, #tab-mismoTransporte td {
  padding: 7px 10px;
  border-bottom: 1px solid #1e88e533;
  white-space: nowrap;
}
#tab-mismoTransporte th {
  background: #0b111f;
  color: #00e6ff;
  position: sticky;
  top: 0;
  z-index: 2;
}
#tab-mismoTransporte tr:hover {
  background: #1e88e522;
}
.fangio-video-wrapper {
  position: relative;
  width: 100%;
  max-width: 600px;
  aspect-ratio: 16/9;
  margin: 32px auto 0 auto;
  border-radius: 22px;
  overflow: hidden;
  box-shadow: 0 0 32px #00e6ff66, 0 2px 18px #00e6ff33;
  background: linear-gradient(135deg, #0b111f 60%, #1e88e5 100%);
  display: flex;
  align-items: center;
  justify-content: center;
}
.fangio-video-glow {
  position: absolute;
  inset: 0;
  border-radius: 22px;
  pointer-events: none;
  z-index: 1;
  box-shadow: 0 0 60px 10px #00e6ff88, 0 0 0 8px #00e6ff33 inset;
  animation: fangio-glow 2.5s infinite alternate;
}
@keyframes fangio-glow {
  0% { box-shadow: 0 0 60px 10px #00e6ff88, 0 0 0 8px #00e6ff33 inset; }
  100% { box-shadow: 0 0 90px 18px #00e6ffcc, 0 0 0 12px #00e6ff44 inset; }
}
.fangio-video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 22px;
  z-index: 2;
  background: #000;
  display: block;
}
@media (max-width: 700px) {
  .fangio-video-wrapper {
    max-width: 98vw;
    border-radius: 12px;
  }
  .fangio-video-glow {
    border-radius: 12px;
  }
  .fangio-video {
    border-radius: 12px;
  }
}
.video-hero-bg {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  max-width: 700px;
  margin: 40px auto 32px auto;
  background: linear-gradient(135deg, #101a2a 60%, #1e88e5 100%);
  border-radius: 24px;
  box-shadow: 0 8px 40px #00e6ff22, 0 2px 18px #00e6ff11;
  padding: 0;
  overflow: hidden;
}
.video-hero {
  width: 100%;
  aspect-ratio: 16/9;
  border-radius: 24px;
  object-fit: cover;
  display: block;
  box-shadow: 0 2px 24px #000a;
}
@media (max-width: 900px) {
  .video-hero-bg { max-width: 98vw; border-radius: 12px; }
  .video-hero { border-radius: 12px; }
}
.video-banner {
  width: 100%;
  max-width: 1200px;
  height: 280px;
  margin: 32px auto 32px auto;
  position: relative;
  overflow: hidden;
  border-radius: 0;
  box-shadow: none;
  background: #000;
  display: flex;
  align-items: center;
  justify-content: center;
}
.video-banner-video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 0;
  box-shadow: none;
  background: #000;
}
.video-banner-overlay {
  position: absolute;
  left: 0; top: 0; width: 100%; height: 100%;
  display: flex; align-items: center; justify-content: center;
  color: #fff;
  font-size: 2.2rem;
  font-weight: 800;
  background: rgba(0,0,0,0.18);
  text-shadow: 0 2px 16px #000;
  pointer-events: none;
}
@media (max-width: 900px) {
  .video-banner { height: 180px; }
  .video-banner-overlay { font-size: 1.2rem; }
}
.banner-hero {
  position: relative;
  width: 100%;
  min-height: 220px;
  max-height: 320px;
  height: 280px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  border-radius: 0 0 32px 32px;
  margin-bottom: 32px;
  background: none;
  box-shadow: 0 8px 40px #00e6ff22, 0 2px 18px #00e6ff11;
}
.banner-hero video {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  min-height: 220px;
  max-height: 320px;
  object-fit: cover;
  filter: blur(0.01px) brightness(0.95);
  opacity: 0.96;
  z-index: 0;
  border-radius: 0 0 32px 32px;
}
.banner-hero-overlay {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2;
  background: linear-gradient(120deg, rgba(11,17,31,0.55) 60%, rgba(30,136,229,0.18) 100%);
  pointer-events: none;
}

.banner-hero-content {
  display: flex;
  align-items: center;
  gap: 32px;
  z-index: 3;
  background: rgba(10,20,40,0.72);
  border-radius: 22px;
  padding: 32px 38px;
  box-shadow: 0 4px 32px #00e6ff22;
  pointer-events: auto;
  margin: 0 auto;
}
  
.banner-hero-logo {
  width: 90px;
  height: 90px;
  border-radius: 18px;
  background: rgba(15, 23, 42, 0.9);
  box-shadow: 0 2px 12px #00e6ff33;
  margin-right: 18px;
}
.banner-hero-title {
  font-size: 2.8rem;
  font-weight: 800;
  color: #00e6ff;
  text-shadow: 0 0 18px #00e6ff55, 0 2px 8px #1e88e5cc;
  margin: 0 0 10px 0;
  letter-spacing: 2px;
}
.banner-hero-subtitle {
  font-size: 1.3rem;
  color: #2196f3;
  font-weight: 600;
  margin-bottom: 10px;
  letter-spacing: 1px;
  text-shadow: 0 1px 8px #1e88e555;
}
.banner-hero-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(90deg, #00bcd4 60%, #1e88e5 100%);
  color: #fff;
  font-weight: 700;
  font-size: 1.08rem;
  padding: 12px 26px;
  border-radius: 14px;
  text-decoration: none;
  box-shadow: 0 2px 12px rgba(30,136,229,0.10);
  margin-top: 8px;
  transition: background 0.2s, box-shadow 0.2s, color 0.2s;
  border: none;
  outline: none;
}
.banner-hero-link:hover {
  background: linear-gradient(90deg, #1e88e5 60%, #00bcd4 100%);
  color: #fff;
  box-shadow: 0 4px 18px rgba(30,136,229,0.18);
  text-decoration: none;
}
@media (max-width: 900px) {
  .banner-hero {
    min-height: 120px;
    max-height: 180px;
    height: 160px;
    border-radius: 0 0 18px 18px;
  }
  .banner-hero-logo {
    margin: 0 0 10px 0;
  }
  .banner-hero-title {
    font-size: 1.7rem;
  }
  .banner-hero-subtitle {
    font-size: 1.05rem;
  }
  .banner-hero {
    min-height: 160px;
    max-height: 220px;
    border-radius: 0 0 18px 18px;
  }
  .banner-hero-video {
    min-height: 160px;
    max-height: 220px;
  }
}
.container {
  .container,
.fangio-header,
.fangio-header-decoration,
.banner-hero,
.banner-hero::before,
.banner-hero::after {
  background: none !important;
  box-shadow: none !important;
}
}
#toggleMismoTransporte {
  position: relative;
  font-weight: 700;
  border: 2.5px solid #00e6ff;
  background: linear-gradient(90deg, #00bcd4 60%, #1e88e5 100%);
  color: #fff;
  box-shadow: 0 2px 12px #00e6ff33;
  transition: background 0.2s, color 0.2s, border 0.2s, box-shadow 0.2s;
  outline: none;
  min-width: 320px;
  padding-right: 48px;
}
#toggleMismoTransporte.btn-outline-info {
  background: #0b111f;
  color: #00e6ff;
  border: 2.5px solid #00e6ff;
  box-shadow: none;
}
#toggleMismoTransporte.btn-info {
  background: linear-gradient(90deg, #00e6ff 60%, #00bcd4 100%);
  color: #0b111f;
  border: 2.5px solid #00e6ff;
  box-shadow: 0 4px 18px #00e6ff44;
}
#toggleMismoTransporte .toggle-icon {
  position: absolute;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.5em;
  transition: color 0.2s;
}
#toggleMismoTransporte.btn-info .toggle-icon {
  color: #10b981;
  text-shadow: 0 0 8px #10b98188;
}
#toggleMismoTransporte.btn-outline-info .toggle-icon {
  color: #888;
  text-shadow: none;
}
button, .tab-button, .btn {
  transition: background 0.2s, color 0.2s, box-shadow 0.2s, transform 0.15s;
}
button:hover, .tab-button:hover, .btn:hover {
  transform: translateY(-2px) scale(1.03);
}
.badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 0.95em;
  font-weight: 700;
  color: #fff;
}
.badge-factible { background: #10b981; }
.badge-nofactible { background: #ef4444; }
.badge-indef { background: #f59e42; }
body.modo-claro {
  background: #f5f7fa;
  color: #222;
}
body.modo-claro .main-content,
body.modo-claro .table-container {
  background: #fff !important;
  color: #222 !important;
}
body.modo-claro .badge-factible { background: #059669; }
body.modo-claro .badge-nofactible { background: #dc2626; }
body.modo-claro .badge-indef { background: #f59e42; }

    /* ===== ESTILOS MODERNOS COMPLETOS ===== */
    
    /* Header y Logo Modernizados */
    .logo-container-modern {
      position: relative;
      display: inline-block;
    }
    
    .logo-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, rgba(0, 230, 255, 0.3) 0%, transparent 70%);
      border-radius: 50%;
      animation: logoGlow 3s ease-in-out infinite alternate;
    }
    
    @keyframes logoGlow {
      0% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.2); }
    }
    
    .title-container-modern {
      text-align: center;
    }
    
    .title-text {
      position: relative;
      display: inline-block;
    }
    
    .title-underline {
      width: 0;
      height: 3px;
      background: linear-gradient(90deg, #00e6ff, #f59e42);
      margin: 10px auto 0;
      border-radius: 2px;
      animation: titleUnderline 2s ease-out forwards;
    }
    
    @keyframes titleUnderline {
      to { width: 100%; }
    }
    
    .banner-hero-link {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 25px;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .banner-hero-link:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 230, 255, 0.3);
    }
    
    .link-arrow {
      font-size: 18px;
      transition: transform 0.3s ease;
    }
    
    .banner-hero-link:hover .link-arrow {
      transform: translateX(5px);
    }
    
    /* Navegación Modernizada */
      /* ===== NAVEGACIÓN MODERNA ===== */
    .navigation-container-modern {
    margin: 32px 0;
    padding: 30px;
    background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(51, 65, 85, 0.8) 100%);
    border-radius: 20px;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(37, 99, 235, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(37, 99, 235, 0.1);
    position: relative;
    overflow: hidden;
  }

  .navigation-container-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  /* ===== BARRA DE ESTADO ===== */
  .system-status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    background: linear-gradient(135deg, rgba(37, 99, 235, 0.15) 0%, rgba(6, 182, 212, 0.1) 100%);
    border-radius: 15px;
    margin-bottom: 30px;
    border: 1px solid rgba(37, 99, 235, 0.3);
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(37, 99, 235, 0.1);
  }

  .system-status-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(37, 99, 235, 0.05) 50%, 
      transparent 100%);
    animation: slideInLeft 2s ease-in-out infinite;
  }

  .status-indicator {
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 2;
  }

  .status-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  .status-dot.online {
    background: var(--success);
    box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
  }

  .status-text {
    color: var(--white);
    font-weight: 600;
    font-size: 15px;
  }

  .status-info {
    display: flex;
    gap: 25px;
    align-items: center;
    z-index: 2;
  }

  .version-info {
    background: var(--gradient-secondary);
    color: var(--white);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    border: none;
    box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
  }

  .last-update {
    color: var(--gray-light);
    font-size: 13px;
  }

  .last-update span {
    color: var(--accent);
    font-weight: 600;
  }

  /* ===== NAVEGACIÓN DE PESTAÑAS ===== */
  .tab-navigation {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    position: relative;
    z-index: 2;
  }

  .tab-button-modern {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 20px 25px;
    background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    color: var(--white);
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    min-width: 160px;
    overflow: hidden;
  }

  .tab-button-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
      rgba(37, 99, 235, 0.1), 
      rgba(124, 58, 237, 0.1));
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .tab-button-modern:hover::before {
    opacity: 1;
  }

  .tab-button-modern:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    border-color: rgba(37, 99, 235, 0.5);
  }

  .tab-button-modern.active {
    background: linear-gradient(135deg, 
      rgba(37, 99, 235, 0.2), 
      rgba(124, 58, 237, 0.2));
    border-color: rgba(37, 99, 235, 0.8);
    box-shadow: 0 0 30px rgba(37, 99, 235, 0.3);
    transform: translateY(-2px);
  }

  .tab-icon {
    position: relative;
    font-size: 28px;
    color: var(--accent);
    z-index: 2;
    transition: all 0.3s ease;
  }

  .tab-button-modern:hover .tab-icon {
    color: var(--primary);
    transform: scale(1.1);
  }

  .tab-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: var(--gradient-secondary);
    color: var(--white);
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 12px;
    min-width: 20px;
    text-align: center;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(124, 58, 237, 0.4);
  }

  .tab-text {
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    z-index: 2;
    transition: color 0.3s ease;
  }

  .tab-button-modern:hover .tab-text {
    color: var(--primary);
  }

  .tab-indicator {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 3px;
    background: var(--gradient-accent);
    border-radius: 2px;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .tab-button-modern.active .tab-indicator {
    width: 80%;
    }
    
    /* Barra de Estado del Sistema */
    .system-status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: rgba(0, 230, 255, 0.1);
      border-radius: 10px;
      margin-bottom: 20px;
      border: 1px solid rgba(0, 230, 255, 0.2);
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    .status-dot.online {
      background: #10b981;
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    .status-text {
      color: white;
      font-weight: 600;
      font-size: 14px;
    }
    
    .status-info {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    
    .version-info {
      background: rgba(245, 158, 66, 0.2);
      color: #f59e42;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid rgba(245, 158, 66, 0.3);
    }
    
    .last-update {
      color: rgba(255, 255, 255, 0.7);
      font-size: 12px;
    }
    
    .last-update span {
      color: #00e6ff;
      font-weight: 600;
    }
    
    .tab-navigation {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .tab-button-modern {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 15px 20px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      min-width: 140px;
    }
    
    .tab-button-modern:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border-color: rgba(0, 230, 255, 0.5);
    }
    
    .tab-button-modern.active {
      background: linear-gradient(135deg, rgba(0, 230, 255, 0.2), rgba(245, 158, 66, 0.2));
      border-color: rgba(0, 230, 255, 0.8);
      box-shadow: 0 0 20px rgba(0, 230, 255, 0.3);
    }
    
    .tab-icon {
      position: relative;
      font-size: 24px;
      color: #00e6ff;
    }
    
    .tab-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #f59e42;
      color: white;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 10px;
      min-width: 18px;
      text-align: center;
    }
    
    .tab-text {
      font-size: 14px;
      font-weight: 500;
      text-align: center;
    }
    
    .tab-indicator {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 3px;
      background: linear-gradient(90deg, #00e6ff, #f59e42);
      border-radius: 2px;
      transition: width 0.3s ease;
    }
    
    .tab-button-modern.active .tab-indicator {
      width: 80%;
    }
    
      /* ===== BOTONES DE ACCIÓN ===== */
    .action-buttons-modern {
      display: flex;
      flex-direction: column;
    gap: 20px;
    align-items: center;
    margin-top: 25px;
  }

  .button-group-primary,
  .button-group-secondary,
  .button-group-utility {
    display: flex;
      gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
      align-items: center;
    }



  .btn-modern.btn-danger:hover {
    box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
  }

  .btn-modern.btn-info {
    background: linear-gradient(135deg, #06b6d4, #0891b2);
    box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
  }

  .btn-modern.btn-info:hover {
    box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
  }

  .btn-modern.btn-secondary {
    background: linear-gradient(135deg, #6b7280, #4b5563);
    box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
  }

  .btn-modern.btn-secondary:hover {
    box-shadow: 0 8px 25px rgba(107, 114, 128, 0.4);
  }

  .btn-modern.btn-toggle {
    background: var(--gradient-secondary);
    box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
    position: relative;
    padding-right: 60px;
  }

  .btn-modern.btn-toggle:hover {
    box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
  }

  .toggle-switch {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
  }

  .toggle-icon {
    font-size: 20px;
    transition: all 0.3s ease;
  }

  .btn-modern.btn-toggle:hover .toggle-icon {
    transform: scale(1.1);
    }
    
    .button-group-primary,
    .button-group-secondary,
    .button-group-utility {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    /* Botones Modernos */
    .btn-modern {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      overflow: hidden;
      text-decoration: none;
      color: white;
    }
    
    .btn-modern:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    .btn-modern:active {
      transform: translateY(0);
    }
    
    .btn-icon {
      font-size: 16px;
      z-index: 2;
    }
    
    .btn-text {
      z-index: 2;
      position: relative;
    }
    
    .btn-ripple {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transition: all 0.6s ease;
    }
    
    .btn-modern:hover .btn-ripple {
      width: 300px;
      height: 300px;
    }
    
    /* Variantes de Botones */
    .btn-modern.btn-primary {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    }
    
    .btn-modern.btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
    }
    
    .btn-modern.btn-warning {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }
    
    .btn-modern.btn-danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }
    
    .btn-modern.btn-info {
      background: linear-gradient(135deg, #06b6d4, #0891b2);
    }
    
    .btn-modern.btn-secondary {
      background: linear-gradient(135deg, #6b7280, #4b5563);
    }
    
    .btn-modern.btn-toggle {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    }
    
    .toggle-switch {
      margin-left: 10px;
    }
    
    /* Formulario Modernizado */
      /* ===== FORMULARIOS MODERNOS ===== */
    .form-grid-modern {
      display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 25px;
    margin: 30px 0;
  }

  .form-card {
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 30px;
    backdrop-filter: blur(20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  }

  .form-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-primary);
    z-index: 1;
  }

  .form-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    border-color: rgba(37, 99, 235, 0.3);
  }

  .form-card-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    z-index: 2;
  }

  .form-card-header i {
    font-size: 24px;
    color: var(--accent);
    background: rgba(6, 182, 212, 0.1);
    padding: 12px;
    border-radius: 12px;
    border: 1px solid rgba(6, 182, 212, 0.2);
  }

  .form-card-header h3 {
    margin: 0;
    color: var(--white);
    font-size: 1.3rem;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .form-card-content {
    display: grid;
    grid-template-columns: 1fr;
      gap: 20px;
    position: relative;
    z-index: 2;
  }

  .input-group-modern {
    position: relative;
  }

  .input-group-modern label {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    color: rgba(255, 255, 255, 0.9);
    font-size: 14px;
    font-weight: 600;
    transition: color 0.3s ease;
  }

  .input-group-modern label i {
    color: var(--accent);
    font-size: 16px;
    width: 20px;
    text-align: center;
  }

  .input-group-modern:hover label {
    color: var(--accent);
  }

  .input-modern {
    width: 100%;
    padding: 16px 20px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    color: var(--white);
    font-size: 15px;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
    position: relative;
  }

  .input-modern:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 25px rgba(6, 182, 212, 0.3);
    background: rgba(255, 255, 255, 0.12);
    transform: translateY(-2px);
  }

  .input-modern::placeholder {
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
  }

  .input-readonly {
    background: rgba(6, 182, 212, 0.1);
    border-color: rgba(6, 182, 212, 0.3);
    color: rgba(255, 255, 255, 0.9);
    font-weight: 600;
    cursor: not-allowed;
  }

  .input-highlight {
    background: rgba(245, 158, 11, 0.15);
    border-color: rgba(245, 158, 11, 0.4);
    color: #fbbf24;
    font-weight: 700;
    text-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
  }

  .input-focus-border {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 3px;
    background: var(--gradient-accent);
    border-radius: 2px;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .input-modern:focus + .input-focus-border {
    width: 100%;
    }
    
    .form-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    
    .form-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      border-color: rgba(0, 230, 255, 0.3);
    }
    
    .form-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .form-card-header i {
      font-size: 20px;
      color: #00e6ff;
    }
    
    .form-card-header h3 {
      margin: 0;
      color: white;
      font-size: 18px;
      font-weight: 600;
    }
    
    .form-card-content {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .input-group-modern {
      position: relative;
    }
    
    .input-group-modern label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      color: rgba(255, 255, 255, 0.9);
      font-size: 14px;
      font-weight: 500;
    }
    
    .input-group-modern label i {
      color: #00e6ff;
      font-size: 14px;
    }
    
    .input-modern {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 14px;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }
    
    .input-modern:focus {
      outline: none;
      border-color: #00e6ff;
      box-shadow: 0 0 15px rgba(0, 230, 255, 0.3);
      background: rgba(255, 255, 255, 0.15);
    }
    
    .input-modern::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    .input-readonly {
      background: rgba(0, 230, 255, 0.1);
      border-color: rgba(0, 230, 255, 0.3);
      color: rgba(255, 255, 255, 0.8);
    }
    
    .input-highlight {
      background: rgba(245, 158, 66, 0.2);
      border-color: rgba(245, 158, 66, 0.5);
      color: #f59e42;
      font-weight: 600;
    }
    
    .input-focus-border {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #00e6ff, #f59e42);
      transition: width 0.3s ease;
    }
    
    .input-modern:focus + .input-focus-border {
      width: 100%;
    }
    
    /* Tabla de Enlaces Modernizada */
    .enlaces-header-modern {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .enlaces-title-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .enlaces-title {
      display: flex;
      align-items: center;
      gap: 15px;
      color: white;
      margin: 0;
    }
    
    .enlaces-title i {
      font-size: 28px;
      color: #00e6ff;
    }
    
    .enlaces-title .title-underline {
      width: 0;
      height: 3px;
      background: linear-gradient(90deg, #00e6ff, #f59e42);
      border-radius: 2px;
      animation: titleUnderline 2s ease-out forwards;
    }
    
    .enlaces-stats {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      min-width: 80px;
    }
    
    .stat-item i {
      font-size: 20px;
      color: #00e6ff;
    }
    
    .stat-item span {
      font-size: 24px;
      font-weight: 700;
      color: white;
    }
    
    .stat-item label {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .enlaces-controls-modern {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
      /* ===== TABLAS MODERNAS ===== */
    .table-container-modern {
    background: rgba(15, 23, 42, 0.9);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    position: relative;
  }

  .table-container-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .table-wrapper {
    overflow-x: auto;
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  /* ===== ESTILOS DE TABLA ===== */
  table {
    border-collapse: collapse;
    width: 100%;
    background: transparent;
    color: var(--white);
    font-size: 14px;
  }

  th, td {
    padding: 16px 20px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
  }

  th {
    background: rgba(37, 99, 235, 0.15);
    color: var(--accent);
    font-weight: 700;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
    z-index: 10;
    backdrop-filter: blur(10px);
  }

  th i {
    margin-right: 8px;
    color: var(--accent);
  }

  tr {
    transition: all 0.3s ease;
    position: relative;
  }

  tr:hover {
    background: rgba(37, 99, 235, 0.1);
    transform: scale(1.01);
    box-shadow: 0 4px 20px rgba(37, 99, 235, 0.2);
  }

  tr.selected {
    background: linear-gradient(135deg, 
      rgba(37, 99, 235, 0.2), 
      rgba(6, 182, 212, 0.2)) !important;
    color: var(--white) !important;
    box-shadow: 0 0 20px rgba(37, 99, 235, 0.3);
  }

  /* ===== BADGES MODERNOS ===== */
  .badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--white);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
  }

  .badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  }

  .badge-factible { 
    background: var(--gradient-accent);
    box-shadow: 0 2px 8px rgba(6, 182, 212, 0.3);
  }

  .badge-nofactible { 
    background: linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
  }

  .badge-indef { 
    background: linear-gradient(135deg, #f59e0b, #d97706);
    box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }
    
    .table-wrapper {
      overflow-x: auto;
      border-radius: 10px;
    }
    
    /* Estado Vacío Modernizado */
    .mensaje-sin-enlaces-modern {
      text-align: center;
      padding: 60px 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      border: 2px dashed rgba(255, 255, 255, 0.2);
      margin: 40px 0;
      backdrop-filter: blur(10px);
    }
    
    .empty-state-icon {
      font-size: 80px;
      color: rgba(0, 230, 255, 0.5);
      margin-bottom: 20px;
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .empty-state-title {
      color: white;
      font-size: 24px;
      margin: 0 0 15px 0;
      font-weight: 600;
    }
    
    .empty-state-description {
      color: rgba(255, 255, 255, 0.7);
      font-size: 16px;
      margin: 0 0 30px 0;
      line-height: 1.5;
    }
    
      /* ===== ESTADO VACÍO MODERNO ===== */
  .mensaje-sin-enlaces-modern {
    text-align: center;
    padding: 80px 40px;
    background: rgba(15, 23, 42, 0.8);
    border-radius: 24px;
    border: 2px dashed rgba(255, 255, 255, 0.2);
    margin: 50px 0;
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
  }

  .mensaje-sin-enlaces-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-accent);
    z-index: 1;
  }

  .empty-state-icon {
    font-size: 100px;
    color: rgba(6, 182, 212, 0.3);
    margin-bottom: 30px;
    animation: float 4s ease-in-out infinite;
    position: relative;
    z-index: 2;
  }

  .empty-state-title {
    color: var(--white);
    font-size: 2rem;
    margin: 0 0 20px 0;
    font-weight: 700;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    z-index: 2;
  }

  .empty-state-description {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1.1rem;
    margin: 0 0 40px 0;
    line-height: 1.6;
    position: relative;
    z-index: 2;
  }

  /* ===== RESPONSIVE DESIGN ===== */
  @media (max-width: 1200px) {
      .form-grid-modern {
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }
      
    .banner-hero-content {
        flex-direction: column;
        text-align: center;
      gap: 25px;
    }
    
    .banner-hero-title {
      font-size: 2.5rem;
    }
  }

  @media (max-width: 768px) {
    .container {
      padding: 15px;
    }
    
    .banner-hero {
      min-height: 200px;
      max-height: 280px;
      height: 250px;
      border-radius: 16px;
    }
    
    .banner-hero-content {
      padding: 25px 30px;
      gap: 20px;
    }
    
    .banner-hero-title {
      font-size: 2rem;
    }
    
    .banner-hero-subtitle {
      font-size: 1.1rem;
    }
    
    .banner-hero-logo {
      width: 70px;
      height: 70px;
    }
    
    .form-grid-modern {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .form-card {
      padding: 20px;
    }
    
    .navigation-container-modern {
      padding: 20px;
      margin: 20px 0;
      }
      
      .tab-navigation {
        flex-direction: column;
        align-items: center;
      gap: 15px;
    }
    
    .tab-button-modern {
      min-width: 140px;
      padding: 18px 20px;
    }
    
    .enlaces-title-section {
      flex-direction: column;
      text-align: center;
      gap: 20px;
    }
    
    .enlaces-stats {
      justify-content: center;
      gap: 15px;
      }
      
      .button-group-primary,
      .button-group-secondary,
      .button-group-utility {
        flex-direction: column;
        align-items: center;
      gap: 12px;
    }
    
    .btn-modern {
      min-width: 160px;
      padding: 14px 20px;
    }
    
    .frecuencia-rules {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .rule-item {
      padding: 15px;
    }
    
    .table-container-modern {
      padding: 15px;
    }
    
    th, td {
      padding: 12px 15px;
      font-size: 13px;
    }
  }

  @media (max-width: 480px) {
    .banner-hero-title {
      font-size: 1.8rem;
    }
    
    .banner-hero-subtitle {
      font-size: 1rem;
    }
    
    .banner-hero-logo {
      width: 60px;
      height: 60px;
    }
    
    .form-card {
      padding: 15px;
    }
    
    .input-modern {
      padding: 14px 16px;
      font-size: 14px;
    }
    
    .btn-modern {
      min-width: 140px;
      padding: 12px 18px;
      font-size: 14px;
      }
    }
    
    /* Animaciones de Entrada */
    .form-card,
    .enlaces-header-modern,
    .table-container-modern {
      animation: slideInUp 0.6s ease-out;
    }
    
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Efectos de Hover Mejorados */
    .form-card:hover,
    .enlaces-header-modern:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }
    
    /* Transiciones Suaves */
    * {
      transition: all 0.3s ease;
    }
    
    /* Footer Profesional */
    .footer-modern {
      background: linear-gradient(135deg, rgba(11, 17, 31, 0.95), rgba(30, 136, 229, 0.1));
      border-top: 1px solid rgba(0, 230, 255, 0.2);
      margin-top: 60px;
      padding: 40px 0 20px 0;
      backdrop-filter: blur(10px);
    }
    
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 40px;
      padding: 0 20px;
    }
    
    .footer-section {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .footer-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      color: #00e6ff;
    }
    
    .footer-logo i {
      font-size: 28px;
      color: #00e6ff;
    }
    
    .footer-description {
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.6;
      font-size: 14px;
    }
    
    .footer-title {
      color: white;
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 15px 0;
      border-bottom: 2px solid rgba(0, 230, 255, 0.3);
      padding-bottom: 8px;
    }
    
    .footer-features {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .footer-features li {
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
    }
    
    .footer-features li i {
      color: #10b981;
      font-size: 12px;
    }
    
    .footer-info {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .info-item {
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
    }
    
    .info-item i {
      color: #00e6ff;
      font-size: 14px;
      width: 16px;
    }
    
    .footer-bottom {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 30px;
      padding: 20px 20px 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .footer-copyright {
      display: flex;
      align-items: center;
      gap: 8px;
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
    }
    
    .footer-copyright i {
      color: #00e6ff;
    }
    
    .footer-links {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .footer-link {
      display: flex;
      align-items: center;
      gap: 8px;
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      font-size: 14px;
      padding: 8px 16px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .footer-link:hover {
      background: rgba(0, 230, 255, 0.1);
      border-color: rgba(0, 230, 255, 0.3);
      color: #00e6ff;
      transform: translateY(-2px);
    }
    
    .footer-link i {
      font-size: 14px;
    }
    
    /* Responsive Footer */
    @media (max-width: 768px) {
      .footer-content {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      
      .footer-bottom {
        flex-direction: column;
        text-align: center;
      }
      
      .footer-links {
        justify-content: center;
      }
    }

  </style>
</head>
<body> 
  <script>
if (localStorage.getItem('fangioSesion') !== 'activa') {
  window.location.href = 'login.html';
}
</script>



<script>
function importarArchivoPathloss() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.pl5,.csv';
  
  input.onchange = async function(e) {
    const file = e.target.files[0];
    if (!file) return;

    try {
      if (file.name.endsWith('.csv')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const text = e.target.result;
          const lines = text.split('\n');
          processPathlossCSV(lines);
        };
        reader.readAsText(file);
      } else if (file.name.endsWith('.pl5')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const buffer = e.target.result;
          processPathlossFile(buffer);
        };
        reader.readAsArrayBuffer(file);
      }
    } catch (error) {
      console.error('Error al importar archivo:', error);
      alert('Error al importar el archivo. Verifica el formato.');
    }
  };

  input.click();
}

function processPathlossCSV(lines) {

  try {
    lines.forEach(line => {
      const columns = line.split(',');
    });
    alert('Archivo CSV importado correctamente');
  } catch (error) {
    alert('Error al procesar el archivo CSV');
  }
}

function processPathlossFile(buffer) {
  alert('El formato .pl5 aún no está soportado. Por favor usa archivos CSV.');
}

let factorK = 4/3;
function setFactorK(nuevoK) {
  factorK = parseFloat(nuevoK) || 4/3;
  alert('Nuevo factor K aplicado: ' + factorK);
}

function abrirPanelParametrosRadio() {
  document.getElementById('modal-parametros-radio').style.display = 'flex';
}
function cerrarPanelParametrosRadio() {
  document.getElementById('modal-parametros-radio').style.display = 'none';
}
function calcularParametrosRadio() {
  const pt = parseFloat(document.getElementById('potenciaTX').value);
  const ga = parseFloat(document.getElementById('gananciaA').value);
  const gb = parseFloat(document.getElementById('gananciaB').value);
  const l = parseFloat(document.getElementById('perdidas').value);
  const fade = parseFloat(document.getElementById('fadeMargin').value);
  const distancia = parseFloat(document.getElementById('distanciaRadio').value);
  const frecuencia = parseFloat(document.getElementById('frecuenciaRadio').value);
  if (isNaN(pt) || isNaN(ga) || isNaN(gb) || isNaN(l) || isNaN(fade) || isNaN(distancia) || isNaN(frecuencia)) {
    document.getElementById('resultado-parametros-radio').innerHTML = '<span style="color:#ef4444;">Datos incompletos</span>';
    return;
  }
  const Lfs = 92.45 + 20 * Math.log10(distancia) + 20 * Math.log10(frecuencia);
  const pr = pt + ga + gb - Lfs - l;
  document.getElementById('resultado-parametros-radio').innerHTML =
    `<b>Pérdida espacio libre:</b> ${Lfs.toFixed(2)} dB<br>
     <b>Potencia recibida:</b> ${pr.toFixed(2)} dBm<br>
     <b>Margen de desvanecimiento:</b> ${fade} dB<br>
     <b>Margen total:</b> ${(pr - fade).toFixed(2)} dBm`;
}
let equiposAntenas = [];
function abrirPanelEquiposAntenas() {
  document.getElementById('modal-equipos-antenas').style.display = 'flex';
  mostrarListaEquiposAntenas();
}
function cerrarPanelEquiposAntenas() {
  document.getElementById('modal-equipos-antenas').style.display = 'none';
}
function guardarEquipoAntena() {
  const modeloRadio = document.getElementById('modeloRadio').value.trim();
  const modeloAntena = document.getElementById('modeloAntena').value.trim();
  const ganancia = parseFloat(document.getElementById('gananciaAntena').value);
  if (!modeloRadio || !modeloAntena || isNaN(ganancia)) {
    alert('Completa todos los campos.');
    return;
  }
  equiposAntenas.push({ modeloRadio, modeloAntena, ganancia });
  mostrarListaEquiposAntenas();
}
function mostrarListaEquiposAntenas() {
  const div = document.getElementById('lista-equipos-antenas');
  if (!equiposAntenas.length) {
    div.innerHTML = '<i>No hay equipos registrados.</i>';
    return;
  }
  div.innerHTML = '<ul>' + equiposAntenas.map(eq =>
    `<li><b>${eq.modeloRadio}</b> - ${eq.modeloAntena} (${eq.ganancia} dBi)</li>`
  ).join('') + '</ul>';
}
// ===== FUNCIONES DEL DASHBOARD INTERACTIVO =====

function mostrarDetalleMetrica(tipo) {
  let mensaje = '';
  let titulo = '';
  
  switch(tipo) {
    case 'total':
      titulo = 'Total de Enlaces';
      mensaje = `Actualmente tienes ${document.getElementById('metric-total-enlaces').textContent} enlaces registrados en tu base de datos.`;
      break;
    case 'factibles':
      titulo = 'Enlaces Factibles';
      mensaje = `De todos los enlaces, ${document.getElementById('metric-enlaces-factibles').textContent} son técnicamente viables.`;
      break;
    case 'no-factibles':
      titulo = 'Enlaces No Factibles';
      mensaje = `Hay ${document.getElementById('metric-enlaces-no-factibles').textContent} enlaces que requieren atención técnica.`;
      break;
    case 'cobertura':
      titulo = 'Cobertura de Red';
      mensaje = `Tu red tiene una cobertura del ${document.getElementById('metric-cobertura').textContent}.`;
      break;
  }
  
  mostrarNotificacion(titulo, mensaje, 'info');
}

// ===== FUNCIONES DEL MAPA AVANZADO =====

function cambiarVistaMapa(vista) {
  // Remover clase active de todos los botones
  document.querySelectorAll('.map-control-btn').forEach(btn => btn.classList.remove('active'));
  
  // Agregar clase active al botón clickeado
  event.target.closest('.map-control-btn').classList.add('active');
  
  // Aplicar filtros según la vista seleccionada
  switch(vista) {
    case 'factibles':
      filtrarEnlacesPorEstado('factible');
      break;
    case 'no-factibles':
      filtrarEnlacesPorEstado('no-factible');
      break;
    case 'cluster':
      aplicarAgrupamientoMapa();
      break;
    default:
      mostrarTodosEnlaces();
  }
  
  mostrarNotificacion('Vista del Mapa', `Cambiado a vista: ${vista}`, 'success');
}

function aplicarFiltrosMapa() {
  const frecuencia = document.getElementById('filter-frecuencia').value;
  const distancia = document.getElementById('filter-distancia').value;
  const estado = document.getElementById('filter-estado').value;
  
  // Aplicar filtros al mapa
  let enlacesFiltrados = obtenerEnlacesFiltrados(frecuencia, distancia, estado);
  actualizarMapaConFiltros(enlacesFiltrados);
  
  mostrarNotificacion('Filtros Aplicados', 'Los filtros del mapa han sido actualizados', 'success');
}

function filtrarEnlacesPorEstado(estado) {
  // Implementar lógica de filtrado por estado
  console.log(`Filtrando enlaces por estado: ${estado}`);
}

function aplicarAgrupamientoMapa() {
  // Implementar agrupamiento de marcadores en el mapa
  console.log('Aplicando agrupamiento en el mapa');
}

function mostrarTodosEnlaces() {
  // Mostrar todos los enlaces en el mapa
  console.log('Mostrando todos los enlaces');
}

function obtenerEnlacesFiltrados(frecuencia, distancia, estado) {
  // Implementar lógica de filtrado
  return [];
}

function actualizarMapaConFiltros(enlaces) {
  // Actualizar el mapa con los enlaces filtrados
  console.log('Actualizando mapa con filtros');
}

// ===== FUNCIONES DE GRÁFICOS =====

function cambiarPeriodoGrafico(periodo) {
  // Remover clase active de todos los botones
  document.querySelectorAll('.map-control-btn').forEach(btn => btn.classList.remove('active'));
  
  // Agregar clase active al botón clickeado
  event.target.closest('.map-control-btn').classList.add('active');
  
  // Actualizar gráfico según el período
  actualizarGraficoRendimiento(periodo);
  
  mostrarNotificacion('Período del Gráfico', `Cambiado a período: ${periodo}`, 'success');
}

function actualizarGraficoRendimiento(periodo) {
  // Implementar actualización del gráfico según el período
  console.log(`Actualizando gráfico para período: ${periodo}`);
  
  // Aquí se integraría con Chart.js para mostrar datos reales
  const ctx = document.getElementById('performanceChart');
  if (ctx) {
    // Crear o actualizar gráfico
    console.log('Gráfico actualizado');
  }
}

// ===== FUNCIONES DE BÚSQUEDA Y FILTROS =====

function buscarEnlaces(query) {
  if (query.length < 2) return;
  
  // Implementar búsqueda en tiempo real
  const resultados = realizarBusqueda(query);
  mostrarResultadosBusqueda(resultados);
  
  if (resultados.length > 0) {
    mostrarNotificacion('Búsqueda Completada', `Se encontraron ${resultados.length} resultados`, 'success');
  } else {
    mostrarNotificacion('Sin Resultados', 'No se encontraron enlaces que coincidan con tu búsqueda', 'warning');
  }
}

function realizarBusqueda(query) {
  // Implementar lógica de búsqueda
  return [];
}

function mostrarResultadosBusqueda(resultados) {
  // Mostrar resultados de búsqueda
  console.log('Mostrando resultados de búsqueda:', resultados);
}

function aplicarFiltros() {
  const torre = document.getElementById('filter-torre').value;
  const transporte = document.getElementById('filter-transporte').value;
  const arrendamiento = document.getElementById('filter-arrendamiento').value;
  const fechas = document.getElementById('filter-fechas').value;
  
  // Aplicar filtros a la tabla
  const enlacesFiltrados = filtrarEnlacesPorCriterios(torre, transporte, arrendamiento, fechas);
  actualizarTablaConFiltros(enlacesFiltrados);
  
  mostrarNotificacion('Filtros Aplicados', 'Los filtros han sido aplicados a la tabla', 'success');
}

function filtrarEnlacesPorCriterios(torre, transporte, arrendamiento, fechas) {
  // Implementar lógica de filtrado
  return [];
}

function actualizarTablaConFiltros(enlaces) {
  // Actualizar la tabla con los enlaces filtrados
  console.log('Actualizando tabla con filtros');
}

// ===== SISTEMA DE NOTIFICACIONES =====

let notificationCount = 0;
let notifications = [];

function mostrarNotificacion(titulo, mensaje, tipo = 'info') {
  notificationCount++;
  
  const notification = {
    id: Date.now(),
    titulo,
    mensaje,
    tipo,
    timestamp: new Date()
  };
  
  notifications.push(notification);
  actualizarContadorNotificaciones();
  crearNotificacionHTML(notification);
  
  // Auto-eliminar después de 5 segundos
  setTimeout(() => {
    eliminarNotificacion(notification.id);
  }, 5000);
}

function crearNotificacionHTML(notification) {
  const notificationCenter = document.getElementById('notificationCenter');
  
  const notificationHTML = `
    <div class="notification ${notification.tipo}" id="notification-${notification.id}">
      <div class="notification-header">
        <span class="notification-title">${notification.titulo}</span>
        <button class="notification-close" onclick="eliminarNotificacion(${notification.id})">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="notification-message">${notification.mensaje}</div>
    </div>
  `;
  
  notificationCenter.insertAdjacentHTML('afterbegin', notificationHTML);
}

function eliminarNotificacion(id) {
  const notification = document.getElementById(`notification-${id}`);
  if (notification) {
    notification.style.transform = 'translateX(100%)';
    setTimeout(() => {
      notification.remove();
      notifications = notifications.filter(n => n.id !== id);
      actualizarContadorNotificaciones();
    }, 300);
  }
}

function actualizarContadorNotificaciones() {
  const counter = document.getElementById('notificationCount');
  if (counter) {
    counter.textContent = notificationCount;
    counter.style.display = notificationCount > 0 ? 'inline' : 'none';
  }
}

// ===== FUNCIONES DE TEMA =====

function toggleTema() {
  // Forzar siempre tema oscuro
  const body = document.body;
  body.classList.remove('modo-claro');
  localStorage.setItem('tema', 'oscuro');
  mostrarNotificacion('Tema Bloqueado', 'Solo modo oscuro disponible', 'info');
}

// ===== FUNCIONES DE INICIALIZACIÓN =====

function inicializarDashboard() {
  // Forzar tema oscuro por defecto
  document.body.classList.remove('modo-claro');
  localStorage.setItem('tema', 'oscuro');
  
  // Activar pestaña por defecto
  setTimeout(() => {
    mostrarPestana('enlaces');
    console.log('✅ Pestaña enlaces activada por defecto');
  }, 100);
  
  // Actualizar métricas
  actualizarMetricasDashboard();
  
  // Inicializar gráficos
  inicializarGraficos();
  
  // Inicializar mapa
  inicializarMapaAvanzado();
  
  mostrarNotificacion('Dashboard Inicializado', 'Todas las funcionalidades están listas', 'success');
}

function actualizarMetricasDashboard() {
  // Obtener datos reales de la base de datos
  const totalEnlaces = document.querySelectorAll('#tabla tbody tr').length;
  const enlacesFactibles = document.querySelectorAll('#tabla .badge-factible').length;
  const enlacesNoFactibles = document.querySelectorAll('#tabla .badge-nofactible').length;
  
  // Actualizar métricas
  document.getElementById('metric-total-enlaces').textContent = totalEnlaces;
  document.getElementById('metric-enlaces-factibles').textContent = enlacesFactibles;
  document.getElementById('metric-enlaces-no-factibles').textContent = enlacesNoFactibles;
  
  // Calcular cobertura
  const cobertura = totalEnlaces > 0 ? Math.round((enlacesFactibles / totalEnlaces) * 100) : 0;
  document.getElementById('metric-cobertura').textContent = cobertura + '%';
  
  // Actualizar contadores del header
  document.getElementById('resumen-total-enlaces').textContent = totalEnlaces;
  document.getElementById('resumen-enlaces-factibles').textContent = enlacesFactibles;
  document.getElementById('resumen-enlaces-no-factibles').textContent = enlacesNoFactibles;
}

function inicializarGraficos() {
  // Inicializar gráficos con Chart.js
  console.log('Inicializando gráficos');
}

function inicializarMapaAvanzado() {
  // Inicializar mapa con funcionalidades avanzadas
  console.log('Inicializando mapa avanzado');
}

// ===== EVENT LISTENERS =====

document.addEventListener('DOMContentLoaded', function() {
  console.log('🌐 DOMContentLoaded iniciado');
  
  // Inicializar dashboard
  console.log('📊 Inicializando dashboard...');
  inicializarDashboard();
  console.log('✅ Dashboard inicializado');
  
  // Inicializar carga de archivos
  console.log('🚀 DOMContentLoaded: Llamando a configurarCargaArchivos...');
  try {
    configurarCargaArchivos();
    console.log('✅ DOMContentLoaded: configurarCargaArchivos completado');
  } catch (error) {
    console.error('❌ Error en configurarCargaArchivos:', error);
  }
  
  // Event listener para cambio de tema
  const toggleThemeBtn = document.getElementById('toggleThemeBtn');
  if (toggleThemeBtn) {
    toggleThemeBtn.addEventListener('click', toggleTema);
  }
  
  // Event listener para notificaciones
  const notificationBtn = document.getElementById('notificationBtn');
  if (notificationBtn) {
    notificationBtn.addEventListener('click', function() {
      mostrarNotificacion('Notificaciones', `Tienes ${notificationCount} notificaciones activas`, 'info');
    });
  }
  
  // Verificar estado inicial de archivos
  console.log('🔍 Verificando estado inicial de archivos...');
  setTimeout(() => {
    verificarEstadoArchivos();
  }, 1000);
});

function mostrarMapaEnlaces(estadoFiltro = null) {
  // Función existente para mostrar mapa básico
  console.log('Mostrando mapa de enlaces');
}
</script>
<!-- ===== HEADER CORPORATIVO EMPRESARIAL ===== -->
<header class="corporate-header">
  <div class="corporate-logo">
    <div class="corporate-logo-icon">
            <i class="fas fa-satellite-dish"></i>
          </div>
    <div class="corporate-logo-text">
      <div class="corporate-logo-title">FANGIO TELECOM</div>
      <div class="corporate-logo-subtitle">Enterprise Solutions</div>
    </div>
  </div>
  
  <nav class="corporate-nav">
    <a href="#" class="corporate-nav-item active">
      <i class="fas fa-home"></i>
      Dashboard
    </a>
    <a href="#" class="corporate-nav-item">
      <i class="fas fa-network-wired"></i>
      Enlaces
      <span class="badge">12</span>
    </a>
    <a href="#" class="corporate-nav-item">
      <i class="fas fa-chart-line"></i>
      Analytics
    </a>
    <a href="#" class="corporate-nav-item">
      <i class="fas fa-cog"></i>
      Configuración
    </a>
  </nav>
  
  <div class="corporate-user-menu">
    <div class="user-profile">
      <div class="user-avatar">AD</div>
      <div class="user-info">
        <div class="user-name">Admin User</div>
        <div class="user-role">System Administrator</div>
        </div>
      </div>
    </div>
</header>

<!-- ===== SIDEBAR EMPRESARIAL ===== -->
<aside class="corporate-sidebar">
  <div class="sidebar-section">
    <div class="sidebar-section-title">Gestión Principal</div>
    <ul class="sidebar-menu">
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link active">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard Ejecutivo</span>
          <i class="fas fa-chevron-right menu-arrow"></i>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-network-wired"></i>
          <span>Gestión de Enlaces</span>
          <span class="menu-badge">24</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-map-marked-alt"></i>
          <span>Visualización Geográfica</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-chart-bar"></i>
          <span>Reportes y Analytics</span>
        </a>
      </li>
    </ul>
  </div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">Operaciones</div>
    <ul class="sidebar-menu">
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-upload"></i>
          <span>Importación de Datos</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-download"></i>
          <span>Exportación</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-sync-alt"></i>
          <span>Sincronización</span>
        </a>
      </li>
    </ul>
</div>
  
  <div class="sidebar-section">
    <div class="sidebar-section-title">Administración</div>
    <ul class="sidebar-menu">
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-users"></i>
          <span>Gestión de Usuarios</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-shield-alt"></i>
          <span>Seguridad</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-database"></i>
          <span>Base de Datos</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="#" class="sidebar-menu-link">
          <i class="fas fa-file-alt"></i>
          <span>Logs del Sistema</span>
        </a>
      </li>
    </ul>
  </div>
</aside>

<!-- ===== CONTENIDO PRINCIPAL EMPRESARIAL ===== -->
<main class="corporate-main-content">
  <!-- ===== HEADER DE PÁGINA ===== -->
  <div class="corporate-page-header">
    <div class="page-header-content">
      <h1 class="page-title">Dashboard de Conectividad</h1>
      <p class="page-subtitle">Monitoreo en tiempo real de la infraestructura de telecomunicaciones y análisis de rendimiento de enlaces PtP</p>
      <div class="page-actions">
        <button class="corporate-btn primary">
          <i class="fas fa-plus"></i>
          Nuevo Enlace
        </button>
        <button class="corporate-btn secondary">
          <i class="fas fa-download"></i>
          Exportar Reporte
        </button>
        <button class="corporate-btn success">
          <i class="fas fa-sync-alt"></i>
          Actualizar Datos
        </button>
        <button class="corporate-btn warning" onclick="iniciarProcesamientoPares()">
          <i class="fas fa-rocket"></i>
          Procesar Pares
        </button>
        <button class="corporate-btn info" onclick="diagnosticarLocalStorage()">
          <i class="fas fa-bug"></i>
          Diagnosticar
        </button>
      </div>
    </div>
  </div>

  <!-- ===== DASHBOARD EJECUTIVO ===== -->
  <div class="executive-dashboard">
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon primary">
            <i class="fas fa-network-wired"></i>
          </div>
          <div class="kpi-trend positive">
            <i class="fas fa-arrow-up"></i> +15%
          </div>
        </div>
        <div class="kpi-value" id="executive-total-enlaces">0</div>
        <div class="kpi-label">Total de Enlaces</div>
        <div class="kpi-chart"></div>
      </div>

      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon success">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="kpi-trend positive">
            <i class="fas fa-arrow-up"></i> +8%
          </div>
        </div>
        <div class="kpi-value" id="executive-enlaces-factibles">0</div>
        <div class="kpi-label">Enlaces Operativos</div>
        <div class="kpi-chart"></div>
      </div>

      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon warning">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="kpi-trend negative">
            <i class="fas fa-arrow-down"></i> -3%
          </div>
        </div>
        <div class="kpi-value" id="executive-enlaces-criticos">0</div>
        <div class="kpi-label">Enlaces Críticos</div>
        <div class="kpi-chart"></div>
      </div>

      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon danger">
            <i class="fas fa-times-circle"></i>
          </div>
          <div class="kpi-trend negative">
            <i class="fas fa-arrow-down"></i> -5%
          </div>
        </div>
        <div class="kpi-value" id="executive-enlaces-fuera">0</div>
        <div class="kpi-label">Fuera de Servicio</div>
        <div class="kpi-chart"></div>
      </div>
    </div>

    <div class="activity-panel">
      <div class="activity-panel-header">
        <i class="fas fa-history"></i>
        <h3 class="activity-panel-title">Actividad Reciente</h3>
      </div>
      <ul class="activity-list">
        <li class="activity-item">
          <div class="activity-icon create">
            <i class="fas fa-plus"></i>
          </div>
          <div class="activity-content">
            <div class="activity-text">Nuevo enlace PtP agregado: Torre A - Torre B</div>
            <div class="activity-time">Hace 5 minutos</div>
          </div>
        </li>
        <li class="activity-item">
          <div class="activity-icon update">
            <i class="fas fa-edit"></i>
          </div>
          <div class="activity-content">
            <div class="activity-text">Enlace actualizado: Cambios en configuración de frecuencia</div>
            <div class="activity-time">Hace 15 minutos</div>
          </div>
        </li>
        <li class="activity-item">
          <div class="activity-icon export">
            <i class="fas fa-file-export"></i>
          </div>
          <div class="activity-content">
            <div class="activity-text">Reporte de factibilidad exportado a Excel</div>
            <div class="activity-time">Hace 1 hora</div>
          </div>
        </li>
        <li class="activity-item">
          <div class="activity-icon update">
            <i class="fas fa-sync-alt"></i>
          </div>
          <div class="activity-content">
            <div class="activity-text">Sincronización automática completada</div>
            <div class="activity-time">Hace 2 horas</div>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <!-- ===== OVERLAY DE PROCESAMIENTO AVANZADO ===== -->
  <div class="processing-overlay" id="processingOverlay">
    <div class="processing-container">
      <div class="processing-header">
        <div class="processing-icon">
          <i class="fas fa-cogs"></i>
        </div>
        <h2 class="processing-title">Procesando Pares</h2>
        <p class="processing-subtitle">Análisis de factibilidad en progreso</p>
      </div>

      <!-- ===== BARRA DE PROGRESO ===== -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text">
          <span class="progress-percentage" id="progressPercentage">0%</span>
          <span class="progress-count" id="progressCount">0 / 4,000 pares</span>
        </div>
      </div>

      <!-- ===== ESTADO DEL PROCESAMIENTO ===== -->
      <div class="processing-status">
        <div class="status-item" id="statusValidacion">
          <div class="status-icon pending">
            <i class="fas fa-clock"></i>
          </div>
          <div class="status-text">Validando datos de entrada</div>
          <div class="status-time">Pendiente</div>
        </div>
        
        <div class="status-item" id="statusCalculo">
          <div class="status-icon pending">
            <i class="fas fa-calculator"></i>
          </div>
          <div class="status-text">Calculando distancias y frecuencias</div>
          <div class="status-time">Pendiente</div>
        </div>
        
        <div class="status-item" id="statusAnalisis">
          <div class="status-icon pending">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="status-text">Analizando factibilidad técnica</div>
          <div class="status-time">Pendiente</div>
        </div>
        
        <div class="status-item" id="statusFinalizacion">
          <div class="status-icon pending">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="status-text">Finalizando y generando reportes</div>
          <div class="status-time">Pendiente</div>
        </div>
      </div>

      <!-- ===== MODO TURBO ===== -->
      <div class="turbo-mode">
        <div class="turbo-header">
          <i class="fas fa-bolt turbo-icon"></i>
          <h3 class="turbo-title">MODO TURBO ACTIVADO</h3>
        </div>
        <div class="turbo-features">
          <div class="turbo-feature">
            <i class="fas fa-rocket"></i>
            <span>Procesamiento acelerado</span>
          </div>
          <div class="turbo-feature">
            <i class="fas fa-clock"></i>
            <span>~8-15 segundos</span>
          </div>
          <div class="turbo-feature">
            <i class="fas fa-memory"></i>
            <span>Optimización de memoria</span>
          </div>
        </div>
      </div>

      <!-- ===== RECURSOS DEL SISTEMA ===== -->
      <div class="system-resources">
        <div class="resource-item">
          <i class="fas fa-memory resource-icon"></i>
          <span>Memoria: 8GB</span>
        </div>
        <div class="resource-item">
          <i class="fas fa-wifi resource-icon"></i>
          <span>Conexión: 4G</span>
        </div>
        <div class="resource-item">
          <i class="fas fa-microchip resource-icon"></i>
          <span>CPU: Optimizado</span>
        </div>
      </div>

      <!-- ===== BOTONES DE CONTROL ===== -->
      <div class="processing-controls">
        <button class="control-btn primary" id="btnPausarProcesamiento">
          <i class="fas fa-pause"></i>
          Pausar
        </button>
        <button class="control-btn secondary" id="btnVerDetalles">
          <i class="fas fa-info-circle"></i>
          Ver Detalles
        </button>
        <button class="control-btn danger" id="btnCancelarProcesamiento">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- ===== CONTENIDO EXISTENTE ===== -->
  <div class="container">
<!-- ===== CENTRO DE NOTIFICACIONES ===== -->
<div class="notification-center" id="notificationCenter"></div>

<!-- ===== BOTÓN DE CAMBIO DE TEMA ===== -->
<button id="toggleThemeBtn" class="btn btn-secondary" style="position:fixed;bottom:18px;right:24px;z-index:9999;">
  <i class="fas fa-adjust"></i> Cambiar tema
</button>

<!-- ===== BOTÓN DE NOTIFICACIONES ===== -->
<button id="notificationBtn" class="btn btn-info" style="position:fixed;bottom:18px;right:180px;z-index:9999;">
  <i class="fas fa-bell"></i> <span id="notificationCount">0</span>
</button>
    <div class="action-buttons">    
</div>
<div id="indicador-factibilidad" style="text-align:center; font-size:2rem; font-weight:800; margin-bottom:10px;">
</div>
<div id="perfil-elevacion-con-torres"
     style="display: flex; align-items: flex-end; justify-content: center; margin: 30px auto 24px auto; width: 100%; max-width: 100vw; position: relative;">
<div style="width:160px; min-width:120px; height:320px; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; margin-right:48px; position:relative;">    <!-- Cuadro de datos arriba de la torre -->
    <div id="torreA-info"
         style="position:absolute; left:50%; top:-70px; transform:translateX(-50%); background:#181f2a; color:#00e6ff; border-radius:12px; box-shadow:0 2px 12px #00e6ff33; padding:10px 18px; min-width:120px; text-align:center; font-size:14px; z-index:2;">
      <b id="torreA-id">ID</b><br>
      <span id="torreA-nombre">Nombre</span><br>
      <span id="torreA-altura">Altura m</span>
    </div>
<svg viewBox="0 0 48 180" style="height:320px; width:auto; display:block;" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="torreMetalB" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fff" stop-opacity="0.95"/>
      <stop offset="100%" stop-color="#e53935" stop-opacity="0.85"/>
    </linearGradient>
    <pattern id="rejillaB" width="8" height="8" patternUnits="userSpaceOnUse">
      <rect x="0" y="0" width="8" height="8" fill="none"/>
      <line x1="0" y1="0" x2="8" y2="8" stroke="#e53935" stroke-width="0.7" opacity="0.18"/>
      <line x1="8" y1="0" x2="0" y2="8" stroke="#e53935" stroke-width="0.7" opacity="0.18"/>
    </pattern>
  </defs>
  <ellipse cx="24" cy="175" rx="13" ry="4" fill="#000" opacity="0.12"/>
  <ellipse cx="24" cy="170" rx="16" ry="8" fill="#b0bec5"/>
  <ellipse cx="24" cy="170" rx="10" ry="4" fill="#e53935" opacity="0.7"/>
  <polygon points="24,10 6,170 42,170" fill="url(#torreMetalB)" stroke="#fff" stroke-width="6"/>
  <polygon points="24,20 12,165 36,165" fill="url(#rejillaB)" opacity="0.5"/>
  <line x1="24" y1="10" x2="24" y2="170" stroke="#e53935" stroke-width="4"/>
  <line x1="12" y1="50" x2="36" y2="130" stroke="#e53935" stroke-width="2"/>
  <line x1="36" y1="50" x2="12" y2="130" stroke="#e53935" stroke-width="2"/>
  <line x1="10" y1="90" x2="38" y2="150" stroke="#e53935" stroke-width="2"/>
  <line x1="38" y1="90" x2="10" y2="150" stroke="#e53935" stroke-width="2"/>
  <line x1="12" y1="50" x2="36" y2="50" stroke="#fff" stroke-width="2" opacity="0.8"/>
  <line x1="10" y1="90" x2="38" y2="90" stroke="#fff" stroke-width="2" opacity="0.8"/>
  <line x1="12" y1="130" x2="36" y2="130" stroke="#fff" stroke-width="2" opacity="0.8"/>
  <line x1="6" y1="170" x2="42" y2="170" stroke="#e53935" stroke-width="5"/>
  <rect x="20" y="2" width="8" height="16" rx="2" fill="#fff" opacity="0.85"/>
  <rect x="16" y="0" width="16" height="4" rx="2" fill="#e53935" opacity="0.9"/>
  <rect x="23" y="-8" width="2" height="10" rx="1" fill="#b0bec5"/>
  <circle cx="24" cy="-8" r="2" fill="#ffd600" stroke="#b0bec5" stroke-width="0.7"/>
  <ellipse cx="32" cy="60" rx="3" ry="7" fill="#e53935" opacity="0.7"/>
  <ellipse cx="16" cy="100" rx="3" ry="7" fill="#e53935" opacity="0.7"/>
  <ellipse cx="32" cy="140" rx="3" ry="7" fill="#e53935" opacity="0.7"/>
  <circle cx="24" cy="50" r="1.1" fill="#b0bec5"/>
  <circle cx="24" cy="90" r="1.1" fill="#b0bec5"/>
  <circle cx="24" cy="130" r="1.1" fill="#b0bec5"/>
  <circle cx="24" cy="170" r="1.1" fill="#b0bec5"/>
</svg>
  </div>
  <div style="flex:1; min-width:0;">
    <div id="perfilElevacionPlotly"
         style="width:100%;height:400px;margin:0;background:#181f2a;border-radius:32px;"></div>
  </div>
<div style="width:160px; min-width:120px; height:320px; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; margin-right:48px; position:relative;">    <!-- Cuadro de datos arriba de la torre -->
    <div id="torreB-info"
         style="position:absolute; left:50%; top:-70px; transform:translateX(-50%); background:#181f2a; color:#00e6ff; border-radius:12px; box-shadow:0 2px 12px #00e6ff33; padding:10px 18px; min-width:120px; text-align:center; font-size:14px; z-index:2;">
      <b id="torreB-id">ID</b><br>
      <span id="torreB-nombre">Nombre</span><br>
      <span id="torreB-altura">Altura m</span>
    </div>
<svg viewBox="0 0 48 180" style="height:320px; width:auto; display:block;" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="torreMetalB" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fff" stop-opacity="0.95"/>
      <stop offset="100%" stop-color="#e53935" stop-opacity="0.85"/>
    </linearGradient>
    <pattern id="rejillaB" width="8" height="8" patternUnits="userSpaceOnUse">
      <rect x="0" y="0" width="8" height="8" fill="none"/>
      <line x1="0" y1="0" x2="8" y2="8" stroke="#e53935" stroke-width="0.7" opacity="0.18"/>
      <line x1="8" y1="0" x2="0" y2="8" stroke="#e53935" stroke-width="0.7" opacity="0.18"/>
    </pattern>
  </defs>
  <ellipse cx="24" cy="175" rx="13" ry="4" fill="#000" opacity="0.12"/>
  <ellipse cx="24" cy="170" rx="16" ry="8" fill="#b0bec5"/>
  <ellipse cx="24" cy="170" rx="10" ry="4" fill="#e53935" opacity="0.7"/>
  <polygon points="24,10 6,170 42,170" fill="url(#torreMetalB)" stroke="#fff" stroke-width="6"/>
  <polygon points="24,20 12,165 36,165" fill="url(#rejillaB)" opacity="0.5"/>
  <line x1="24" y1="10" x2="24" y2="170" stroke="#e53935" stroke-width="4"/>
  <line x1="12" y1="50" x2="36" y2="130" stroke="#e53935" stroke-width="2"/>
  <line x1="36" y1="50" x2="12" y2="130" stroke="#e53935" stroke-width="2"/>
  <line x1="10" y1="90" x2="38" y2="150" stroke="#e53935" stroke-width="2"/>
  <line x1="38" y1="90" x2="10" y2="150" stroke="#e53935" stroke-width="2"/>
  <line x1="12" y1="50" x2="36" y2="50" stroke="#fff" stroke-width="2" opacity="0.8"/>
  <line x1="10" y1="90" x2="38" y2="90" stroke="#fff" stroke-width="2" opacity="0.8"/>
  <line x1="12" y1="130" x2="36" y2="130" stroke="#fff" stroke-width="2" opacity="0.8"/>
  <line x1="6" y1="170" x2="42" y2="170" stroke="#e53935" stroke-width="5"/>
  <rect x="20" y="2" width="8" height="16" rx="2" fill="#fff" opacity="0.85"/>
  <rect x="16" y="0" width="16" height="4" rx="2" fill="#e53935" opacity="0.9"/>
  <rect x="23" y="-8" width="2" height="10" rx="1" fill="#b0bec5"/>
  <circle cx="24" cy="-8" r="2" fill="#ffd600" stroke="#b0bec5" stroke-width="0.7"/>
  <ellipse cx="32" cy="60" rx="3" ry="7" fill="#e53935" opacity="0.7"/>
  <ellipse cx="16" cy="100" rx="3" ry="7" fill="#e53935" opacity="0.7"/>
  <ellipse cx="32" cy="140" rx="3" ry="7" fill="#e53935" opacity="0.7"/>
  <circle cx="24" cy="50" r="1.1" fill="#b0bec5"/>
  <circle cx="24" cy="90" r="1.1" fill="#b0bec5"/>
  <circle cx="24" cy="130" r="1.1" fill="#b0bec5"/>
  <circle cx="24" cy="170" r="1.1" fill="#b0bec5"/>
</svg>
  </div>
</div>
  <div class="navigation-container-modern">
    <div class="system-status-bar">
      <div class="status-indicator">
        <div class="status-dot online"></div>
        <span class="status-text">Sistema Operativo</span>
      </div>
      <div class="status-info">
        <span class="version-info">v2.1.0</span>
        <span class="last-update">Última actualización: <span id="last-update-time">Hoy</span></span>
      </div>
    </div>
    
    <div class="tab-navigation">
      <button class="tab-button-modern active" onclick="mostrarPestana('formulario', event)">
        <div class="tab-icon">
          <i class="fas fa-edit"></i>
        </div>
        <span class="tab-text">Registro de Enlaces</span>
        <div class="tab-indicator"></div>
      </button>
    
          <button class="tab-button-modern" onclick="mostrarPestana('enlaces', event)">
        <div class="tab-icon">
          <i class="fas fa-database"></i>
          <span class="tab-badge" id="contador-enlaces">0</span>
        </div>
        <span class="tab-text">Base de Datos</span>
        <div class="tab-indicator"></div>
      </button>
      
      <button class="tab-button-modern" onclick="mostrarPestana('mismoTransporte', event)">
        <div class="tab-icon">
          <i class="fas fa-project-diagram"></i>
        </div>
        <span class="tab-text">Análisis de Red</span>
        <div class="tab-indicator"></div>
      </button>
      
      <button class="tab-button-modern" onclick="mostrarPestana('resumen', event)">
        <div class="tab-icon">
          <i class="fas fa-tachometer-alt"></i>
        </div>
        <span class="tab-text">Dashboard</span>
        <div class="tab-indicator"></div>
      </button>
  </div>
  
  <div class="action-buttons-modern">
    <button id="toggleMismoTransporte" class="btn-modern btn-toggle" type="button" onclick="togglePermitirMismoTransporte()">
      <div class="btn-icon">
        <i class="fas fa-exchange-alt"></i>
      </div>
      <span class="btn-text">Permitir mismo transporte</span>
      <div class="toggle-switch">
        <i class="fas fa-toggle-off toggle-icon"></i>
      </div>
    </button>
    
    <button class="btn-modern btn-primary" onclick="window.location.href='ptmpFangio.html'">
      <div class="btn-icon">
        <i class="fas fa-project-diagram"></i>
      </div>
      <span class="btn-text">Estudio Multipunto (PtMP)</span>
    </button>
    
    <button class="btn-modern btn-success" onclick="window.location.href='/llenado_automatico'">
      <div class="btn-icon">
        <i class="fas fa-magic"></i>
      </div>
      <span class="btn-text">Llenado Automático</span>
    </button>
    
    <button class="btn-modern btn-warning" onclick="window.location.href='/'">
      <div class="btn-icon">
        <i class="fas fa-play"></i>
      </div>
      <span class="btn-text">Ejecutar Aplicación</span>
    </button>
  </div>
</div>
</div>
    <div class="main-content">
      <div class="tabs-container">
        <div class="tabs">
</div>
      </div>
      
      <div id="tab-formulario" class="tab-content active">
        <!-- ===== INFORMACIÓN DE FRECUENCIA MODERNA ===== -->
        <div class="frecuencia-info-modern">
          <div class="frecuencia-header">
            <i class="fas fa-info-circle"></i>
            <h3>Reglas de Frecuencia</h3>
          </div>
          <div class="frecuencia-rules">
            <div class="rule-item">
              <div class="rule-distance">0-5 km</div>
              <div class="rule-frequency">80 GHz</div>
              <div class="rule-icon">
                <i class="fas fa-satellite-dish"></i>
              </div>
            </div>
            <div class="rule-item">
              <div class="rule-distance">5-15 km</div>
              <div class="rule-frequency">15 GHz</div>
              <div class="rule-icon">
                <i class="fas fa-broadcast-tower"></i>
              </div>
            </div>
            <div class="rule-item">
              <div class="rule-distance">15+ km</div>
              <div class="rule-frequency">8 GHz</div>
              <div class="rule-icon">
                <i class="fas fa-wifi"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="file-upload-row">
  <div class="file-upload">
    <label for="inputFile">
      <i class="fas fa-upload"></i> Cargar archivo Excel
    </label>
    <input type="file" id="inputFile" accept=".xlsx" />
    <button type="button" onclick="probarCargaArchivos()" class="btn btn-info btn-sm" style="margin-top: 10px;">
      <i class="fas fa-bug"></i> Probar Carga
    </button>
    <button type="button" onclick="verificarEstadoArchivos()" class="btn btn-warning btn-sm" style="margin-top: 10px; margin-left: 10px;">
      <i class="fas fa-search"></i> Verificar Estado
    </button>
    <button type="button" onclick="limpiarLocalStorage()" class="btn btn-danger btn-sm" style="margin-top: 10px; margin-left: 10px;">
      <i class="fas fa-trash"></i> Limpiar Storage
    </button>
    
    <!-- Indicador de estado del archivo Excel -->
    <div id="estado-archivo-excel" class="estado-archivo" style="margin-top: 15px; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">
      <div style="display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-info-circle" style="color: #3b82f6;"></i>
        <span>No hay archivo Excel cargado</span>
      </div>
    </div>
    
    <div id="archivo-cargado" style="display: none;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h4 style="color: #28a745; margin-bottom: 5px;">
            <i class="fas fa-file-excel"></i> Archivo Cargado
          </h4>
          <p id="nombre-archivo" style="font-weight: bold; margin-bottom: 3px;"></p>
          <small id="info-archivo" style="color:666;"></small>
        </div>
        <button id="borrar-archivo" type="button" class="btn btn-danger btn-sm">
          <i class="fas fa-trash"></i> Eliminar
        </button>
      </div>
    </div>
    <div class="loading" id="loading" style="display:none;">
      <div class="spinner" style="border-top:4px solid #764ba2; border-right:4px solid #667eea; border-bottom:4px solid #10b981; border-left:4px solid #fff;"></div>
      <p style="color:#764ba2; font-weight:600;">Cargando archivo...</p>
    </div>
  </div>
  <div class="file-upload">
          <label for="inputFilePairs">
        <i class="fas fa-upload"></i> Cargar Excel de Pares
      </label>
      <input type="file" id="inputFilePairs" accept=".xlsx" />
      
      <!-- Indicador de estado del archivo de Pares -->
      <div id="estado-archivo-pares" class="estado-archivo" style="margin-top: 15px; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">
        <div style="display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-info-circle" style="color: #3b82f6;"></i>
          <span>No hay archivo de Pares cargado</span>
        </div>
      </div>
      
    <div id="archivo-pares-cargado" style="display: none;">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h4 style="color: #28a745; margin-bottom: 5px;">
        <i class="fas fa-file-excel"></i> Archivo de Pares Cargado
      </h4>
      <p id="nombre-archivo-pares" style="font-weight: bold; margin-bottom: 3px;"></p>
      <small id="info-archivo-pares" style="color: #666;"></small>
    </div>
    <div style="display: flex; gap: 12px;">
      <button class="btn btn-primary" onclick="procesarPares()">
        <i class="fas fa-play"></i> Procesar Pares
      </button>
      <button id="borrar-archivo-pares" type="button" class="btn btn-danger btn-sm">
        <i class="fas fa-trash"></i> Eliminar
      </button>
    </div>
  </div>
</div>
  </div>
</div>
        <div class="form-grid-modern">
          <div class="form-card">
            <div class="form-card-header">
              <i class="fas fa-id-card"></i>
              <h3>Identificación de Sitios</h3>
            </div>
            <div class="form-card-content">
              <div class="input-group-modern">
                <label for="idA"><i class="fas fa-id-card"></i> ID A</label>
                <input type="text" id="idA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="idB"><i class="fas fa-id-card"></i> ID B</label>
                <input type="text" id="idB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="nombreA"><i class="fas fa-building"></i> Nombre Sitio A</label>
                <input type="text" id="nombreA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="nombreB"><i class="fas fa-building"></i> Nombre Sitio B</label>
                <input type="text" id="nombreB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>

          <div class="form-card">
            <div class="form-card-header">
              <i class="fas fa-map-marker-alt"></i>
              <h3>Coordenadas</h3>
            </div>
            <div class="form-card-content">
              <div class="input-group-modern">
                <label for="latA"><i class="fas fa-map-marker-alt"></i> Latitud A</label>
                <input type="text" id="latA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="lonA"><i class="fas fa-map-marker-alt"></i> Longitud A</label>
                <input type="text" id="lonA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="latB"><i class="fas fa-map-marker-alt"></i> Latitud B</label>
                <input type="text" id="latB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="lonB"><i class="fas fa-map-marker-alt"></i> Longitud B</label>
                <input type="text" id="lonB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>

          <div class="form-card">
            <div class="form-card-header">
              <i class="fas fa-calculator"></i>
              <h3>Cálculos Automáticos</h3>
            </div>
            <div class="form-card-content">
              <div class="input-group-modern">
                <label for="latArad"><i class="fas fa-calculator"></i> Latitud A (rad)</label>
                <input type="text" id="latArad" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="lonArad"><i class="fas fa-calculator"></i> Longitud A (rad)</label>
                <input type="text" id="lonArad" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="latBrad"><i class="fas fa-calculator"></i> Latitud B (rad)</label>
                <input type="text" id="latBrad" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="lonBrad"><i class="fas fa-calculator"></i> Longitud B (rad)</label>
                <input type="text" id="lonBrad" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="distancia"><i class="fas fa-ruler"></i> Distancia (km)</label>
                <input type="text" id="distancia" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="frecuencia"><i class="fas fa-signal"></i> Frecuencia (GHz)</label>
                <input type="text" id="frecuencia" class="input-modern input-readonly input-highlight" readonly />
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>

          <div class="form-card">
            <div class="form-card-header">
              <i class="fas fa-broadcast-tower"></i>
              <h3>Características de Torres</h3>
            </div>
            <div class="form-card-content">
              <div class="input-group-modern">
                <label for="alturaA"><i class="fas fa-arrows-alt-v"></i> Altura Torre A</label>
                <input type="text" id="alturaA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="alturaB"><i class="fas fa-arrows-alt-v"></i> Altura Torre B</label>
                <input type="text" id="alturaB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="ranA"><i class="fas fa-wifi"></i> Altura RAN A</label>
                <input type="text" id="ranA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="ranB"><i class="fas fa-wifi"></i> Altura RAN B</label>
                <input type="text" id="ranB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>

          <div class="form-card">
            <div class="form-card-header">
              <i class="fas fa-truck"></i>
              <h3>Transporte y Arrendamiento</h3>
            </div>
            <div class="form-card-content">
              <div class="input-group-modern">
                <label for="TransA"><i class="fas fa-truck"></i> Tipo de transporte sitio A</label>
                <input type="text" id="TransA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="TransB"><i class="fas fa-truck"></i> Tipo de transporte sitio B</label>
                <input type="text" id="TransB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="ArreA"><i class="fas fa-handshake"></i> Tipo de Arrendamiento A</label>
                <input type="text" id="ArreA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="ArreB"><i class="fas fa-handshake"></i> Tipo de Arrendamiento B</label>
                <input type="text" id="ArreB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>

          <div class="form-card">
            <div class="form-card-header">
              <i class="fas fa-power-off"></i>
              <h3>Estado Operativo</h3>
            </div>
            <div class="form-card-content">
              <div class="input-group-modern">
                <label for="OnA"><i class="fas fa-power-off"></i> On Air A</label>
                <input type="text" id="OnA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="OnB"><i class="fas fa-power-off"></i> On Air B</label>
                <input type="text" id="OnB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="TorreA"><i class="fas fa-broadcast-tower"></i> Tipo de Torre A</label>
                <input type="text" id="TorreA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="TorreB"><i class="fas fa-broadcast-tower"></i> Tipo de Torre B</label>
                <input type="text" id="TorreB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="EstadoA"><i class="fas fa-flag"></i> Estado A</label>
                <input type="text" id="EstadoA" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="EstadoB"><i class="fas fa-flag"></i> Estado B</label>
                <input type="text" id="EstadoB" class="input-modern" />
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>

          <div class="form-card">
            <div class="form-card-header">
              <i class="fas fa-chart-line"></i>
              <h3>Análisis Técnico</h3>
            </div>
            <div class="form-card-content">
              <div class="input-group-modern">
                <label for="bulboCurvatura"><i class="fas fa-globe"></i> Bulbo Curvatura Terrestre (m)</label>
                <input type="text" id="bulboCurvatura" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="radioFresnel"><i class="fas fa-circle"></i> Radio máx. zona de Fresnel (m)</label>
                <input type="text" id="radioFresnel" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="alturaLibre"><i class="fas fa-arrows-alt-v"></i> Altura libre necesaria (m)</label>
                <input type="text" id="alturaLibre" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="alturaDisponible"><i class="fas fa-arrows-alt-v"></i> Altura real disponible (m)</label>
                <input type="text" id="alturaDisponible" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="factibilidadCurvatura"><i class="fas fa-check-circle"></i> Factibilidad Curvatura/Fresnel</label>
                <input type="text" id="factibilidadCurvatura" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
              <div class="input-group-modern">
                <label for="disponibilidadAnual"><i class="fas fa-percentage"></i> Disponibilidad Anual (%)</label>
                <input type="text" id="disponibilidadAnual" class="input-modern input-readonly" readonly />
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="action-buttons-modern">
          <div class="button-group-primary">
            <button id="agregarBtn" class="btn-modern btn-success" onclick="agregarOActualizarEnlace()">
              <div class="btn-icon">
                <i class="fas fa-check"></i>
              </div>
              <span class="btn-text">Agregar Enlace</span>
              <div class="btn-ripple"></div>
            </button>
            
            <button class="btn-modern btn-secondary" onclick="limpiarFormulario()">
              <div class="btn-icon">
                <i class="fas fa-trash"></i>
              </div>
              <span class="btn-text">Limpiar Formulario</span>
              <div class="btn-ripple"></div>
            </button>
            
            <button class="btn-modern btn-primary" onclick="mostrarPestana('enlaces')">
              <div class="btn-icon">
                <i class="fas fa-list"></i>
              </div>
              <span class="btn-text">Ver Mis Enlaces</span>
              <div class="btn-ripple"></div>
            </button>
            
            <button class="btn-modern btn-warning" onclick="exportarFactiblesParaPathloss()">
              <div class="btn-icon">
                <i class="fas fa-file-export"></i>
              </div>
              <span class="btn-text">Exportar Factibles para Pathloss</span>
              <div class="btn-ripple"></div>
            </button>
          </div>
          
          <div class="button-group-secondary">
            <button class="btn-modern btn-info" onclick="window.location.href='/llenado_automatico'">
              <div class="btn-icon">
                <i class="fas fa-magic"></i>
              </div>
              <span class="btn-text">Llenado Automático</span>
              <div class="btn-ripple"></div>
            </button>
            
            <button class="btn-modern btn-info" onclick="window.location.href='/'">
              <div class="btn-icon">
                <i class="fas fa-play"></i>
              </div>
              <span class="btn-text">Ejecutar Aplicación</span>
              <div class="btn-ripple"></div>
            </button>
          </div>
          
          <div class="button-group-utility">
            <button class="btn-modern btn-info" onclick="abrirPanelParametrosRadio()">
              <div class="btn-icon">
                <i class="fas fa-cogs"></i>
              </div>
              <span class="btn-text">Parámetros Radioenlace</span>
              <div class="btn-ripple"></div>
            </button>
            
            <button class="btn-modern btn-primary" onclick="abrirPanelEquiposAntenas()">
              <div class="btn-icon">
                <i class="fas fa-broadcast-tower"></i>
              </div>
              <span class="btn-text">Gestión Equipos/Antenas</span>
              <div class="btn-ripple"></div>
            </button>
          </div>
        </div>
      </div>
      <div id="tab-seleccion" class="tab-content">
  <div class="enlaces-counter">
    <i class="fas fa-check-square"></i> Enlaces Seleccionados: <span id="enlaces-seleccionados">0</span>
  </div>
  <div class="action-buttons">
    <button class="btn btn-primary" onclick="seleccionarTodo()">
      <i class="fas fa-check-double"></i> Seleccionar Todo
    </button>
    <button class="btn btn-secondary" onclick="deseleccionarTodo()">
      <i class="fas fa-times"></i> Deseleccionar Todo
    </button>
    <button id="eliminarSeleccionadosBtn" class="btn btn-danger" onclick="eliminarSeleccionados()" disabled>
      <i class="fas fa-trash-alt"></i> Eliminar Seleccionados
    </button>

  </div>

  <div class="table-container seleccion-container">
  </div>
</div>
      <div id="tab-enlaces" class="tab-content">
        <div class="enlaces-header-modern">
          <div class="enlaces-title-section">
            <h2 class="enlaces-title">
              <i class="fas fa-network-wired"></i> 
              <span>Registro de Enlaces PtP</span>
              <div class="title-underline"></div>
            </h2>
            <div class="enlaces-stats">
              <div class="stat-item">
                <i class="fas fa-satellite-dish"></i>
                <span id="total-enlaces">0</span>
                <label>Enlaces Totales</label>
              </div>
              <div class="stat-item">
                <i class="fas fa-check-circle"></i>
                <span id="enlaces-factibles">0</span>
                <label>Viables Técnicamente</label>
              </div>
              <div class="stat-item">
                <i class="fas fa-times-circle"></i>
                <span id="enlaces-no-factibles">0</span>
                <label>No Viables</label>
              </div>
            </div>
          </div>
          
          <div class="enlaces-controls-modern">
            <div class="button-group-primary">
              <button class="btn-modern btn-primary" onclick="mostrarPestana('formulario')">
                <div class="btn-icon">
                  <i class="fas fa-plus"></i>
                </div>
                <span class="btn-text">Registrar Nuevo Enlace</span>
                <div class="btn-ripple"></div>
              </button>
              
              <button class="btn-modern btn-success" onclick="exportarExcel()">
                <div class="btn-icon">
                  <i class="fas fa-file-excel"></i>
                </div>
                <span class="btn-text">Exportar Dataset</span>
                <div class="btn-ripple"></div>
              </button>
            </div>
            
            <div class="button-group-secondary">
              <button class="btn-modern btn-secondary" onclick="seleccionarTodosEnlaces()">
                <div class="btn-icon">
                  <i class="fas fa-check-double"></i>
                </div>
                <span class="btn-text">Selección Masiva</span>
                <div class="btn-ripple"></div>
              </button>
              
              <button class="btn-modern btn-danger" onclick="eliminarEnlacesSeleccionados()" id="btnEliminarSeleccionados" disabled>
                <div class="btn-icon">
                  <i class="fas fa-trash-alt"></i>
                </div>
                <span class="btn-text">Eliminación Masiva</span>
                <div class="btn-ripple"></div>
              </button>
              
              <button id="btnPerfilElevacionGlobal" class="btn-modern btn-info" style="display:none;">
                <div class="btn-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <span class="btn-text">Análisis de Elevación</span>
                <div class="btn-ripple"></div>
              </button>
            </div>
          </div>
        </div>
        
        <div class="table-container-modern" style="
          position: relative;
          overflow-x: auto;
          overflow-y: auto;
          max-height: 80vh;
          border-radius: 16px;
          background: rgba(11, 17, 31, 0.98);
          border: 2px solid var(--accent);
          box-shadow: 0 6px 32px 0 rgba(0,188,212,0.10);
        ">
          <!-- Indicador de scroll horizontal -->
          <div class="scroll-hint" style="
            background: linear-gradient(90deg, rgba(0,188,212,0.8), rgba(30,136,229,0.8));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            text-align: center;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 12px rgba(0,188,212,0.3);
          ">
            <i class="fas fa-arrows-alt-h"></i>
            <span>Desliza horizontalmente para ver todas las columnas</span>
          </div>

          <!-- Botones de navegación rápida -->
          <div class="quick-nav-buttons" style="
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
          ">
            <button onclick="scrollToColumn(1)" class="quick-nav-btn" style="
              background: rgba(0,188,212,0.8);
              color: white;
              border: none;
              padding: 6px 12px;
              border-radius: 15px;
              font-size: 11px;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 2px 8px rgba(0,188,212,0.3);
            " title="Ir a Sitio A" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(0,188,212,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,188,212,0.3)'">
              <i class="fas fa-map-marker-alt"></i> Sitio A
            </button>
            <button onclick="scrollToColumn(7)" class="quick-nav-btn" style="
              background: rgba(30,136,229,0.8);
              color: white;
              border: none;
              padding: 6px 12px;
              border-radius: 15px;
              font-size: 11px;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 2px 8px rgba(30,136,229,0.3);
            " title="Ir a Sitio B" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(30,136,229,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(30,136,229,0.3)'">
              <i class="fas fa-map-marker-alt"></i> Sitio B
            </button>
            <button onclick="scrollToColumn(12)" class="quick-nav-btn" style="
              background: rgba(156,39,176,0.8);
              color: white;
              border: none;
              padding: 6px 12px;
              border-radius: 15px;
              font-size: 11px;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 2px 8px rgba(156,39,176,0.3);
            " title="Ir a Distancia" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(156,39,176,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(156,39,176,0.3)'">
              <i class="fas fa-route"></i> Distancia
            </button>
            <button onclick="scrollToColumn(29)" class="quick-nav-btn" style="
              background: rgba(255,152,0,0.8);
              color: white;
              border: none;
              padding: 6px 12px;
              border-radius: 15px;
              font-size: 11px;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 2px 8px rgba(255,152,0,0.3);
            " title="Ir a Factibilidad" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(255,152,0,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(255,152,0,0.3)'">
              <i class="fas fa-check-circle"></i> Factibilidad
            </button>
            <button onclick="scrollToColumn(32)" class="quick-nav-btn" style="
              background: rgba(76,175,80,0.8);
              color: white;
              border: none;
              padding: 6px 12px;
              border-radius: 15px;
              font-size: 11px;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 2px 8px rgba(76,175,80,0.3);
            " title="Ir a Análisis" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(76,175,80,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(76,175,80,0.3)'">
              <i class="fas fa-info-circle"></i> Análisis
            </button>
          </div>

<table id="tabla">
  <thead>
  <tr>
    <th><input type="checkbox" id="checkTodos" onclick="toggleSeleccionarTodos(this)"></th>
    <th class="th-a" title="Identificador único del sitio A"><i class="fas fa-map-marker-alt"></i><br>ID A</th>
    <th class="th-a" title="Nombre del sitio A"><i class="fas fa-building"></i><br>Nombre A</th>
    <th class="th-a" title="Latitud del sitio A"><i class="fas fa-compass"></i><br>Lat A</th>
    <th class="th-a" title="Longitud del sitio A"><i class="fas fa-globe"></i><br>Lon A</th>
    <th class="th-a" title="Latitud en radianes del sitio A"><i class="fas fa-calculator"></i><br>Lat A (rad)</th>
    <th class="th-a" title="Longitud en radianes del sitio A"><i class="fas fa-calculator"></i><br>Lon A (rad)</th>
    <th class="th-b" title="Identificador único del sitio B"><i class="fas fa-map-marker-alt"></i><br>ID B</th>
    <th class="th-b" title="Nombre del sitio B"><i class="fas fa-building"></i><br>Nombre B</th>
    <th class="th-b" title="Latitud del sitio B"><i class="fas fa-compass"></i><br>Lat B</th>
    <th class="th-b" title="Longitud del sitio B"><i class="fas fa-globe"></i><br>Lon B</th>
    <th class="th-b" title="Latitud en radianes del sitio B"><i class="fas fa-calculator"></i><br>Lat B (rad)</th>
    <th class="th-b" title="Longitud en radianes del sitio B"><i class="fas fa-calculator"></i><br>Lon B (rad)</th>
    <th class="th-calc" title="Distancia calculada entre sitios (km)"><i class="fas fa-route"></i><br>Distancia (km)</th>
    <th class="th-calc" title="Frecuencia recomendada según distancia"><i class="fas fa-broadcast-tower"></i><br>Frecuencia (GHz)</th>
    <th class="th-calc" title="Disponibilidad anual (%)"><i class="fas fa-percentage"></i><br>Disponibilidad</th>
    <th class="th-tech" title="Altura de la torre A"><i class="fas fa-arrows-alt-v"></i><br>Altura Torre A</th>
    <th class="th-tech" title="Altura de la torre B"><i class="fas fa-arrows-alt-v"></i><br>Altura Torre B</th>
    <th class="th-tech" title="Altura RAN A"><i class="fas fa-wifi"></i><br>Altura RAN A</th>
    <th class="th-tech" title="Altura RAN B"><i class="fas fa-wifi"></i><br>Altura RAN B</th>
    <th class="th-trans" title="Tipo de transporte sitio A"><i class="fas fa-truck"></i><br>Transporte A</th>
    <th class="th-trans" title="Tipo de transporte sitio B"><i class="fas fa-truck"></i><br>Transporte B</th>
    <th class="th-arr" title="Tipo de arrendamiento A"><i class="fas fa-handshake"></i><br>Arrendamiento A</th>
    <th class="th-arr" title="Tipo de arrendamiento B"><i class="fas fa-handshake"></i><br>Arrendamiento B</th>
    <th class="th-onair" title="Estado operativo A"><i class="fas fa-power-off"></i><br>On Air A</th>
    <th class="th-onair" title="Estado operativo B"><i class="fas fa-power-off"></i><br>On Air B</th>
    <th class="th-tower" title="Tipo de torre A"><i class="fas fa-tower-broadcast"></i><br>Tipo Torre A</th>
    <th class="th-tower" title="Tipo de torre B"><i class="fas fa-tower-broadcast"></i><br>Tipo Torre B</th>
    <th class="th-state" title="Estado A"><i class="fas fa-flag"></i><br>Estado A</th>
    <th class="th-state" title="Estado B"><i class="fas fa-flag"></i><br>Estado B</th>
    <th class="th-fact" title="¿Enlace factible?" style="font-weight: bold; text-align: center;"><i class="fas fa-check-circle"></i><br>Factible</th>
    <th class="th-fact" title="Antenas requeridas" style="font-weight: bold;"><i class="fas fa-satellite-dish"></i><br>Antenas</th>
    <th class="th-fact" title="Tipo de enlace" style="font-weight: bold;"><i class="fas fa-network-wired"></i><br>Tipo Enlace</th>
    <th class="th-fact" title="Análisis detallado" style="font-weight: bold;"><i class="fas fa-info-circle"></i><br>Análisis</th>
  </tr>
</thead>
  <tbody></tbody>
</table>
        </div>
        
        <!-- Panel de detalles del enlace seleccionado -->
        <div id="panel-detalles" style="display: none;">
          <!-- El contenido se cargará dinámicamente -->
        </div>
        
        <div id="mensaje-sin-enlaces" class="mensaje-sin-enlaces-modern" style="display: none;">
          <div class="empty-state-icon">
            <i class="fas fa-broadcast-tower"></i>
          </div>
          <h3 class="empty-state-title">No hay enlaces registrados</h3>
          <p class="empty-state-description">Usa el formulario para agregar tu primer enlace PtP</p>
          <button class="btn-modern btn-primary" onclick="mostrarPestana('formulario')">
            <div class="btn-icon">
              <i class="fas fa-plus"></i>
            </div>
            <span class="btn-text">Agregar Primer Enlace</span>
            <div class="btn-ripple"></div>
          </button>
        </div>
      </div>
      <div id="tab-mismoTransporte" class="tab-content">
        <div class="enlaces-header-modern">
          <div class="enlaces-title-section">
            <h2 class="enlaces-title">
              <i class="fas fa-exchange-alt"></i> 
              <span>Análisis de Conectividad de Transporte</span>
              <div class="title-underline"></div>
            </h2>
            <div class="enlaces-stats">
              <div class="stat-item">
                <i class="fas fa-network-wired"></i>
                <span id="total-mismo-transporte">0</span>
                <label>Enlaces Analizados</label>
              </div>
              <div class="stat-item">
                <i class="fas fa-check-circle"></i>
                <span id="factibles-mismo-transporte">0</span>
                <label>Conectividad Viable</label>
              </div>
              <div class="stat-item">
                <i class="fas fa-times-circle"></i>
                <span id="no-factibles-mismo-transporte">0</span>
                <label>Conectividad No Viable</label>
              </div>
            </div>
          </div>
        </div>
        
        <div class="table-container-modern">
          <div class="table-wrapper">
            <div id="tabla-mismo-transporte"></div>
          </div>
        </div>
      </div>
     <div id="tab-resumen" class="tab-content">
       <!-- ===== DASHBOARD INTERACTIVO ===== -->
       <div class="enlaces-header-modern">
         <div class="enlaces-title-section">
                       <h2 class="enlaces-title">
              <i class="fas fa-chart-pie"></i> 
              <span>Dashboard de Conectividad</span>
              <div class="title-underline"></div>
            </h2>
            <div class="enlaces-stats">
              <div class="stat-item">
                <i class="fas fa-satellite-dish"></i>
                <span id="resumen-total-enlaces">0</span>
                <label>Infraestructura Total</label>
              </div>
              <div class="stat-item">
                <i class="fas fa-check-circle"></i>
                <span id="resumen-enlaces-factibles" style="color:#10b981;">0</span>
                <label>Enlaces Operativos</label>
              </div>
              <div class="stat-item">
                <i class="fas fa-times-circle"></i>
                <span id="resumen-enlaces-no-factibles">0</span>
                <label>Enlaces No Operativos</label>
              </div>
            </div>
         </div>
         
         <div class="enlaces-controls-modern">
           <div class="button-group-primary">
             <button class="btn-modern btn-success" onclick="exportarFactiblesParaPathloss()">
               <div class="btn-icon">
                 <i class="fas fa-file-export"></i>
               </div>
               <span class="btn-text">Exportar Enlaces Operativos</span>
               <div class="btn-ripple"></div>
             </button>
             
             <button class="btn-modern btn-danger" id="btnDescargarFaltantes" style="display:none;">
               <div class="btn-icon">
                 <i class="fas fa-download"></i>
               </div>
               <span class="btn-text">Descargar Análisis de Falla</span>
               <div class="btn-ripple"></div>
             </button>
           </div>
         </div>
       </div>

       <!-- ===== MÉTRICAS EN TIEMPO REAL ===== -->
       <div class="dashboard-grid">
         <div class="metric-card" onclick="mostrarDetalleMetrica('total')">
           <div class="metric-header">
             <div class="metric-icon primary">
               <i class="fas fa-network-wired"></i>
             </div>
             <div class="metric-trend positive">
               <i class="fas fa-arrow-up"></i> +12%
             </div>
           </div>
           <div class="metric-value" id="metric-total-enlaces">0</div>
           <div class="metric-label">Total de Enlaces</div>
           <div class="metric-chart" id="chart-total"></div>
         </div>

         <div class="metric-card" onclick="mostrarDetalleMetrica('factibles')">
           <div class="metric-header">
             <div class="metric-icon success">
               <i class="fas fa-check-circle"></i>
             </div>
             <div class="metric-trend positive">
               <i class="fas fa-arrow-up"></i> +8%
             </div>
           </div>
           <div class="metric-value" id="metric-enlaces-factibles">0</div>
           <div class="metric-label">Enlaces Factibles</div>
           <div class="metric-chart" id="chart-factibles"></div>
         </div>

         <div class="metric-card" onclick="mostrarDetalleMetrica('no-factibles')">
           <div class="metric-header">
             <div class="metric-icon danger">
               <i class="fas fa-times-circle"></i>
             </div>
             <div class="metric-trend negative">
               <i class="fas fa-arrow-down"></i> -5%
             </div>
           </div>
           <div class="metric-value" id="metric-enlaces-no-factibles">0</div>
           <div class="metric-label">Enlaces No Factibles</div>
           <div class="metric-chart" id="chart-no-factibles"></div>
         </div>

         <div class="metric-card" onclick="mostrarDetalleMetrica('cobertura')">
           <div class="metric-header">
             <div class="metric-icon warning">
               <i class="fas fa-signal"></i>
             </div>
             <div class="metric-trend positive">
               <i class="fas fa-arrow-up"></i> +15%
             </div>
           </div>
           <div class="metric-value" id="metric-cobertura">0%</div>
           <div class="metric-label">Cobertura de Red</div>
           <div class="metric-chart" id="chart-cobertura"></div>
         </div>
       </div>

       <!-- ===== GRÁFICOS Y ANALYTICS ===== -->
       <div class="analytics-container">
         <div class="analytics-header">
           <div class="analytics-title">
             <i class="fas fa-chart-line"></i>
             <h3>Análisis de Rendimiento</h3>
           </div>
           <div class="map-controls">
             <button class="map-control-btn active" onclick="cambiarPeriodoGrafico('semana')">
               <i class="fas fa-calendar-week"></i> Semana
</button>
             <button class="map-control-btn" onclick="cambiarPeriodoGrafico('mes')">
               <i class="fas fa-calendar-alt"></i> Mes
      </button>
             <button class="map-control-btn" onclick="cambiarPeriodoGrafico('año')">
               <i class="fas fa-calendar"></i> Año
      </button>
    </div>
         </div>
         <div class="chart-container" id="chart-container">
           <canvas id="performanceChart"></canvas>
         </div>
       </div>

       <!-- ===== MAPA INTERACTIVO ===== -->
       <div class="map-container-advanced">
         <div class="map-header">
           <div class="map-title">
             <i class="fas fa-map-marked-alt"></i>
             <h3>Visualización Geográfica</h3>
           </div>
           <div class="map-controls">
             <button class="map-control-btn active" onclick="cambiarVistaMapa('todos')">
               <i class="fas fa-globe"></i> Todos
             </button>
             <button class="map-control-btn" onclick="cambiarVistaMapa('factibles')">
               <i class="fas fa-check-circle"></i> Factibles
             </button>
             <button class="map-control-btn" onclick="cambiarVistaMapa('no-factibles')">
               <i class="fas fa-times-circle"></i> No Factibles
             </button>
             <button class="map-control-btn" onclick="cambiarVistaMapa('cluster')">
               <i class="fas fa-layer-group"></i> Agrupar
             </button>
           </div>
         </div>

         <div class="map-filters">
           <div class="map-filter-group">
             <label class="map-filter-label">Frecuencia:</label>
             <select class="map-filter-select" id="filter-frecuencia" onchange="aplicarFiltrosMapa()">
               <option value="">Todas</option>
               <option value="80">80 GHz</option>
               <option value="15">15 GHz</option>
               <option value="8">8 GHz</option>
             </select>
           </div>
           <div class="map-filter-group">
             <label class="map-filter-label">Distancia:</label>
             <select class="map-filter-select" id="filter-distancia" onchange="aplicarFiltrosMapa()">
               <option value="">Todas</option>
               <option value="0-5">0-5 km</option>
               <option value="5-15">5-15 km</option>
               <option value="15+">15+ km</option>
             </select>
           </div>
           <div class="map-filter-group">
             <label class="map-filter-label">Estado:</label>
             <select class="map-filter-select" id="filter-estado" onchange="aplicarFiltrosMapa()">
               <option value="">Todos</option>
               <option value="operativo">Operativo</option>
               <option value="mantenimiento">Mantenimiento</option>
               <option value="fuera">Fuera de Servicio</option>
             </select>
           </div>
         </div>

         <div id="mapa-enlaces"></div>

         <div class="map-legend">
           <div class="legend-item">
             <div class="legend-color factible"></div>
             <span>Enlaces Factibles</span>
           </div>
           <div class="legend-item">
             <div class="legend-color no-factible"></div>
             <span>Enlaces No Factibles</span>
           </div>
           <div class="legend-item">
             <div class="legend-color indef"></div>
             <span>Estado Indefinido</span>
           </div>
         </div>
       </div>

       <!-- ===== BÚSQUEDA Y FILTROS AVANZADOS ===== -->
       <div class="search-filters-container">
         <div class="search-bar">
           <input type="text" class="search-input" id="search-enlaces" placeholder="Buscar enlaces por ID, nombre o coordenadas..." onkeyup="buscarEnlaces(this.value)">
           <button class="search-btn" onclick="buscarEnlaces(document.getElementById('search-enlaces').value)">
             <i class="fas fa-search"></i>
             Buscar
           </button>
         </div>
         
         <div class="filters-grid">
           <div class="filter-group">
             <label class="filter-label">Tipo de Torre</label>
             <select class="filter-select" id="filter-torre" onchange="aplicarFiltros()">
               <option value="">Todas</option>
               <option value="autosoportada">Autosoportada</option>
               <option value="mastil">Mastil</option>
               <option value="edificio">Edificio</option>
             </select>
           </div>
           <div class="filter-group">
             <label class="filter-label">Tipo de Transporte</label>
             <select class="filter-select" id="filter-transporte" onchange="aplicarFiltros()">
               <option value="">Todos</option>
               <option value="fibra">Fibra Óptica</option>
               <option value="radio">Radio</option>
               <option value="satelital">Satelital</option>
             </select>
           </div>
           <div class="filter-group">
             <label class="filter-label">Arrendamiento</label>
             <select class="filter-select" id="filter-arrendamiento" onchange="aplicarFiltros()">
               <option value="">Todos</option>
               <option value="propio">Propio</option>
               <option value="arrendado">Arrendado</option>
               <option value="compartido">Compartido</option>
             </select>
           </div>
           <div class="filter-group">
             <label class="filter-label">Rango de Fechas</label>
             <select class="filter-select" id="filter-fechas" onchange="aplicarFiltros()">
               <option value="">Todas</option>
               <option value="hoy">Hoy</option>
               <option value="semana">Esta Semana</option>
               <option value="mes">Este Mes</option>
               <option value="año">Este Año</option>
             </select>
           </div>
         </div>
    </div>
  </div>
  <div id="mapa-enlaces" style="width:100%;max-width:900px;height:480px;margin:32px auto 0 auto;border-radius:18px;box-shadow:0 2px 18px #00bcd455;">
  </div>
</div>
<div id="panel-detalle-enlace">
  <button onclick="document.getElementById('panel-detalle-enlace').style.display='none'" style="position:absolute; top:12px; right:16px; background:none; border:none; font-size:1.5rem; color:#888; cursor:pointer;"><i class="fas fa-times"></i></button>
  <div id="detalle-enlace-contenido"></div>
</div>
<div id="segmentacion-estados" style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:24px 0 0 0;">
</div>
    </div>
  </div>
<!-- Script duplicado eliminado para evitar conflictos -->

</script>
<div id="modal-analisis" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(30,30,40,0.7); align-items:center; justify-content:center;">
  <div style="background: rgba(15, 23, 42, 0.95); border-radius:18px; max-width:420px; width:90%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:32px 24px 24px 24px; position:relative; animation:fadeInUp 0.3s;">
    <button onclick="cerrarModalAnalisis()" style="position:absolute; top:12px; right:16px; background:none; border:none; font-size:1.5rem; color:#888; cursor:pointer;"><i class="fas fa-times"></i></button>
    <div id="modal-analisis-icono" style="font-size:2.5rem; margin-bottom:10px;"></div>
    <div id="modal-analisis-titulo" style="font-size:1.3rem; font-weight:700; margin-bottom:10px;"></div>
    <div id="modal-analisis-resumen" style="font-size:1rem; margin-bottom:10px; color:#444;"></div>
    <ul id="modal-analisis-lista" style="padding-left:20px; margin-bottom:0; color:#333; font-size:0.98rem;"></ul>
    
  </div>
</div>
<div id="modal-parametros-radio" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(30,30,40,0.7); align-items:center; justify-content:center;">
  <div style="background: rgba(15, 23, 42, 0.95); border-radius:18px; max-width:420px; width:90%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:32px 24px 24px 24px; position:relative;">
    <button onclick="cerrarPanelParametrosRadio()" style="position:absolute; top:12px; right:16px; background:none; border:none; font-size:1.5rem; color:#888; cursor:pointer;"><i class="fas fa-times"></i></button>
    <h3>Parámetros de Radioenlace</h3>
    <div>
      <label>Potencia TX (dBm): <input type="number" id="potenciaTX" value="20"></label><br>
      <label>Ganancia Antena A (dBi): <input type="number" id="gananciaA" value="30"></label><br>
      <label>Ganancia Antena B (dBi): <input type="number" id="gananciaB" value="30"></label><br>
      <label>Pérdidas (dB): <input type="number" id="perdidas" value="2"></label><br>
      <label>Frecuencia (GHz): <input type="number" id="frecuenciaRadio" value="15"></label><br>
      <label>Distancia (km): <input type="number" id="distanciaRadio" value="10"></label><br>
      <label>Margen de desvanecimiento (dB): <input type="number" id="fadeMargin" value="30"></label><br>
      <button class="btn btn-success" onclick="calcularParametrosRadio()">Calcular</button>
    </div>
    <div id="resultado-parametros-radio" style="margin-top:12px; color:#222;"></div>
  </div>
</div>

<!-- ===== CERRAR MAIN EMPRESARIAL ===== -->
</main>

<div id="modal-equipos-antenas" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(30,30,40,0.7); align-items:center; justify-content:center;">
  <div style="background: rgba(15, 23, 42, 0.95); border-radius:18px; max-width:420px; width:90%; margin:auto; box-shadow:0 8px 32px rgba(0,0,0,0.25); padding:32px 24px 24px 24px; position:relative;">
    <button onclick="cerrarPanelEquiposAntenas()" style="position:absolute; top:12px; right:16px; background:none; border:none; font-size:1.5rem; color:#888; cursor:pointer;"><i class="fas fa-times"></i></button>
    <h3>Gestión de Equipos y Antenas</h3>
    <div>
      <label>Modelo Radio: <input type="text" id="modeloRadio" value="Ej: Ubiquiti AirFiber"></label><br>
      <label>Modelo Antena: <input type="text" id="modeloAntena" value="Ej: Dish 30dBi"></label><br>
      <label>Ganancia (dBi): <input type="number" id="gananciaAntena" value="30"></label><br>
      <button class="btn btn-success" onclick="guardarEquipoAntena()">Guardar</button>
    </div>
    <div id="lista-equipos-antenas" style="margin-top:12px; color:#222;"></div>
  </div>
</div>
<!-- ===== FUNCIONES JAVASCRIPT EMPRESARIALES ===== -->
<script>
// ===== FUNCIONES DEL DASHBOARD EJECUTIVO =====
function actualizarKPIsEjecutivos() {
  // Obtener datos reales de la base de datos
  const totalEnlaces = document.querySelectorAll('#tabla tbody tr').length;
  const enlacesFactibles = document.querySelectorAll('#tabla .badge-factible').length;
  const enlacesNoFactibles = document.querySelectorAll('#tabla .badge-nofactible').length;
  const enlacesIndef = document.querySelectorAll('#tabla .badge-indef').length;
  
  // Actualizar KPIs ejecutivos
  document.getElementById('executive-total-enlaces').textContent = totalEnlaces;
  document.getElementById('executive-enlaces-factibles').textContent = enlacesFactibles;
  document.getElementById('executive-enlaces-criticos').textContent = enlacesIndef;
  document.getElementById('executive-enlaces-fuera').textContent = enlacesNoFactibles;
  
  // Calcular tendencias (simulado para demostración)
  actualizarTendenciasKPIs();
}

function actualizarTendenciasKPIs() {
  // Simular tendencias basadas en datos históricos
  const tendencias = document.querySelectorAll('.kpi-trend');
  tendencias.forEach(tendencia => {
    const valor = Math.random() > 0.5 ? 'positive' : 'negative';
    const porcentaje = Math.floor(Math.random() * 20) + 1;
    const icono = valor === 'positive' ? 'fa-arrow-up' : 'fa-arrow-down';
    
    tendencia.className = `kpi-trend ${valor}`;
    tendencia.innerHTML = `<i class="fas ${icono}"></i> ${valor === 'positive' ? '+' : '-'}${porcentaje}%`;
  });
}

// ===== FUNCIONES DE NAVEGACIÓN EMPRESARIAL =====
function activarNavegacion(seccion) {
  // Remover clase active de todos los elementos
  document.querySelectorAll('.corporate-nav-item').forEach(item => item.classList.remove('active'));
  document.querySelectorAll('.sidebar-menu-link').forEach(item => item.classList.remove('active'));
  
  // Activar elemento seleccionado
  event.target.closest('.corporate-nav-item').classList.add('active');
  
  // Mostrar notificación
  mostrarNotificacion('Navegación', `Cambiado a sección: ${seccion}`, 'success');
}

// ===== FUNCIONES DE USUARIO =====
function mostrarPerfilUsuario() {
  const userProfile = document.querySelector('.user-profile');
  if (userProfile) {
    userProfile.addEventListener('click', function() {
      mostrarNotificacion('Perfil de Usuario', 'Funcionalidad de perfil en desarrollo', 'info');
    });
  }
}

// ===== FUNCIONES DE ACTIVIDAD =====
function actualizarActividadReciente() {
  const actividades = [
    {
      tipo: 'create',
      texto: 'Nuevo enlace PtP agregado: Torre A - Torre B',
      tiempo: 'Hace 5 minutos'
    },
    {
      tipo: 'update',
      texto: 'Enlace actualizado: Cambios en configuración de frecuencia',
      tiempo: 'Hace 15 minutos'
    },
    {
      tipo: 'export',
      texto: 'Reporte de factibilidad exportado a Excel',
      tiempo: 'Hace 1 hora'
    },
    {
      tipo: 'update',
      texto: 'Sincronización automática completada',
      tiempo: 'Hace 2 horas'
    }
  ];
  
  const activityList = document.querySelector('.activity-list');
  if (activityList) {
    activityList.innerHTML = '';
    actividades.forEach(actividad => {
      const li = document.createElement('li');
      li.className = 'activity-item';
      li.innerHTML = `
        <div class="activity-icon ${actividad.tipo}">
          <i class="fas fa-${actividad.tipo === 'create' ? 'plus' : actividad.tipo === 'update' ? 'edit' : actividad.tipo === 'export' ? 'file-export' : 'sync-alt'}"></i>
        </div>
        <div class="activity-content">
          <div class="activity-text">${actividad.texto}</div>
          <div class="activity-time">${actividad.tiempo}</div>
        </div>
      `;
      activityList.appendChild(li);
    });
  }
}

// ===== FUNCIONES DE BOTONES CORPORATIVOS =====
function nuevoEnlace() {
  mostrarNotificacion('Nuevo Enlace', 'Abriendo formulario para nuevo enlace PtP', 'success');
  // Aquí se abriría el formulario de nuevo enlace
}

function exportarReporte() {
  mostrarNotificacion('Exportar Reporte', 'Generando reporte ejecutivo...', 'info');
  setTimeout(() => {
    mostrarNotificacion('Reporte Exportado', 'Reporte descargado exitosamente', 'success');
  }, 2000);
}

function actualizarDatos() {
  mostrarNotificacion('Actualizando Datos', 'Sincronizando con base de datos...', 'info');
  setTimeout(() => {
    actualizarKPIsEjecutivos();
    actualizarActividadReciente();
    mostrarNotificacion('Datos Actualizados', 'Sincronización completada', 'success');
  }, 1500);
}

// ===== SISTEMA DE PROCESAMIENTO AVANZADO =====
let processingState = {
  isActive: false,
  isPaused: false,
  currentStep: 0,
  totalSteps: 4,
  currentPair: 0,
  totalPairs: 4000,
  startTime: null,
  estimatedTime: 12000 // 12 segundos en modo turbo
};

// ===== FUNCIONES DE PROCESAMIENTO =====
function validarEstructuraPar(par) {
  // Validar que sea un array con al menos 2 elementos (idA, idB)
  if (!Array.isArray(par) || par.length < 2) {
    console.error('❌ Par no es un array válido con al menos 2 elementos:', par);
    return false;
  }
  
  // Validar que los primeros dos elementos sean IDs válidos
  const idA = par[0];
  const idB = par[1];
  
  if (!idA || !idB || (typeof idA === 'string' && idA.trim() === '') || (typeof idB === 'string' && idB.trim() === '')) {
    console.error('❌ IDs de torres inválidos:', { idA, idB });
    return false;
  }
  
  console.log('✅ Estructura de par válida - Array con IDs:', { idA, idB });
  return true;
}

function actualizarKPIsEjecutivosConDatosReales(resultados) {
  try {
    const totalEnlaces = resultados.length;
    const enlacesFactibles = resultados.filter(r => r.estado === 'factible').length;
    const enlacesNoFactibles = resultados.filter(r => r.estado === 'no-factible').length;
    const cobertura = totalEnlaces > 0 ? Math.round((enlacesFactibles / totalEnlaces) * 100) : 0;
    
    // Actualizar KPIs ejecutivos
    const kpiTotal = document.getElementById('executive-total-enlaces');
    const kpiFactibles = document.getElementById('executive-enlaces-factibles');
    const kpiCriticos = document.getElementById('executive-enlaces-criticos');
    const kpiFuera = document.getElementById('executive-enlaces-fuera');
    
    if (kpiTotal) kpiTotal.textContent = totalEnlaces;
    if (kpiFactibles) kpiFactibles.textContent = enlacesFactibles;
    if (kpiCriticos) kpiCriticos.textContent = enlacesNoFactibles;
    if (kpiFuera) kpiFuera.textContent = enlacesNoFactibles;
    
    // Actualizar KPIs del dashboard
    const metricTotal = document.getElementById('metric-total-enlaces');
    const metricFactibles = document.getElementById('metric-enlaces-factibles');
    const metricNoFactibles = document.getElementById('metric-enlaces-no-factibles');
    const metricCobertura = document.getElementById('metric-cobertura');
    
    if (metricTotal) metricTotal.textContent = totalEnlaces;
    if (metricFactibles) metricTotal.textContent = enlacesFactibles;
          if (metricNoFactibles) metricNoFactibles.textContent = enlacesNoFactibles;
    if (metricCobertura) metricCobertura.textContent = cobertura + '%';
    
    console.log('✅ KPIs actualizados con datos reales');
    
  } catch (error) {
    console.error('❌ Error actualizando KPIs:', error);
  }
}

function iniciarProcesamientoPares() {
  if (processingState.isActive) {
    mostrarNotificacion('Procesamiento', 'Ya hay un proceso activo', 'warning');
    return;
  }

  // VERIFICAR SI HAY DATOS CARGADOS EN LAS VARIABLES JAVASCRIPT
  console.log('🔍 Verificando variables JavaScript...');
  console.log('📊 window.dataExcel:', window.dataExcel);
  console.log('📊 window.dataExcel.length:', window.dataExcel ? window.dataExcel.length : 'undefined');
  console.log('📊 window.dataPares:', window.dataPares);
  console.log('📊 window.dataPares.length:', window.dataPares ? window.dataPares.length : 'undefined');
  console.log('🌐 window object:', typeof window);
  console.log('🔍 window.dataExcel type:', typeof window.dataExcel);
  console.log('🔍 window.dataExcel isArray:', Array.isArray(window.dataExcel));
  
  // Usar directamente las variables JavaScript en lugar de localStorage
  if (!window.dataExcel || !window.dataExcel.length) {
    mostrarNotificacion('Error', 'No hay datos de torres cargados. Carga el archivo Excel primero.', 'error');
    console.error('❌ dataExcel no está disponible');
    console.error('❌ window.dataExcel:', window.dataExcel);
    console.error('❌ window.dataExcel.length:', window.dataExcel ? window.dataExcel.length : 'undefined');
    return;
  }
  
  if (!window.dataPares || !window.dataPares.length) {
    mostrarNotificacion('Error', 'No hay pares para procesar. Carga el archivo de pares primero.', 'error');
    console.error('❌ dataPares no está disponible');
    return;
  }
  
  // VALIDAR ESTRUCTURA DE DATOS
  const primerPar = window.dataPares[0];
  console.log('🔍 Primer par para validación:', primerPar);
  
  if (!validarEstructuraPar(primerPar)) {
    mostrarNotificacion('Error', 'Estructura de datos inválida. Verifica el formato del archivo de pares.', 'error');
    console.error('❌ Estructura de par inválida:', primerPar);
    return;
  }

  // VERIFICAR SI YA HAY RESULTADOS PROCESADOS
  let enlacesExistentes = [];
  try {
    const enlacesStorage = localStorage.getItem('enlacesPtP');
    if (enlacesStorage && enlacesStorage !== 'undefined' && enlacesStorage !== 'null') {
      enlacesExistentes = JSON.parse(enlacesStorage);
    }
  } catch (error) {
    console.warn('⚠️ Error parseando enlaces existentes:', error);
    enlacesExistentes = [];
  }
  
  if (enlacesExistentes.length > 0) {
    const confirmar = confirm(`Ya hay ${enlacesExistentes.length} enlaces procesados. ¿Quieres procesar de nuevo?`);
    if (!confirmar) return;
  }

  processingState.isActive = true;
  processingState.isPaused = false;
  processingState.currentStep = 0;
  processingState.currentPair = 0;
  processingState.startTime = Date.now();
  processingState.totalPairs = window.dataPares.length;

  mostrarOverlayProcesamiento();
  actualizarEstadoProcesamiento();
  iniciarProcesamientoAutomatico();
  
  mostrarNotificacion('Procesamiento Iniciado', `Modo TURBO activado para ${window.dataPares.length} pares`, 'success');
}

function mostrarOverlayProcesamiento() {
  const overlay = document.getElementById('processingOverlay');
  if (overlay) {
    overlay.classList.add('active');
  }
}

function ocultarOverlayProcesamiento() {
  const overlay = document.getElementById('processingOverlay');
  if (overlay) {
    overlay.classList.remove('active');
  }
}

function actualizarEstadoProcesamiento() {
  // Actualizar barra de progreso
  const progressFill = document.getElementById('progressFill');
  const progressPercentage = document.getElementById('progressPercentage');
  const progressCount = document.getElementById('progressCount');
  
  if (progressFill && progressPercentage && progressCount) {
    // Validar que los números sean válidos
    const current = processingState.currentPair || 0;
    const total = processingState.totalPairs || 0;
    
    if (total > 0 && !isNaN(current) && !isNaN(total)) {
      const porcentaje = Math.round((current / total) * 100);
      progressFill.style.width = porcentaje + '%';
      progressPercentage.textContent = porcentaje + '%';
      progressCount.textContent = `${current} / ${total} pares`;
    } else {
      // Caso de error - mostrar valores por defecto
      progressFill.style.width = '0%';
      progressPercentage.textContent = '0%';
      progressCount.textContent = '0 / 0 pares';
      console.warn('⚠️ Valores inválidos en estado de procesamiento:', { current, total });
    }
  }

  // Actualizar estados de los pasos
  actualizarEstadosPasos();
}

function actualizarEstadosPasos() {
  const pasos = [
    { id: 'statusValidacion', nombre: 'Validación' },
    { id: 'statusCalculo', nombre: 'Cálculo' },
    { id: 'statusAnalisis', nombre: 'Análisis' },
    { id: 'statusFinalizacion', nombre: 'Finalización' }
  ];

  pasos.forEach((paso, index) => {
    const elemento = document.getElementById(paso.id);
    if (elemento) {
      const icono = elemento.querySelector('.status-icon');
      const tiempo = elemento.querySelector('.status-time');
      
      if (index < processingState.currentStep) {
        // Paso completado
        icono.className = 'status-icon completed';
        icono.innerHTML = '<i class="fas fa-check"></i>';
        tiempo.textContent = 'Completado';
        elemento.classList.add('active');
      } else if (index === processingState.currentStep) {
        // Paso en proceso
        icono.className = 'status-icon processing';
        icono.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        tiempo.textContent = 'En proceso...';
        elemento.classList.add('active');
      } else {
        // Paso pendiente
        icono.className = 'status-icon pending';
        icono.innerHTML = '<i class="fas fa-clock"></i>';
        tiempo.textContent = 'Pendiente';
        elemento.classList.remove('active');
      }
    }
  });
}

function iniciarProcesamientoAutomatico() {
  if (!processingState.isActive || processingState.isPaused) return;

  // Usar directamente las variables JavaScript
  if (!window.dataPares || !window.dataPares.length) {
    mostrarNotificacion('Error', 'No hay pares para procesar. Carga un archivo primero.', 'error');
    cancelarProcesamiento();
    return;
  }

  processingState.totalPairs = window.dataPares.length;
  processingState.currentPair = 0;
  
  // Inicializar array de resultados
  let resultados = [];
  let enlacesProcesados = 0;

  const procesarSiguientePar = () => {
    if (!processingState.isActive || processingState.isPaused) return;

    if (processingState.currentPair >= window.dataPares.length) {
      // Procesamiento completado
      finalizarProcesamientoConDatos(resultados);
      return;
    }

    const par = window.dataPares[processingState.currentPair];
    
    try {
      // PROCESAMIENTO REAL usando tu función existente
      const resultado = procesarParReal(par);
      resultados.push(resultado);
      
      // Actualizar progreso
      processingState.currentPair++;
      enlacesProcesados++;
      
      // Actualizar estado visual
      actualizarEstadoProcesamiento();
      
      // Cambiar paso basado en progreso real
      const progresoPaso = processingState.currentPair / window.dataPares.length;
      processingState.currentStep = Math.floor(progresoPaso * processingState.totalSteps);
      actualizarEstadosPasos();
      
      // Procesar siguiente par con delay para no bloquear la UI
      setTimeout(procesarSiguientePar, 10);
      
    } catch (error) {
      console.error('Error procesando par:', error);
      processingState.currentPair++;
      setTimeout(procesarSiguientePar, 10);
    }
  };

  // Iniciar procesamiento
  procesarSiguientePar();
}

function procesarParReal(par) {
  // DEBUG: Mostrar la estructura del par recibido
  console.log('🔍 Par recibido:', par);
  console.log('🔍 Tipo de par:', typeof par);
  console.log('🔍 Es array:', Array.isArray(par));
  
  // Extraer datos del par - dataPares es un array de arrays
  let distanciaKm = 0;
  let arreA = '';
  let arreB = '';
  let transA = '';
  let transB = '';
  let torreA = '';
  let torreB = '';
  let OnA = '';
  let OnB = '';
  
  if (Array.isArray(par) && par.length >= 2) {
    // dataPares es un array donde cada elemento es [idA, idB, ...]
    // Buscar en dataExcel las torres correspondientes
    const idA = par[0]?.toString().trim().toUpperCase();
    const idB = par[1]?.toString().trim().toUpperCase();
    
    console.log('🔍 IDs encontrados:', { idA, idB });
    
    // Buscar torre A en dataExcel
    let torreA_data = null;
    let torreB_data = null;
    
      for (let i = 0; i < window.dataExcel.length; i++) {
    if (window.dataExcel[i][0]?.toString().trim().toUpperCase() === idA) {
      torreA_data = window.dataExcel[i];
      break;
    }
  }
  
  for (let i = 0; i < window.dataExcel.length; i++) {
    if (window.dataExcel[i][0]?.toString().trim().toUpperCase() === idB) {
      torreB_data = window.dataExcel[i];
      break;
    }
  }
    
    if (torreA_data && torreB_data) {
      // Extraer datos de las torres encontradas
      const latA = parseFloat(torreA_data[11] || 0);
      const lonA = parseFloat(torreA_data[12] || 0);
      const latB = parseFloat(torreB_data[11] || 0);
      const lonB = parseFloat(torreB_data[12] || 0);
      
      // Calcular distancia real
      if (latA && lonA && latB && lonB) {
        distanciaKm = calcularDistancia(latA, lonA, latB, lonB);
      }
      
      // Extraer otros datos de las torres
      arreA = torreA_data[4] || ''; // Arrendamiento A
      arreB = torreB_data[4] || ''; // Arrendamiento B
      transA = torreA_data[103] || ''; // Transporte A
      transB = torreB_data[103] || ''; // Transporte B
      torreA = torreA_data[21] || ''; // Tipo Torre A
      torreB = torreB_data[21] || ''; // Tipo Torre B
      OnA = torreA_data[102] || ''; // On Air A
      OnB = torreB_data[102] || ''; // On Air B
      
      console.log('✅ Torres encontradas y datos extraídos');
    } else {
      console.warn('⚠️ No se encontraron ambas torres en dataExcel');
    }
  }
  
  // DEBUG: Mostrar datos extraídos
  console.log('📊 Datos extraídos:', {
    distanciaKm,
    arreA,
    arreB,
    transA,
    transB,
    torreA,
    torreB,
    OnA,
    OnB
  });
  
  // Validar que tenemos al menos la distancia
  if (!distanciaKm || isNaN(parseFloat(distanciaKm))) {
    console.warn('⚠️ Distancia inválida:', distanciaKm);
    distanciaKm = 0;
  }
  
  try {
    // LLAMAR A TU FUNCIÓN REAL DE ANÁLISIS
    const factibilidad = analizarFactibilidad(
      parseFloat(distanciaKm),
      arreA,
      arreB,
      transA,
      transB,
      torreA,
      torreB,
      OnA,
      OnB,
      true // esFactibleLOS
    );
    
    console.log('✅ Factibilidad calculada:', factibilidad);
    
    // Crear resultado estructurado
    const resultado = {
      id: Date.now() + Math.random(),
      par: par,
      factibilidad: factibilidad,
      timestamp: new Date().toISOString(),
      distancia: parseFloat(distanciaKm),
      torreA: torreA,
      torreB: torreB,
      estado: factibilidad && factibilidad.esFactible ? 'factible' : 'no-factible',
      detalles: {
        fresnelObstruido: factibilidad && factibilidad.fresnelObstruido ? factibilidad.fresnelObstruido : 0,
        margenDespeje: factibilidad && factibilidad.margenDespeje ? factibilidad.margenDespeje : 0,
        factorK: factibilidad && factibilidad.factorK ? factibilidad.factorK : 1.33,
        esFactibleLOS: factibilidad && factibilidad.esFactibleLOS !== undefined ? factibilidad.esFactibleLOS : true
      }
    };
    
    console.log('✅ Resultado creado:', resultado);
    return resultado;
    
  } catch (error) {
    console.error('❌ Error en analizarFactibilidad:', error);
    
    // Retornar resultado con error
    return {
      id: Date.now() + Math.random(),
      par: par,
      factibilidad: null,
      timestamp: new Date().toISOString(),
      distancia: parseFloat(distanciaKm),
      torreA: torreA,
      torreB: torreB,
      estado: 'error',
      detalles: {
        fresnelObstruido: 0,
        margenDespeje: 0,
        factorK: 1.33,
        esFactibleLOS: true,
        error: error.message
      }
    };
  }
}

function pausarProcesamiento() {
  processingState.isPaused = !processingState.isPaused;
  
  const btnPausar = document.getElementById('btnPausarProcesamiento');
  if (btnPausar) {
    if (processingState.isPaused) {
      btnPausar.innerHTML = '<i class="fas fa-play"></i> Reanudar';
      btnPausar.classList.remove('primary');
      btnPausar.classList.add('success');
      mostrarNotificacion('Procesamiento Pausado', 'El procesamiento se ha pausado', 'warning');
    } else {
      btnPausar.innerHTML = '<i class="fas fa-pause"></i> Pausar';
      btnPausar.classList.remove('success');
      btnPausar.classList.add('primary');
      mostrarNotificacion('Procesamiento Reanudado', 'El procesamiento se ha reanudado', 'success');
      iniciarProcesamientoAutomatico();
    }
  }
}

function cancelarProcesamiento() {
  if (confirm('¿Estás seguro de que quieres cancelar el procesamiento? Se perderá todo el progreso.')) {
    processingState.isActive = false;
    processingState.isPaused = false;
    processingState.currentStep = 0;
    processingState.currentPair = 0;
    
    ocultarOverlayProcesamiento();
    mostrarNotificacion('Procesamiento Cancelado', 'El procesamiento se ha cancelado', 'info');
    
    // Resetear botón de pausar
    const btnPausar = document.getElementById('btnPausarProcesamiento');
    if (btnPausar) {
      btnPausar.innerHTML = '<i class="fas fa-pause"></i> Pausar';
      btnPausar.classList.remove('success');
      btnPausar.classList.add('primary');
    }
  }
}

function finalizarProcesamientoConDatos(resultados) {
  processingState.isActive = false;
  processingState.currentStep = processingState.totalSteps;
  
  // Marcar todos los pasos como completados
  actualizarEstadosPasos();
  
  // Mostrar mensaje de éxito
  const processingTitle = document.querySelector('.processing-title');
  const processingSubtitle = document.querySelector('.processing-subtitle');
  
  if (processingTitle) processingTitle.textContent = '¡Procesamiento Completado!';
  if (processingSubtitle) processingSubtitle.textContent = `${resultados.length} pares analizados y guardados`;
  
  // Cambiar icono a éxito
  const processingIcon = document.querySelector('.processing-icon');
  if (processingIcon) {
    processingIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
    processingIcon.style.background = 'var(--gradient-accent)';
    processingIcon.style.animation = 'none';
  }
  
  // GUARDAR DATOS REALES EN LOCALSTORAGE
  guardarResultadosEnLocalStorage(resultados);
  
  // ACTUALIZAR TABLA EXISTENTE
  actualizarTablaConResultados(resultados);
  
  // Actualizar KPIs ejecutivos con datos reales
  actualizarKPIsEjecutivosConDatosReales(resultados);
  
  // Ocultar overlay después de 3 segundos
  setTimeout(() => {
    ocultarOverlayProcesamiento();
    mostrarNotificacion('Procesamiento Exitoso', `${resultados.length} pares procesados y guardados`, 'success');
  }, 3000);
}

function guardarResultadosEnLocalStorage(resultados) {
  try {
    // Guardar en la clave que usa tu sistema existente
    localStorage.setItem('enlacesPtP', JSON.stringify(resultados));
    
    // También guardar en la clave de enlaces procesados
    localStorage.setItem('enlacesProcesados', JSON.stringify(resultados));
    
    // Guardar información del procesamiento
    const infoProcesamiento = {
      timestamp: new Date().toISOString(),
      totalPares: resultados.length,
      enlacesFactibles: resultados.filter(r => r.estado === 'factible').length,
      enlacesNoFactibles: resultados.filter(r => r.estado === 'no-factible').length,
      tiempoProcesamiento: Date.now() - processingState.startTime
    };
    
    localStorage.setItem('infoProcesamiento', JSON.stringify(infoProcesamiento));
    
    console.log('✅ Datos guardados en localStorage:', infoProcesamiento);
    
  } catch (error) {
    console.error('❌ Error guardando en localStorage:', error);
    mostrarNotificacion('Error', 'Error al guardar los resultados', 'error');
  }
}

// ===== SISTEMA DE PROCESAMIENTO ROBUSTO =====
let procesamientoActivo = false;
let procesamientoCancelado = false;
let procesamientoPausado = false;

function actualizarTablaConResultados(resultados) {
  if (procesamientoActivo) {
    console.log('⚠️ Procesamiento ya en curso, cancelando...');
    return;
  }
  
  try {
    console.log('🚀 === INICIANDO PROCESAMIENTO ROBUSTO ===');
    console.log('📊 Total de resultados:', resultados.length);
    
    if (!Array.isArray(resultados)) {
      console.error('❌ Los resultados no son un array:', resultados);
      return;
    }
    
    // Configurar estado de procesamiento
    procesamientoActivo = true;
    procesamientoCancelado = false;
    procesamientoPausado = false;
    
    // Crear overlay de procesamiento
    crearOverlayProcesamiento(resultados.length);
    
    // Iniciar procesamiento por lotes
    procesarResultadosPorLotes(resultados);
    
  } catch (error) {
    console.error('❌ Error iniciando procesamiento:', error);
    procesamientoActivo = false;
    mostrarNotificacion('Error', 'Error al iniciar el procesamiento', 'error');
  }
}

function procesarResultadosPorLotes(resultados) {
  const BATCH_SIZE = 100; // Procesar 100 enlaces por lote
  const DELAY_BETWEEN_BATCHES = 10; // 10ms entre lotes para no bloquear la UI
  
  let currentIndex = 0;
  let enlacesProcesados = [];
  let startTime = Date.now();
  
  // Crear mapa de torres para búsqueda rápida
  console.log('🔍 Creando mapa de torres para búsqueda rápida...');
  const mapaTorres = new Map();
  window.dataExcel.forEach((row, index) => {
    if (row[0]) {
      mapaTorres.set(row[0].toString().trim().toUpperCase(), row);
    }
  });
  console.log(`✅ Mapa de torres creado: ${mapaTorres.size} torres indexadas`);
  
  function procesarLote() {
    if (procesamientoCancelado) {
      console.log('⏹️ Procesamiento cancelado por el usuario');
      finalizarProcesamiento();
      return;
    }
    
    if (procesamientoPausado) {
      setTimeout(procesarLote, 100);
      return;
    }
    
    const batchStart = currentIndex;
    const batchEnd = Math.min(currentIndex + BATCH_SIZE, resultados.length);
    
    console.log(`🔄 Procesando lote ${Math.floor(batchStart / BATCH_SIZE) + 1}: ${batchStart + 1}-${batchEnd}`);
    
    // Procesar lote actual
    for (let i = batchStart; i < batchEnd; i++) {
      try {
        const resultado = resultados[i];
        // Procesar el resultado directamente aquí en lugar de llamar a procesarResultadoIndividual
        if (resultado && resultado.par && Array.isArray(resultado.par) && resultado.par.length >= 2) {
          const idA = resultado.par[0]?.toString().trim().toUpperCase();
          const idB = resultado.par[1]?.toString().trim().toUpperCase();
          
          if (idA && idB) {
            const torreA_data = mapaTorres.get(idA);
            const torreB_data = mapaTorres.get(idB);
            
            if (torreA_data && torreB_data) {
              // Crear fila en el formato de la tabla
              const filaDatos = [
                torreA_data[0] || resultado.par[0] || '', // ID A
                torreA_data[3] || '', // Nombre A
                torreA_data[11] || '', // Lat A
                torreA_data[12] || '', // Lon A
                convertirGradosARadianes(torreA_data[11]), // Lat A (rad)
                convertirGradosARadianes(torreA_data[12]), // Lon A (rad)
                torreB_data[0] || resultado.par[1] || '', // ID B
                torreB_data[3] || '', // Nombre B
                torreB_data[11] || '', // Lat B
                torreB_data[12] || '', // Lon B
                convertirGradosARadianes(torreB_data[11]), // Lat B (rad)
                convertirGradosARadianes(torreB_data[12]), // Lon B (rad)
                resultado.distancia ? resultado.distancia.toFixed(6) : '0.000000', // Distancia
                resultado.distancia ? asignarFrecuencia(resultado.distancia) : 'N/A', // Frecuencia
                '99.99', // Disponibilidad anual
                formatearAltura(torreA_data[51]), // Altura Torre A
                formatearAltura(torreB_data[51]), // Altura Torre B
                formatearAltura(torreA_data[52]), // Altura RAN A
                formatearAltura(torreB_data[52]), // Altura RAN B
                torreA_data[103] || '', // Transporte A
                torreB_data[103] || '', // Transporte B
                torreA_data[4] || '', // Arrendamiento A
                torreB_data[4] || '', // Arrendamiento B
                torreA_data[102] || '', // On Air A
                torreB_data[102] || '', // On Air B
                torreA_data[21] || '', // Tipo Torre A
                torreB_data[21] || '', // Tipo Torre B
                torreA_data[13] || '', // Estado A
                torreB_data[13] || '', // Estado B
                resultado.estado === 'factible' ? 'SÍ' : 'NO', // Factible
                resultado.factibilidad?.diametroAntena || 'N/A', // Antenas
                resultado.factibilidad?.tipoEnlace || 'N/A', // Tipo Enlace
                JSON.stringify(resultado.factibilidad || {}) // Análisis
              ];
              
              enlacesProcesados.push(filaDatos);
            }
          }
        }
        
        // Actualizar progreso
        actualizarProgresoProcesamiento(i + 1, resultados.length);
        
      } catch (error) {
        console.error(`❌ Error procesando resultado ${i + 1}:`, error);
      }
    }
    
    currentIndex = batchEnd;
    
    // Verificar si terminamos
    if (currentIndex >= resultados.length) {
      console.log('✅ Procesamiento por lotes completado');
      finalizarProcesamientoConTabla(enlacesProcesados);
      return;
    }
    
    // Continuar con el siguiente lote después de un delay
    setTimeout(procesarLote, DELAY_BETWEEN_BATCHES);
  }
  
  // Iniciar procesamiento
  procesarLote();
}

function procesarPares() {
  console.log('🚀 Función procesarPares iniciada');
  console.log('🔍 Verificando variables globales en procesarPares...');
  console.log('📊 window.dataExcel:', window.dataExcel);
  console.log('📊 window.dataExcel.length:', window.dataExcel ? window.dataExcel.length : 'undefined');
  console.log('🔗 window.dataPares:', window.dataPares);
  console.log('🔗 window.dataPares.length:', window.dataPares ? window.dataPares.length : 'undefined');
  
  let faltantes = [];
  if (!window.dataExcel || !window.dataExcel.length) {
    console.error('❌ dataExcel no disponible en procesarPares');
    console.error('❌ window.dataExcel:', window.dataExcel);
    alert('❌ Error: Primero debes cargar el Excel con los datos de las torres');
    return;
  }
  if (!window.dataPares || !window.dataPares.length) {
    console.error('❌ dataPares no disponible en procesarPares');
    console.error('❌ window.dataPares:', window.dataPares);
    alert('❌ Error: No hay pares de IDs para procesar');
    return;
  }
  let loader = document.createElement('div');
  loader.id = 'loader-procesando';
  loader.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(10,20,40,0.85);color:#fff;display:flex;align-items:center;justify-content:center;z-index:99999;font-size:2rem;font-weight:800;';
  loader.innerHTML = `
    <div>
      <i class="fas fa-cog fa-spin"></i> Procesando pares, por favor espera...
      <br>
      <span id="progreso-pares" style="font-size:1.3rem;display:block;margin-top:18px;"></span>
    </div>
  `;
  document.body.appendChild(loader);
  const mapaTorres = {};
  window.dataExcel.forEach(row => {
    if (row[0]) mapaTorres[row[0].toString().trim().toUpperCase()] = row;
  });
  let index = 0;
  const batchSize = 1000;
  let procesados = 0;
  let omitidos = 0;
  const filasDiferenteTransporte = [];
  const filasMismoTransporte = [];
  function procesarLote() {
    const start = index;
    const end = Math.min(index + batchSize, window.dataPares.length);
    for (let i = start; i < end; i++) {
      const par = window.dataPares[i];
      const idA = par[0]?.toString().trim().toUpperCase();
      const idB = par[1]?.toString().trim().toUpperCase();
      if (!idA || !idB) {
        omitidos++;
        continue;
      }
      const datosTorreA = mapaTorres[idA] || [];
      const datosTorreB = mapaTorres[idB] || [];
      if (datosTorreA.length === 0 || datosTorreB.length === 0) {
        faltantes.push([
          idA, idB,
          datosTorreA.length === 0 ? 'FALTA A' : '',
          datosTorreB.length === 0 ? 'FALTA B' : ''
        ]);
      }
      document.getElementById('idA').value = idA;
      document.getElementById('nombreA').value = datosTorreA[3] || '';
      document.getElementById('latA').value = datosTorreA[11] || '';
      document.getElementById('lonA').value = datosTorreA[12] || '';
      document.getElementById('alturaA').value = datosTorreA[51] || '';
      document.getElementById('ranA').value = datosTorreA[52] || '';
      document.getElementById('TransA').value = datosTorreA[103] || '';
      document.getElementById('ArreA').value = datosTorreA[4] || '';
      document.getElementById('OnA').value = datosTorreA[102] || '';
      document.getElementById('TorreA').value = datosTorreA[21] || '';
      document.getElementById('EstadoA').value = datosTorreA[13] || '';
      document.getElementById('idB').value = idB;
      document.getElementById('nombreB').value = datosTorreB[3] || '';
      document.getElementById('latB').value = datosTorreB[12] || '';
      document.getElementById('lonB').value = datosTorreB[12] || '';
      document.getElementById('alturaB').value = datosTorreB[51] || '';
      document.getElementById('ranB').value = datosTorreB[52] || '';
      document.getElementById('TransB').value = datosTorreB[103] || '';
      document.getElementById('ArreB').value = datosTorreB[4] || '';
      document.getElementById('OnB').value = datosTorreB[102] || '';
      document.getElementById('TorreB').value = datosTorreB[21] || '';
      document.getElementById('EstadoB').value = datosTorreB[13] || '';
      actualizarCalculos();
      const get = id => document.getElementById(id).value.trim();
      const latA = parseFloat(get('latA'));
      const lonA = parseFloat(get('lonA'));
      const latB = parseFloat(get('latB'));
      const lonB = parseFloat(get('lonB'));
      if (!get('idA') || !get('idB')) continue;
      if (isNaN(latA) || isNaN(lonA) || isNaN(latB) || isNaN(lonB)) continue;
      const distanciaKm = calcularDistancia(latA, lonA, latB, lonB);
      const frecuencia = asignarFrecuencia(distanciaKm);
      const factibilidad = analizarFactibilidad(
        distanciaKm,
        get('ArreA'),
        get('ArreB'),
        get('TransA'),
        get('TransB'),
        get('TorreA'),
        get('TorreB'),
        get('OnA'),
        get('OnB'),
        window.ultimaFactibilidadLOS
      );
      const estadoFactible = (factibilidad.advertencia)
        ? 'FACTIBLE (Requiere análisis)'
        : (factibilidad.razon && factibilidad.razon.toUpperCase().includes('NO DISPONIBLE'))
          ? 'NO DISPONIBLE'
          : (factibilidad.factible ? 'SÍ' : 'NO');
      const filaDatos = [
        get('idA'), get('nombreA'), get('latA'), get('lonA'),
        document.getElementById('latArad').value,
        document.getElementById('lonArad').value,
        get('idB'), get('nombreB'), get('latB'), get('lonB'),
        document.getElementById('latBrad').value,
        document.getElementById('lonBrad').value,
        distanciaKm.toFixed(6), frecuencia,
        document.getElementById('disponibilidadAnual').value,
        get('alturaA'), get('alturaB'), get('ranA'), get('ranB'),
        get('TransA'), get('TransB'), get('ArreA'), get('ArreB'),
        get('OnA'), get('OnB'), get('TorreA'), get('TorreB'),
        get('EstadoA'), get('EstadoB'),
        estadoFactible,
        factibilidad.diametroAntena,
        factibilidad.tipoEnlace,
        JSON.stringify(factibilidad)
      ];
      const transA = get('TransA').toLowerCase();
      const transB = get('TransB').toLowerCase();
      if (transA && transB && transA === transB) {
        filasMismoTransporte.push(filaDatos);
      } else {
        filasDiferenteTransporte.push(filaDatos);
      }
      if (permitirMismoTransporte) {
        const todos = filasDiferenteTransporte.concat(filasMismoTransporte);
        localStorage.setItem('enlacesMismoTransporte', JSON.stringify(todos));
        localStorage.removeItem('enlacesPtP'); 
      } else {
        localStorage.setItem('enlacesPtP', JSON.stringify(filasDiferenteTransporte));
        localStorage.removeItem('enlacesMismoTransporte'); 
      }
      procesados++;
    }
    const progreso = document.getElementById('progreso-pares');
    if (progreso) {
      progreso.textContent = `Procesados: ${end} de ${window.dataPares.length} (${Math.round(100*end/window.dataPares.length)}%)`;
    }
    index = end;
    if (index < window.dataPares.length) {
      setTimeout(procesarLote, 1);
    } else {
      document.querySelector('#tabla tbody').innerHTML = '';
      actualizarContadorEnlaces();
      verificarEnlacesVacios();
      setTimeout(() => {
        if (document.body.contains(loader)) {
          document.body.removeChild(loader);
        }
        alert(`✅ Procesamiento de pares completado (${procesados} enlaces agregados de ${window.dataPares.length} pares totales)\n❌ Omitidos por IDs vacíos: ${omitidos}`);
        mostrarPestana(permitirMismoTransporte ? 'mismoTransporte' : 'enlaces');
        if (permitirMismoTransporte) {
          mostrarTablaMismoTransporte();
        } else {
          cargarEnlacesDeStorageModo("normal");
        }
        if (faltantes.length > 0) {
          document.getElementById('btnDescargarFaltantes').style.display = 'inline-block';
          window.paresFaltantes = faltantes;
        } else {
          document.getElementById('btnDescargarFaltantes').style.display = 'none';
        }
      }, 200);
    }
  }
  procesarLote();
}

function crearOverlayProcesamiento(totalEnlaces) {
  // Remover overlay existente si hay uno
  const overlayExistente = document.getElementById('overlay-procesamiento');
  if (overlayExistente) {
    overlayExistente.remove();
  }
  
  const overlay = document.createElement('div');
  overlay.id = 'overlay-procesamiento';
  overlay.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.9);
    z-index: 99999;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Inter', sans-serif;
  `;
  
  overlay.innerHTML = `
    <div style="
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      border: 2px solid #00bcd4;
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 40px rgba(0, 188, 212, 0.3);
    ">
      <div style="font-size: 3rem; margin-bottom: 20px;">🚀</div>
      <h2 style="color: #00bcd4; margin-bottom: 20px;">Procesamiento Robusto</h2>
      <p style="color: #e0f7fa; margin-bottom: 30px;">Procesando ${totalEnlaces.toLocaleString()} enlaces de forma eficiente...</p>
      
      <div style="margin-bottom: 20px;">
        <div style="
          width: 100%;
          height: 20px;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 10px;
          overflow: hidden;
        ">
          <div id="barra-progreso" style="
            height: 100%;
            background: linear-gradient(90deg, #00bcd4, #1e88e5);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
          "></div>
        </div>
      </div>
      
      <div id="estado-procesamiento" style="color: #00bcd4; margin-bottom: 20px;">
        Iniciando procesamiento...
      </div>
      
      <div id="contador-progreso" style="color: #e0f7fa; margin-bottom: 30px;">
        0 / ${totalEnlaces.toLocaleString()}
      </div>
      
      <div style="display: flex; gap: 15px; justify-content: center;">
        <button id="btn-pausar" onclick="togglePausaProcesamiento()" style="
          background: linear-gradient(135deg, #ff9800, #f57c00);
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 10px;
          cursor: pointer;
          font-weight: 600;
        ">⏸️ Pausar</button>
        
        <button id="btn-cancelar" onclick="cancelarProcesamiento()" style="
          background: linear-gradient(135deg, #f44336, #d32f2f);
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 10px;
          cursor: pointer;
          font-weight: 600;
        ">⏹️ Cancelar</button>
      </div>
    </div>
  `;
  
  document.body.appendChild(overlay);
}

function actualizarProgresoProcesamiento(actual, total) {
  const barra = document.getElementById('barra-progreso');
  const contador = document.getElementById('contador-progreso');
  const estado = document.getElementById('estado-progreso');
  
  if (barra && contador && estado) {
    const porcentaje = (actual / total) * 100;
    barra.style.width = porcentaje + '%';
    contador.textContent = `${actual.toLocaleString()} / ${total.toLocaleString()}`;
    
    // Actualizar estado según el progreso
    if (porcentaje < 25) {
      estado.textContent = 'Procesando datos de torres...';
    } else if (porcentaje < 50) {
      estado.textContent = 'Calculando coordenadas y distancias...';
    } else if (porcentaje < 75) {
      estado.textContent = 'Analizando factibilidad...';
    } else if (porcentaje < 100) {
      estado.textContent = 'Finalizando procesamiento...';
    } else {
      estado.textContent = '¡Procesamiento completado!';
    }
  }
}

function togglePausaProcesamiento() {
  procesamientoPausado = !procesamientoPausado;
  const btn = document.getElementById('btn-pausar');
  
  if (procesamientoPausado) {
    btn.innerHTML = '▶️ Reanudar';
    btn.style.background = 'linear-gradient(135deg, #4caf50, #388e3c)';
  } else {
    btn.innerHTML = '⏸️ Pausar';
    btn.style.background = 'linear-gradient(135deg, #ff9800, #f57c00)';
  }
}

function cancelarProcesamiento() {
  procesamientoCancelado = true;
  procesamientoActivo = false;
  finalizarProcesamiento();
}

function finalizarProcesamiento() {
  const overlay = document.getElementById('overlay-procesamiento');
  if (overlay) {
    overlay.remove();
  }
  
  procesamientoActivo = false;
  procesamientoCancelado = false;
  procesamientoPausado = false;
}

function finalizarProcesamientoConTabla(enlacesProcesados) {
  try {
    console.log('🎯 Finalizando procesamiento y creando tabla...');
    
    // Remover overlay
    finalizarProcesamiento();
    
    // Crear tabla de forma eficiente
    crearTablaEficiente(enlacesProcesados);
    
    // Guardar en localStorage
    guardarEnlacesEnStorage(enlacesProcesados);
    
    console.log('✅ Procesamiento completado exitosamente');
    
  } catch (error) {
    console.error('❌ Error finalizando procesamiento:', error);
    finalizarProcesamiento();
  }
}

function crearTablaEficiente(enlacesProcesados) {
  try {
    console.log('🔧 Creando tabla de forma eficiente...');
    
    const tabla = document.getElementById('tabla');
    if (!tabla) {
      console.error('❌ Tabla no encontrada');
      return;
    }
    
    const tbody = tabla.querySelector('tbody');
    if (!tbody) {
      console.error('❌ Tbody no encontrado');
      return;
    }
    
    // Limpiar tabla
    tbody.innerHTML = '';
    
    // Crear fragmento para inserción eficiente
    const fragment = document.createDocumentFragment();
    
    // Procesar enlaces en lotes para la tabla
    const BATCH_SIZE_TABLE = 200;
    
    function agregarLoteTabla(startIndex) {
      const endIndex = Math.min(startIndex + BATCH_SIZE_TABLE, enlacesProcesados.length);
      
      for (let i = startIndex; i < endIndex; i++) {
        try {
          const filaData = enlacesProcesados[i];
          const fila = crearFilaTabla(filaData, i);
          fragment.appendChild(fila);
        } catch (error) {
          console.error(`❌ Error creando fila ${i + 1}:`, error);
        }
      }
      
      // Agregar fragmento al tbody
      tbody.appendChild(fragment);
      
      // Continuar con el siguiente lote si hay más
      if (endIndex < enlacesProcesados.length) {
        setTimeout(() => agregarLoteTabla(endIndex), 10);
      } else {
        // Finalizar
        actualizarContadorEnlaces();
        verificarEnlacesVacios();
        console.log(`✅ Tabla creada con ${enlacesProcesados.length} filas`);
      }
    }
    
    // Iniciar creación de tabla por lotes
    agregarLoteTabla(0);
    
  } catch (error) {
    console.error('❌ Error creando tabla:', error);
  }
}

function crearFilaTabla(filaData, index) {
  const fila = document.createElement('tr');
  
  // Agregar checkbox como primera columna
  const tdCheck = document.createElement('td');
  const check = document.createElement('input');
  check.type = 'checkbox';
  check.className = 'check-enlace';
  check.onclick = function(e) {
    e.stopPropagation();
    actualizarBotonEliminarSeleccionados();
  };
  tdCheck.appendChild(check);
  fila.appendChild(tdCheck);
  
  // Agregar datos de la fila (filaData ya no incluye el checkbox)
  filaData.forEach((valor, i) => {
    const td = document.createElement('td');
    if (i === filaData.length - 1) {
      // Última columna - botón de análisis
      const btn = document.createElement('button');
      btn.className = 'btn btn-info btn-sm';
      btn.innerHTML = '<i class="fas fa-info-circle"></i> Ver Análisis';
      btn.onclick = function(e) {
        e.stopPropagation();
        try {
          const analisis = JSON.parse(valor);
          mostrarAnalisisDetallado(analisis);
        } catch {
          alert('No hay análisis detallado disponible.');
        }
      };
      td.appendChild(btn);
      td.dataset.analisis = valor;
    } else {
      td.textContent = valor || '';
    }
    fila.appendChild(td);
  });
  
  // Aplicar estilo de factibilidad (ajustar índice ya que no hay checkbox en filaData)
  const esFactible = filaData[filaData.length - 4] === 'SÍ';
  if (typeof aplicarEstiloFactibilidad === 'function') {
    aplicarEstiloFactibilidad(fila, esFactible);
  }
  
  return fila;
}

function guardarEnlacesEnStorage(enlacesProcesados) {
  try {
    // Validar que enlacesProcesados sea un array válido
    if (!Array.isArray(enlacesProcesados)) {
      console.error('❌ enlacesProcesados no es un array válido:', typeof enlacesProcesados);
      return;
    }
    
    // Guardar enlaces procesados
    localStorage.setItem('enlacesPtP', JSON.stringify(enlacesProcesados));
    console.log('💾 Enlaces guardados en localStorage:', enlacesProcesados.length);
    
    // Guardar información de procesamiento
    const infoProcesamiento = {
      timestamp: new Date().toISOString(),
      totalEnlaces: enlacesProcesados.length,
      enlacesFactibles: enlacesProcesados.filter((fila, i) => {
        return fila && Array.isArray(fila) && fila[fila.length - 4] === 'SÍ';
      }).length,
      enlacesNoFactibles: enlacesProcesados.filter((fila, i) => {
        return fila && Array.isArray(fila) && fila[fila.length - 4] === 'NO';
      }).length
    };
    
    localStorage.setItem('infoProcesamiento', JSON.stringify(infoProcesamiento));
    console.log('📅 Información de procesamiento guardada');
    
  } catch (error) {
    console.error('❌ Error guardando en localStorage:', error);
  }
}

function actualizarKPIsEjecutivosConDatosReales(resultados) {
  try {
    const totalEnlaces = resultados.length;
    const enlacesFactibles = resultados.filter(r => r.estado === 'factible').length;
    const enlacesNoFactibles = resultados.filter(r => r.estado === 'no-factible').length;
    const cobertura = totalEnlaces > 0 ? Math.round((enlacesFactibles / totalEnlaces) * 100) : 0;
    
    // Actualizar KPIs ejecutivos
    const kpiTotal = document.getElementById('executive-total-enlaces');
    const kpiFactibles = document.getElementById('executive-enlaces-factibles');
    const kpiCriticos = document.getElementById('executive-enlaces-criticos');
    const kpiFuera = document.getElementById('executive-enlaces-fuera');
    
    if (kpiTotal) kpiTotal.textContent = totalEnlaces;
    if (kpiFactibles) kpiFactibles.textContent = enlacesFactibles;
    if (kpiCriticos) kpiCriticos.textContent = enlacesNoFactibles;
    if (kpiFuera) kpiFuera.textContent = enlacesNoFactibles;
    
    // Actualizar KPIs del dashboard
    const metricTotal = document.getElementById('metric-total-enlaces');
    const metricFactibles = document.getElementById('metric-enlaces-factibles');
    const metricNoFactibles = document.getElementById('metric-enlaces-no-factibles');
    const metricCobertura = document.getElementById('metric-cobertura');
    
    if (metricTotal) metricTotal.textContent = totalEnlaces;
    if (metricFactibles) metricFactibles.textContent = enlacesFactibles;
    if (metricNoFactibles) metricNoFactibles.textContent = enlacesNoFactibles;
    if (metricCobertura) metricCobertura.textContent = cobertura + '%';
    
    console.log('✅ KPIs actualizados con datos reales');
    
  } catch (error) {
    console.error('❌ Error actualizando KPIs:', error);
  }
}

function verDetallesEnlace(id) {
  // Buscar el enlace por ID
  const enlaces = JSON.parse(localStorage.getItem('enlacesPtP') || '[]');
  const enlace = enlaces.find(e => e.id === id);
  
  if (enlace) {
    const detalles = `
      **Detalles del Enlace:**
      
      • Torre A: ${enlace.torreA}
      • Torre B: ${enlace.torreB}
      • Distancia: ${enlace.distancia} km
      • Estado: ${enlace.estado === 'factible' ? 'Factible' : 'No Factible'}
      • Fresnel Obstruido: ${enlace.detalles.fresnelObstruido}%
      • Margen de Despeje: ${enlace.detalles.margenDespeje}m
      • Factor K: ${enlace.detalles.factorK}
      • Timestamp: ${new Date(enlace.timestamp).toLocaleString()}
    `;
    
    alert(detalles);
  }
}

function verDetallesProcesamiento() {
  const detalles = `
    **Detalles del Procesamiento:**
    
    • Pares procesados: ${processingState.currentPair}/${processingState.totalPairs}
    • Paso actual: ${processingState.currentStep + 1}/${processingState.totalSteps}
    • Tiempo transcurrido: ${Math.round((Date.now() - processingState.startTime) / 1000)}s
    • Tiempo estimado restante: ${Math.round((processingState.estimatedTime - (Date.now() - processingState.startTime)) / 1000)}s
    • Estado: ${processingState.isPaused ? 'Pausado' : 'Activo'}
    • Modo: TURBO
  `;
  
  alert(detalles);
}

function diagnosticarLocalStorage() {
  try {
    // Obtener todas las claves del localStorage
    const claves = Object.keys(localStorage);
    
    // Analizar cada clave relevante
    const diagnostico = {
      clavesTotales: claves.length,
      clavesRelevantes: [],
      archivoParesInfo: null,
      archivoExcelInfo: null,
      enlacesPtP: null,
      enlacesProcesados: null
    };
    
    // Filtrar claves relevantes
    diagnostico.clavesRelevantes = claves.filter(clave => 
      clave.includes('archivo') || 
      clave.includes('enlace') || 
      clave.includes('par') || 
      clave.includes('excel') ||
      clave.includes('fangio')
    );
    
    // Analizar archivoParesInfo
    try {
      const archivoPares = localStorage.getItem('archivoParesInfo');
      if (archivoPares) {
        diagnostico.archivoParesInfo = JSON.parse(archivoPares);
      }
    } catch (e) {
      diagnostico.archivoParesInfo = 'Error al parsear: ' + e.message;
    }
    
    // Analizar archivoExcelInfo
    try {
      const archivoExcel = localStorage.getItem('archivoExcelInfo');
      if (archivoExcel) {
        diagnostico.archivoExcelInfo = JSON.parse(archivoExcel);
      }
    } catch (e) {
      diagnostico.archivoExcelInfo = 'Error al parsear: ' + e.message;
    }
    
    // Analizar enlacesPtP
    try {
      const enlaces = localStorage.getItem('enlacesPtP');
      if (enlaces) {
        diagnostico.enlacesPtP = JSON.parse(enlaces);
      }
    } catch (e) {
      diagnostico.enlacesPtP = 'Error al parsear: ' + e.message;
    }
    
    // Analizar enlacesProcesados
    try {
      const procesados = localStorage.getItem('enlacesProcesados');
      if (procesados) {
        diagnostico.enlacesProcesados = JSON.parse(procesados);
      }
    } catch (e) {
      diagnostico.enlacesProcesados = 'Error al parsear: ' + e.message;
    }
    
    // Verificar variables globales
    let infoGlobales = '';
    try {
              if (typeof window.dataExcel !== 'undefined') {
        infoGlobales += `\n📊 dataExcel: ${window.dataExcel?.length || 0} filas`;
        if (window.dataExcel && window.dataExcel.length > 0) {
          infoGlobales += `\n   Primera fila: ${JSON.stringify(window.dataExcel[0].slice(0, 5))}`;
        }
      } else {
        infoGlobales += '\n📊 dataExcel: No definida';
      }
      
              if (typeof window.dataPares !== 'undefined') {
        infoGlobales += `\n🔗 dataPares: ${window.dataPares?.length || 0} pares`;
        if (window.dataPares && window.dataPares.length > 0) {
          infoGlobales += `\n   Primer par: ${JSON.stringify(window.dataPares[0])}`;
        }
      } else {
        infoGlobales += '\n🔗 dataPares: No definida';
      }
    } catch (e) {
      infoGlobales += `\n❌ Error verificando variables globales: ${e.message}`;
    }
    
    // Mostrar diagnóstico
    const mensaje = `
🔍 DIAGNÓSTICO DE LOCALSTORAGE

📊 Total de claves: ${diagnostico.clavesTotales}
🔑 Claves relevantes: ${diagnostico.clavesRelevantes.join(', ')}

📁 archivoParesInfo:
${JSON.stringify(diagnostico.archivoParesInfo, null, 2)}

📊 archivoExcelInfo:
${JSON.stringify(diagnostico.archivoExcelInfo, null, 2)}

🔗 enlacesPtP:
${JSON.stringify(diagnostico.enlacesPtP, null, 2)}

✅ enlacesProcesados:
${JSON.stringify(diagnostico.enlacesProcesados, null, 2)}

🌐 VARIABLES GLOBALES:${infoGlobales}

💡 RECOMENDACIÓN:
${diagnostico.archivoParesInfo && diagnostico.archivoParesInfo.pares ? 
  `Usar archivoParesInfo con ${diagnostico.archivoParesInfo.pares.length} pares` :
  diagnostico.archivoExcelInfo && diagnostico.archivoExcelInfo.pares ?
  `Usar archivoExcelInfo con ${diagnostico.archivoExcelInfo.pares.length} pares` :
  'No se encontraron pares en ninguna clave'
}
    `;
    
    console.log('🔍 Diagnóstico completo:', diagnostico);
    alert(mensaje);
    
  } catch (error) {
    console.error('❌ Error en diagnóstico:', error);
    alert('Error al diagnosticar: ' + error.message);
  }
}


// ===== INICIALIZACIÓN EMPRESARIAL =====
function inicializarInterfazEmpresarial() {
  // Configurar event listeners
  document.querySelectorAll('.corporate-nav-item').forEach(item => {
    item.addEventListener('click', function() {
      const seccion = this.textContent.trim();
      activarNavegacion(seccion);
    });
  });
  
  // Configurar botones de acción
  const btnNuevoEnlace = document.querySelector('.corporate-btn.primary');
  const btnExportar = document.querySelector('.corporate-btn.secondary');
  const btnActualizar = document.querySelector('.corporate-btn.success');
  
  if (btnNuevoEnlace) btnNuevoEnlace.addEventListener('click', nuevoEnlace);
  if (btnExportar) btnExportar.addEventListener('click', exportarReporte);
  if (btnActualizar) btnActualizar.addEventListener('click', actualizarDatos);
  
  // Configurar sidebar
  document.querySelectorAll('.sidebar-menu-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const texto = this.querySelector('span').textContent;
      mostrarNotificacion('Navegación', `Navegando a: ${texto}`, 'info');
    });
  });

  // Configurar controles de procesamiento
  const btnPausar = document.getElementById('btnPausarProcesamiento');
  const btnDetalles = document.getElementById('btnVerDetalles');
  const btnCancelar = document.getElementById('btnCancelarProcesamiento');
  
  if (btnPausar) btnPausar.addEventListener('click', pausarProcesamiento);
  if (btnDetalles) btnDetalles.addEventListener('click', verDetallesProcesamiento);
  if (btnCancelar) btnCancelar.addEventListener('click', cancelarProcesamiento);
  
  // Inicializar KPIs
  actualizarKPIsEjecutivos();
  actualizarActividadReciente();
  
  // CARGAR DATOS EXISTENTES SI LOS HAY
  cargarDatosExistentes();
  
  // Mostrar notificación de bienvenida
  setTimeout(() => {
    mostrarNotificacion('Dashboard Inicializado', 'Interfaz empresarial lista', 'success');
  }, 1000);
}

function cargarDatosExistentes() {
  console.log('🚀 === INICIANDO CARGA DE DATOS EXISTENTES ===');
  
  try {
    // Cargar enlaces procesados
    let enlaces = [];
    const enlacesStorage = localStorage.getItem('enlacesPtP');
    if (enlacesStorage && enlacesStorage !== 'undefined' && enlacesStorage !== 'null') {
      try {
        enlaces = JSON.parse(enlacesStorage);
      } catch (parseError) {
        console.warn('⚠️ Error parseando enlaces:', parseError);
        enlaces = [];
      }
    }
    console.log(`📊 Enlaces encontrados en localStorage: ${enlaces.length}`);
    
    if (enlaces.length > 0) {
      console.log(`📊 Cargando ${enlaces.length} enlaces existentes`);
      console.log('📋 Primer enlace:', enlaces[0]);
      
      // Actualizar tabla con datos existentes
      actualizarTablaConResultados(enlaces);
      
      // Actualizar KPIs con datos reales
      actualizarKPIsEjecutivosConDatosReales(enlaces);
      
      // Mostrar información del procesamiento anterior
      let infoProcesamiento = {};
      const infoStorage = localStorage.getItem('infoProcesamiento');
      if (infoStorage && infoStorage !== 'undefined' && infoStorage !== 'null') {
        try {
          infoProcesamiento = JSON.parse(infoStorage);
        } catch (parseError) {
          console.warn('⚠️ Error parseando info de procesamiento:', parseError);
          infoProcesamiento = {};
        }
      }
      
      if (infoProcesamiento.timestamp) {
        const fecha = new Date(infoProcesamiento.timestamp).toLocaleString();
        mostrarNotificacion('Datos Cargados', `${enlaces.length} enlaces procesados el ${fecha}`, 'info');
      }
    } else {
      console.log('📭 No hay enlaces guardados en localStorage');
    }
    
    // Cargar información del archivo
    let archivoInfo = {};
    const archivoStorage = localStorage.getItem('archivoParesInfo');
    if (archivoStorage && archivoStorage !== 'undefined' && archivoStorage !== 'null') {
      try {
        archivoInfo = JSON.parse(archivoStorage);
      } catch (parseError) {
        console.warn('⚠️ Error parseando info de archivo:', parseError);
        archivoInfo = {};
      }
    }
    
    if (archivoInfo.pares && archivoInfo.pares.length > 0) {
      console.log(`📁 Archivo cargado: ${archivoInfo.pares.length} pares disponibles`);
    }
    
    console.log('✅ === CARGA DE DATOS EXISTENTES COMPLETADA ===');
    
  } catch (error) {
    console.error('❌ Error cargando datos existentes:', error);
  }
}

// ===== LIMPIEZA DE LOCALSTORAGE =====
function limpiarLocalStorageInvalido() {
  console.log('🧹 Limpiando localStorage de valores inválidos...');
  
  const keysToCheck = [
    'enlacesPtP', 
    'enlacesMismoTransporte', 
    'archivoParesInfo', 
    'archivoExcelInfo',
    'infoProcesamiento'
  ];
  
  keysToCheck.forEach(key => {
    try {
      const value = localStorage.getItem(key);
      if (value === 'undefined' || value === 'null' || value === '') {
        console.log(`🗑️ Eliminando valor inválido de ${key}:`, value);
        localStorage.removeItem(key);
      }
    } catch (error) {
      console.warn(`⚠️ Error verificando key ${key}:`, error);
    }
  });
  
  console.log('✅ Limpieza de localStorage completada');
}

// ===== OPTIMIZACIONES DE RENDIMIENTO PARA TABLA =====

// Cache para optimizar búsquedas y renderizado
const tablaCache = {
  resultados: [],
  filasRenderizadas: new Map(),
  ultimaActualizacion: 0,
  filtros: {
    texto: '',
    factibilidad: 'todos',
    orden: 'default'
  },
  mapaTorres: new Map() // Cache de búsqueda de torres
};

// Configuración de virtualización
const VIRTUALIZATION_CONFIG = {
  pageSize: 100, // Filas por página
  bufferSize: 50, // Filas de buffer
  renderThreshold: 200, // Umbral para activar virtualización
  scrollThreshold: 50 // Píxeles para activar carga de más filas
};

// Debouncer para búsquedas
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// Throttler para scroll
function throttle(func, limit) {
  let inThrottle;
  return function() {
    const args = arguments;
    const context = this;
    if (!inThrottle) {
      func.apply(context, args);
      inThrottle = true;
      setTimeout(() => inThrottle = false, limit);
    }
  };
}

// Función optimizada para crear filas de tabla
function crearFilaTablaOptimizada(filaDatos, index) {
  // Usar DocumentFragment para mejor rendimiento
  const fragment = document.createDocumentFragment();
  const tr = document.createElement('tr');
  
  // Agregar checkbox
  const tdCheckbox = document.createElement('td');
  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.className = 'enlace-checkbox';
  checkbox.dataset.index = index;
  tdCheckbox.appendChild(checkbox);
  tr.appendChild(tdCheckbox);
  
  // Agregar celdas de datos
  filaDatos.forEach((valor, colIndex) => {
    const td = document.createElement('td');
    td.textContent = valor || '';
    td.className = `col-${colIndex}`;
    tr.appendChild(td);
  });
  
  // Agregar botones de acción
  const tdAcciones = document.createElement('td');
  tdAcciones.className = 'acciones';
  
  const btnVer = document.createElement('button');
  btnVer.className = 'btn-accion btn-ver';
  btnVer.innerHTML = '<i class="fas fa-eye"></i>';
  btnVer.title = 'Ver detalles';
  btnVer.onclick = () => verDetallesEnlace(index);
  
  const btnEditar = document.createElement('button');
  btnEditar.className = 'btn-accion btn-editar';
  btnEditar.innerHTML = '<i class="fas fa-edit"></i>';
  btnVer.title = 'Editar enlace';
  btnEditar.onclick = () => editarEnlace(index);
  
  tdAcciones.appendChild(btnVer);
  tdAcciones.appendChild(btnEditar);
  tr.appendChild(tdAcciones);
  
  // Agregar event listeners optimizados
  tr.addEventListener('click', (e) => {
    if (!e.target.closest('.enlace-checkbox') && !e.target.closest('.btn-accion')) {
      seleccionarFila(tr, index);
    }
  });
  
  return tr;
}

// Función para seleccionar fila con optimización
function seleccionarFila(fila, index) {
  // Remover selección anterior
  const filasSeleccionadas = document.querySelectorAll('#tabla tbody tr.seleccionada');
  filasSeleccionadas.forEach(f => f.classList.remove('seleccionada'));
  
  // Seleccionar nueva fila
  fila.classList.add('seleccionada');
  
  // Actualizar información del enlace seleccionado
  actualizarInfoEnlaceSeleccionado(index);
  
  // Scroll suave a la fila seleccionada
  fila.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

// Función optimizada para actualizar información del enlace
function actualizarInfoEnlaceSeleccionado(index) {
  if (!tablaCache.resultados[index]) return;
  
  const resultado = tablaCache.resultados[index];
  const { par, factibilidad } = resultado;
  
  // Usar cache de torres
  const torreA = tablaCache.mapaTorres.get(par[0]?.toString().trim().toUpperCase());
  const torreB = tablaCache.mapaTorres.get(par[1]?.toString().trim().toUpperCase());
  
  // Actualizar UI de manera eficiente
  requestAnimationFrame(() => {
    actualizarPanelDetalles(resultado, torreA, torreB);
  });
}

// Función para actualizar panel de detalles
function actualizarPanelDetalles(resultado, torreA, torreB) {
  const panel = document.getElementById('panel-detalles');
  if (!panel) return;
  
  // Usar innerHTML de manera eficiente
  panel.innerHTML = `
    <div class="detalles-header">
      <h3>Detalles del Enlace</h3>
      <span class="estado ${resultado.estado}">${resultado.estado.toUpperCase()}</span>
    </div>
    <div class="detalles-content">
      <div class="detalle-grupo">
        <h4>Torre A</h4>
        <p><strong>ID:</strong> ${torreA?.[0] || 'N/A'}</p>
        <p><strong>Nombre:</strong> ${torreA?.[3] || 'N/A'}</p>
        <p><strong>Coordenadas:</strong> ${torreA?.[11] || 'N/A'}, ${torreA?.[12] || 'N/A'}</p>
      </div>
      <div class="detalle-grupo">
        <h4>Torre B</h4>
        <p><strong>ID:</strong> ${torreB?.[0] || 'N/A'}</p>
        <p><strong>Nombre:</strong> ${torreB?.[3] || 'N/A'}</p>
        <p><strong>Coordenadas:</strong> ${torreB?.[11] || 'N/A'}, ${torreB?.[12] || 'N/A'}</p>
      </div>
      <div class="detalle-grupo">
        <h4>Enlace</h4>
        <p><strong>Distancia:</strong> ${resultado.distancia.toFixed(2)} km</p>
        <p><strong>Frecuencia:</strong> ${asignarFrecuencia(resultado.distancia)} GHz</p>
        <p><strong>Factibilidad:</strong> ${resultado.estado === 'factible' ? 'SÍ' : 'NO'}</p>
      </div>
    </div>
  `;
  
  panel.style.display = 'block';
}

// Configurar scroll infinito para tablas grandes
function configurarScrollInfinito(resultados) {
  const tbody = document.querySelector('#tabla tbody');
  if (!tbody) return;
  
  let currentPage = 0;
  let isLoading = false;
  
  const loadMoreRows = throttle(() => {
    if (isLoading) return;
    
    const nextPageStart = (currentPage + 1) * VIRTUALIZATION_CONFIG.pageSize;
    if (nextPageStart >= resultados.length) return;
    
    isLoading = true;
    
    // Simular carga asíncrona
    setTimeout(() => {
      const nextPage = resultados.slice(nextPageStart, nextPageStart + VIRTUALIZATION_CONFIG.pageSize);
      
      nextPage.forEach((filaDatos, index) => {
        const globalIndex = nextPageStart + index;
        const fila = crearFilaTablaOptimizada(filaDatos, globalIndex);
        if (fila) {
          tbody.appendChild(fila);
          tablaCache.filasRenderizadas.set(globalIndex, fila);
        }
      });
      
      currentPage++;
      isLoading = false;
      
      // Actualizar indicador
      actualizarIndicadorPagina(currentPage, Math.ceil(resultados.length / VIRTUALIZATION_CONFIG.pageSize));
      
    }, 100);
  }, 200);
  
  // Agregar event listener de scroll optimizado
  tbody.parentElement.addEventListener('scroll', loadMoreRows);
}

// Configurar carga de archivos Excel y pares
function configurarCargaArchivos() {
  console.log('📁 Configurando carga de archivos...');
  console.log('🔍 Verificando variables globales...');
  console.log('📊 window.dataExcel:', window.dataExcel);
  console.log('🔗 window.dataPares:', window.dataPares);
  console.log('🌐 window object:', typeof window);
  
  // Event listener para archivo Excel principal
  const inputExcel = document.getElementById('inputFile');
  if (inputExcel) {
    console.log('✅ inputFile encontrado, configurando event listener...');
    inputExcel.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      console.log('📁 Archivo Excel seleccionado:', file.name);
      const reader = new FileReader();
      
      reader.onload = function (e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const sheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[sheetName];
          window.dataExcel = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
          
          const archivoInfo = {
            nombre: file.name,
            tamaño: file.size,
            filas: window.dataExcel.length,
            fechaCarga: new Date().toISOString()
          };
          
          localStorage.setItem('archivoExcelInfo', JSON.stringify(archivoInfo));
          
          // Actualizar el indicador de estado del archivo Excel
          const estadoArchivoExcel = document.getElementById('estado-archivo-excel');
          if (estadoArchivoExcel) {
            estadoArchivoExcel.innerHTML = `
              <div style="color: #10b981; font-weight: 600;">
                <i class="fas fa-file-excel"></i> Archivo Cargado
              </div>
              <div style="margin-top: 8px; font-size: 0.9em; color: #94a3b8;">
                <strong>${archivoInfo.nombre}</strong><br>
                ${archivoInfo.filas} filas • ${(archivoInfo.tamaño / 1024).toFixed(1)} KB<br>
                Cargado: ${new Date(archivoInfo.fechaCarga).toLocaleString()}
              </div>
            `;
          }
          
          console.log('✅ Archivo Excel cargado exitosamente:', archivoInfo);
          alert(`✅ Archivo cargado exitosamente!\n📁 ${file.name}\n📊 ${window.dataExcel.length} filas procesadas`);
          
        } catch (error) {
          console.error('❌ Error al procesar archivo Excel:', error);
          alert('❌ Error al procesar el archivo Excel. Verifica el formato.');
        }
      };
      
      reader.onerror = function() {
        console.error('❌ Error al leer el archivo');
        alert('❌ Error al leer el archivo. Intenta nuevamente.');
      };
      
      reader.readAsArrayBuffer(file);
    });
    console.log('✅ Event listener para inputFile configurado');
  } else {
    console.error('❌ inputFile no encontrado en el DOM');
  }
  
  // Event listener para archivo de pares
  const inputPares = document.getElementById('inputFilePairs');
  if (inputPares) {
    console.log('✅ inputFilePairs encontrado, configurando event listener...');
    inputPares.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      console.log('📁 Archivo de pares seleccionado:', file.name);
      const reader = new FileReader();
      
      reader.onload = function (e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const sheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[sheetName];
          window.dataPares = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
          
          const archivoInfo = {
            nombre: file.name,
            tamaño: file.size,
            filas: window.dataPares.length,
            fechaCarga: new Date().toISOString()
          };
          
          localStorage.setItem('archivoParesInfo', JSON.stringify(archivoInfo));
          
          // Mostrar información del archivo cargado
          const contenedor = document.getElementById('archivo-pares-cargado');
          const nombreArchivo = document.getElementById('nombre-archivo-pares');
          const infoArchivo = document.getElementById('info-archivo-pares');
          
          if (contenedor && nombreArchivo && infoArchivo) {
            nombreArchivo.textContent = archivoInfo.nombre;
            infoArchivo.textContent = `${archivoInfo.filas} filas • ${(archivoInfo.tamaño / 1024).toFixed(1)} KB • Cargado: ${new Date(archivoInfo.fechaCarga).toLocaleString()}`;
            contenedor.style.display = 'block';
            inputPares.style.display = 'none';
          }
          
          console.log('✅ Archivo de pares cargado exitosamente:', archivoInfo);
          alert(`✅ Archivo de pares cargado exitosamente!\n📁 ${file.name}\n📊 ${window.dataPares.length} filas procesadas`);
          
        } catch (error) {
          console.error('❌ Error al procesar archivo de pares:', error);
          alert('❌ Error al procesar el archivo de pares. Verifica el formato.');
        }
      };
      
      reader.onerror = function() {
        console.error('❌ Error al leer el archivo de pares');
        alert('❌ Error al leer el archivo de pares. Intenta nuevamente.');
      };
      
      reader.readAsArrayBuffer(file);
    });
    console.log('✅ Event listener para inputFilePairs configurado');
  } else {
    console.error('❌ inputFilePairs no encontrado en el DOM');
  }
  
  console.log('✅ Configuración de carga de archivos completada');
}

// Verificar estado inicial de archivos cargados
function verificarEstadoArchivos() {
  console.log('🔍 Verificando estado inicial de archivos...');
  
  try {
    // Verificar archivo Excel
    const archivoExcelInfo = localStorage.getItem('archivoExcelInfo');
    if (archivoExcelInfo) {
      const info = JSON.parse(archivoExcelInfo);
      console.log('📊 Archivo Excel encontrado en localStorage:', info);
      
      // Actualizar UI del archivo Excel
      const estadoArchivoExcel = document.getElementById('estado-archivo-excel');
      if (estadoArchivoExcel) {
        estadoArchivoExcel.innerHTML = `
          <div style="color: #10b981; font-weight: 600;">
            <i class="fas fa-file-excel"></i> Archivo Cargado
          </div>
          <div style="margin-top: 8px; font-size: 0.9em; color: #94a3b8;">
            <strong>${info.nombre}</strong><br>
            ${info.filas} filas • ${(info.tamaño / 1024).toFixed(1)} KB<br>
            Cargado: ${new Date(info.fechaCarga).toLocaleString()}
          </div>
        `;
      }
      
      // Cargar datos del archivo Excel desde IndexedDB si está disponible
      if (window.indexedDB) {
        cargarArchivoExcelDesdeIndexedDB(info.nombre);
      }
    } else {
      console.log('📊 No hay archivo Excel cargado');
    }
    
    // Verificar archivo de pares
    const archivoParesInfo = localStorage.getItem('archivoParesInfo');
    if (archivoParesInfo) {
      const info = JSON.parse(archivoParesInfo);
      console.log('🔗 Archivo de pares encontrado en localStorage:', info);
      
      // Actualizar UI del archivo de pares
      const contenedor = document.getElementById('archivo-pares-cargado');
      const nombreArchivo = document.getElementById('nombre-archivo-pares');
      const infoArchivo = document.getElementById('info-archivo-pares');
      
      if (contenedor && nombreArchivo && infoArchivo) {
        nombreArchivo.textContent = info.nombre;
        infoArchivo.textContent = `${info.filas} filas • ${(info.tamaño / 1024).toFixed(1)} KB • Cargado: ${new Date(info.fechaCarga).toLocaleString()}`;
        contenedor.style.display = 'block';
        
        // Ocultar el input de pares
        const inputPares = document.getElementById('inputFilePairs');
        if (inputPares) {
          inputPares.style.display = 'none';
        }
      }
      
      // Cargar datos del archivo de pares desde IndexedDB si está disponible
      if (window.indexedDB) {
        cargarArchivoParesDesdeIndexedDB(info.nombre);
      }
    } else {
      console.log('🔗 No hay archivo de pares cargado');
    }
    
    console.log('✅ Verificación de estado de archivos completada');
    
  } catch (error) {
    console.error('❌ Error verificando estado de archivos:', error);
  }
}

// Función para cargar archivo Excel desde IndexedDB (placeholder)
function cargarArchivoExcelDesdeIndexedDB(nombreArchivo) {
  console.log('📊 Intentando cargar archivo Excel desde IndexedDB:', nombreArchivo);
  // TODO: Implementar carga desde IndexedDB si es necesario
}

// Función para cargar archivo de pares desde IndexedDB (placeholder)
function cargarArchivoParesDesdeIndexedDB(nombreArchivo) {
  console.log('🔗 Intentando cargar archivo de pares desde IndexedDB:', nombreArchivo);
  // TODO: Implementar carga desde IndexedDB si es necesario
}

// Función para actualizar indicador de página
function actualizarIndicadorPagina(paginaActual, totalPaginas) {
  let indicador = document.getElementById('indicador-pagina');
  if (!indicador) {
    indicador = document.createElement('div');
    indicador.id = 'indicador-pagina';
    indicador.className = 'indicador-pagina';
    indicador.style.cssText = `
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px 15px;
      border-radius: 20px;
      font-size: 12px;
      z-index: 1000;
    `;
    document.body.appendChild(indicador);
  }
  
  indicador.textContent = `Página ${paginaActual} de ${totalPaginas}`;
}

// Función para mostrar indicador de virtualización
function mostrarIndicadorVirtualizacion(totalFilas) {
  const indicador = document.createElement('div');
  indicador.className = 'indicador-virtualizacion';
  indicador.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(0,255,0,0.9);
    color: white;
    padding: 10px 15px;
    border-radius: 20px;
    font-size: 12px;
    z-index: 1000;
  `;
  indicador.innerHTML = `
    <i class="fas fa-rocket"></i>
    Modo TURBO: ${totalFilas} filas virtualizadas
  `;
  
  document.body.appendChild(indicador);
  
  // Remover después de 3 segundos
  setTimeout(() => {
    if (indicador.parentNode) {
      indicador.parentNode.removeChild(indicador);
    }
  }, 3000);
}

// Función para limpiar cache de tabla
function limpiarCacheTabla() {
  tablaCache.resultados = [];
  tablaCache.filasRenderizadas.clear();
  tablaCache.ultimaActualizacion = 0;
  tablaCache.mapaTorres.clear();
  console.log('🧹 Cache de tabla limpiado');
}

// Función para optimizar búsqueda en tabla
const buscarEnTablaOptimizada = debounce((termino) => {
  if (!tablaCache.resultados.length) return;
  
  const terminoLower = termino.toLowerCase();
  const filas = document.querySelectorAll('#tabla tbody tr');
  
  let filasVisibles = 0;
  
  filas.forEach((fila, index) => {
    const textoFila = fila.textContent.toLowerCase();
    const coincide = textoFila.includes(terminoLower);
    
    fila.style.display = coincide ? '' : 'none';
    if (coincide) filasVisibles++;
  });
  
  // Actualizar contador
  const contador = document.getElementById('contador-enlaces');
  if (contador) {
    contador.textContent = `${filasVisibles} enlaces encontrados`;
  }
  
  console.log(`🔍 Búsqueda completada: ${filasVisibles} filas visibles`);
}, 300);

// Función para ordenar tabla optimizada
function ordenarTablaOptimizada(columna, direccion = 'asc') {
  if (!tablaCache.resultados.length) return;
  
  const tbody = document.querySelector('#tabla tbody');
  if (!tbody) return;
  
  // Ordenar datos en cache
  tablaCache.resultados.sort((a, b) => {
    let valorA = a[columna] || '';
    let valorB = b[columna] || '';
    
    if (typeof valorA === 'string') valorA = valorA.toLowerCase();
    if (typeof valorB === 'string') valorB = valorB.toLowerCase();
    
    if (direccion === 'asc') {
      return valorA > valorB ? 1 : -1;
    } else {
      return valorA < valorB ? 1 : -1;
    }
  });
  
  // Re-renderizar tabla
  renderizarTablaCompleta(tablaCache.resultados);
  
  console.log(`📊 Tabla ordenada por columna ${columna} (${direccion})`);
}

// Función para renderizar tabla completa
function renderizarTablaCompleta(resultados) {
  const tbody = document.querySelector('#tabla tbody');
  if (!tbody) return;
  
  tbody.innerHTML = '';
  
  resultados.forEach((filaDatos, index) => {
    try {
      const fila = crearFilaTablaOptimizada(filaDatos, index);
      if (fila) {
        tbody.appendChild(fila);
      }
    } catch (error) {
      console.error(`❌ Error creando fila ${index + 1}:`, error);
    }
  });
}

// Función para ver detalles del enlace
function verDetallesEnlace(index) {
  console.log(`👁️ Ver detalles del enlace ${index}`);
  seleccionarFila(document.querySelector(`#tabla tbody tr[data-index="${index}"]`), index);
}

// Función para editar enlace
function editarEnlace(index) {
  console.log(`✏️ Editar enlace ${index}`);
  // Aquí puedes implementar la lógica de edición
  mostrarNotificacion('Edición', `Editando enlace ${index + 1}`, 'info');
}

// Función para inicializar cache de torres
function inicializarCacheTorres() {
  if (!window.dataExcel || !Array.isArray(window.dataExcel)) return;
  
  console.log('🔍 Inicializando cache de torres...');
  
  window.dataExcel.forEach((row, index) => {
    if (row && row[0]) {
      const idKey = row[0].toString().trim().toUpperCase();
      tablaCache.mapaTorres.set(idKey, row);
    }
  });
  
  console.log(`✅ Cache de torres inicializado: ${tablaCache.mapaTorres.size} torres`);
}

// Función para optimizar el renderizado de la tabla
function optimizarRenderizadoTabla() {
  // Usar Intersection Observer para lazy loading
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const fila = entry.target;
          const index = parseInt(fila.dataset.index);
          
          // Cargar datos de la fila si no están cargados
          if (!fila.dataset.loaded) {
            cargarDatosFila(fila, index);
          }
        }
      });
    }, {
      rootMargin: '50px'
    });
    
    // Observar todas las filas
    document.querySelectorAll('#tabla tbody tr').forEach(fila => {
      observer.observe(fila);
    });
  }
}

// Función para cargar datos de fila de manera lazy
function cargarDatosFila(fila, index) {
  if (fila.dataset.loaded) return;
  
  // Marcar como cargada
  fila.dataset.loaded = 'true';
  
  // Aquí puedes implementar carga lazy de datos adicionales
  // Por ejemplo, cargar imágenes, calcular métricas, etc.
  
  // Agregar clase de animación
  fila.classList.add('fila-cargada');
}

// Función para mejorar la selección de filas
function mejorarSeleccionFilas() {
  // Usar event delegation para mejor rendimiento
  const tbody = document.querySelector('#tabla tbody');
  if (!tbody) return;
  
  tbody.addEventListener('click', (e) => {
    const fila = e.target.closest('tr');
    if (!fila) return;
    
    const index = parseInt(fila.dataset.index);
    if (isNaN(index)) return;
    
    // Evitar selección en checkboxes y botones
    if (e.target.closest('.enlace-checkbox') || e.target.closest('.btn-accion')) {
      return;
    }
    
    seleccionarFila(fila, index);
  });
  
  // Agregar soporte para selección múltiple con Ctrl/Cmd
  tbody.addEventListener('keydown', (e) => {
    if (e.ctrlKey || e.metaKey) {
      const filaSeleccionada = document.querySelector('#tabla tbody tr.seleccionada');
      if (filaSeleccionada) {
        const index = parseInt(filaSeleccionada.dataset.index);
        if (!isNaN(index)) {
          // Implementar selección múltiple aquí
          console.log('🔗 Selección múltiple activada');
        }
      }
    }
  });
}

// Función para optimizar el scroll de la tabla
function optimizarScrollTabla() {
  const tabla = document.querySelector('#tabla');
  if (!tabla) return;
  
  let ticking = false;
  
  const actualizarScroll = () => {
    // Implementar optimizaciones de scroll aquí
    // Por ejemplo, ocultar filas no visibles, etc.
    ticking = false;
  };
  
  const requestTick = () => {
    if (!ticking) {
      requestAnimationFrame(actualizarScroll);
      ticking = true;
    }
  };
  
  tabla.addEventListener('scroll', requestTick, { passive: true });
}

// Función para aplicar todas las optimizaciones
function aplicarOptimizacionesTabla() {
  console.log('🚀 Aplicando optimizaciones de tabla...');
  
  // Inicializar cache
  inicializarCacheTorres();
  
  // Mejorar selección de filas
  mejorarSeleccionFilas();
  
  // Optimizar scroll
  optimizarScrollTabla();
  
  // Optimizar renderizado
  optimizarRenderizadoTabla();
  
  console.log('✅ Optimizaciones de tabla aplicadas');
}

// ===== EVENT LISTENER PARA INICIALIZACIÓN =====
document.addEventListener('DOMContentLoaded', function() {
  // Limpiar localStorage antes de inicializar
  limpiarLocalStorageInvalido();
  
  inicializarInterfazEmpresarial();
  mostrarPerfilUsuario();
  
  // Aplicar optimizaciones de tabla
  aplicarOptimizacionesTabla();
  
  // Cargar datos existentes al inicializar
  cargarDatosExistentes();
});

// Configuración de botones
if (localStorage.getItem('fangioSesion') === 'activa') {
  document.getElementById('logoutBtn').style.display = 'flex';
}

document.getElementById('logoutBtn').onclick = function() {
  localStorage.removeItem('fangioSesion');
  window.location.href = 'login.html';
};

document.getElementById('toggleThemeBtn').onclick = function() {
  // Forzar siempre tema oscuro
  document.body.classList.remove('modo-claro');
  localStorage.setItem('fangioTema', 'oscuro');
  mostrarNotificacion('Tema Bloqueado', 'Solo modo oscuro disponible', 'info');
};

// Forzar tema oscuro
document.body.classList.remove('modo-claro');
localStorage.setItem('fangioTema', 'oscuro');
</script>

  <!-- Estilos para optimizaciones de tabla -->
  <style>
    /* Estilos para el estado de factibilidad */
    .estado-factibilidad {
      font-weight: bold;
    }
    .estado-factibilidad[data-color="#10b981"] {
      color: #10b981;
    }
    .estado-factibilidad[data-color="#ef4444"] {
      color: #ef4444;
    }
    .estado-factibilidad[data-color="#f59e42"] {
      color: #f59e42;
    }
    
    /* Estilos para indicador de factibilidad */
    .indicador-factibilidad {
      font-weight: bold;
    }
    .indicador-factibilidad[data-color="#10b981"] {
      color: #10b981;
    }
    .indicador-factibilidad[data-color="#ef4444"] {
      color: #ef4444;
    }
    .indicador-factibilidad[data-color="#f59e42"] {
      color: #f59e42;
    }
    
    /* Estilos para preview de factibilidad */
    .preview-factibilidad {
      font-weight: bold;
    }
    .preview-factibilidad[data-color="#10b981"] {
      color: #10b981;
    }
    .preview-factibilidad[data-color="#ef4444"] {
      color: #ef4444;
    }
    
    /* Estilos para indicador de factibilidad */
    .indicador-factibilidad {
      font-weight: bold;
    }
    .indicador-factibilidad[data-color="#10b981"] {
      color: #10b981;
    }
    .indicador-factibilidad[data-color="#ef4444"] {
      color: #ef4444;
    }
    .indicador-factibilidad[data-color="#f59e42"] {
      color: #f59e42;
    }
    
    /* Estilos para filas seleccionadas */
    #tabla tbody tr.seleccionada {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%) !important;
      color: white !important;
      transform: scale(1.01);
      transition: all 0.2s ease;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
    }
    
    #tabla tbody tr.seleccionada:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
    }
    
    /* Estilos para filas con lazy loading */
    #tabla tbody tr.fila-cargada {
      animation: fadeInUp 0.3s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Estilos para botones de acción */
    .btn-accion {
      background: transparent;
      border: none;
      color: #2563eb;
      padding: 5px 8px;
      margin: 0 2px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn-accion:hover {
      background: #2563eb;
      color: white;
      transform: translateY(-1px);
    }
    
    .btn-ver:hover {
      background: #059669;
    }
    
    .btn-editar:hover {
      background: #f59e0b;
    }
    
    /* Estilos para indicadores */
    .indicador-pagina,
    .indicador-virtualizacion {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
    }
    
    /* Estilos para scroll suave */
    #tabla {
      scroll-behavior: smooth;
    }
    
    /* Estilos para checkboxes optimizados */
    .enlace-checkbox {
      transform: scale(1.2);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .enlace-checkbox:checked {
      transform: scale(1.3);
    }
    
    /* Estilos para hover en filas */
    #tabla tbody tr:hover:not(.seleccionada) {
      background: rgba(37, 99, 235, 0.05);
      transform: translateX(2px);
      transition: all 0.2s ease;
    }
    
    /* Estilos para panel de detalles */
    #panel-detalles {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      padding: 20px;
      margin-top: 20px;
      border-left: 4px solid #2563eb;
    }
    
    .detalles-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .detalles-header h3 {
      margin: 0;
      color: #333;
    }
    
    .estado {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .estado.factible {
      background: #d4edda;
      color: #155724;
    }
    
    .estado.no-factible {
      background: #f8d7da;
      color: #721c24;
    }
    
    .detalle-grupo {
      margin-bottom: 20px;
    }
    
    .detalle-grupo h4 {
      color: #2563eb;
      margin-bottom: 10px;
      font-size: 16px;
    }
    
    .detalle-grupo p {
      margin: 5px 0;
      color: #666;
    }
    
    .detalle-grupo strong {
      color: #333;
    }
  </style>

  <!-- Footer Profesional -->
  <footer class="footer-modern">
    <div class="footer-content">
      <div class="footer-section">
        <div class="footer-logo">
          <i class="fas fa-satellite-dish"></i>
          <span>Fangio Telecom</span>
        </div>
        <p class="footer-description">
          Plataforma profesional para la gestión y análisis de enlaces Point-to-Point (PtP) 
          con capacidades avanzadas de planificación de radioenlaces.
        </p>
      </div>
      
      <div class="footer-section">
        <h4 class="footer-title">Capacidades Técnicas</h4>
        <ul class="footer-features">
          <li><i class="fas fa-check"></i> Análisis de Factibilidad</li>
          <li><i class="fas fa-check"></i> Planificación de Frecuencias</li>
          <li><i class="fas fa-check"></i> Gestión de Infraestructura</li>
          <li><i class="fas fa-check"></i> Exportación de Datos</li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4 class="footer-title">Información del Sistema</h4>
        <div class="footer-info">
          <div class="info-item">
            <i class="fas fa-code-branch"></i>
            <span>Versión: 2.1.0</span>
          </div>
          <div class="info-item">
            <i class="fas fa-calendar-alt"></i>
            <span>Última actualización: <span id="footer-update-time">2024</span></span>
          </div>
          <div class="info-item">
            <i class="fas fa-server"></i>
            <span>Estado: Operativo</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer-bottom">
      <div class="footer-copyright">
        <i class="fas fa-copyright"></i>
        <span>2024 Fangio Telecom. Todos los derechos reservados.</span>
      </div>
      <div class="footer-links">
        <a href="https://fangio.com.mx" target="_blank" class="footer-link">
          <i class="fas fa-globe"></i>
          <span>Sitio Web</span>
        </a>
        <a href="#" class="footer-link">
          <i class="fas fa-file-alt"></i>
          <span>Documentación</span>
        </a>
        <a href="#" class="footer-link">
          <i class="fas fa-headset"></i>
          <span>Soporte</span>
        </a>
      </div>
    </div>
  </footer>
  
  <!-- Scripts de debug -->
  <script>
    // Función de debug para verificar el estado del localStorage
    function debugLocalStorage() {
      console.log('🔍 === DEBUG LOCALSTORAGE ===');
      console.log('📊 Claves disponibles:', Object.keys(localStorage));
      
      const enlacesPtP = localStorage.getItem('enlacesPtP');
      const enlacesMismo = localStorage.getItem('enlacesMismoTransporte');
      const enlacesGenericos = localStorage.getItem('enlaces');
      
      console.log('📋 enlacesPtP:', enlacesPtP ? JSON.parse(enlacesPtP).length : 'null');
      console.log('📋 enlacesMismoTransporte:', enlacesMismo ? JSON.parse(enlacesMismo).length : 'null');
      console.log('📋 enlaces:', enlacesGenericos ? JSON.parse(enlacesGenericos).length : 'null');
      
      if (enlacesPtP) {
        console.log('📊 Muestra enlacesPtP:', JSON.parse(enlacesPtP).slice(0, 2));
      }
      if (enlacesMismo) {
        console.log('📊 Muestra enlacesMismoTransporte:', JSON.parse(enlacesMismo).slice(0, 2));
      }
      if (enlacesGenericos) {
        console.log('📊 Muestra enlaces:', JSON.parse(enlacesGenericos).slice(0, 2));
      }
      
      console.log('🔍 === FIN DEBUG ===');
    }

    // Función para limpiar localStorage de enlaces
    function limpiarEnlacesLocalStorage() {
      console.log('🧹 Limpiando localStorage de enlaces...');
      localStorage.removeItem('enlacesPtP');
      localStorage.removeItem('enlacesMismoTransporte');
      localStorage.removeItem('enlaces');
      console.log('✅ localStorage de enlaces limpiado');
      
      // Actualizar interfaz
      if (typeof actualizarContadorEnlaces === 'function') {
        actualizarContadorEnlaces();
      }
      if (typeof verificarEnlacesVacios === 'function') {
        verificarEnlacesVacios();
      }
    }

    // Función para forzar el procesamiento de pares
    function forzarProcesamientoPares() {
      console.log('🚀 Forzando procesamiento de pares...');
      
      // Verificar que los archivos estén cargados
      if (!window.dataExcel || !window.dataExcel.length) {
        alert('❌ Error: Primero debes cargar el Excel con los datos de las torres');
        return;
      }
      if (!window.dataPares || !window.dataPares.length) {
        alert('❌ Error: No hay pares de IDs para procesar');
        return;
      }
      
      console.log(`📊 Datos disponibles: ${window.dataExcel.length} torres, ${window.dataPares.length} pares`);
      
      // Llamar a la función original
      if (typeof procesarPares === 'function') {
        procesarPares();
      } else {
        console.error('❌ Función procesarPares no encontrada');
      }
    }

    // Agregar botones de debug al DOM
    function agregarBotonesDebug() {
      const debugContainer = document.createElement('div');
      debugContainer.id = 'debug-container';
      debugContainer.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 15px;
        border-radius: 8px;
        z-index: 10000;
        font-family: monospace;
        font-size: 12px;
      `;
      
      debugContainer.innerHTML = `
        <div style="margin-bottom: 10px; font-weight: bold;">🐛 Debug</div>
        <button onclick="debugLocalStorage()" style="margin: 2px; padding: 5px; font-size: 10px;">🔍 Ver Storage</button>
        <button onclick="limpiarEnlacesLocalStorage()" style="margin: 2px; padding: 5px; font-size: 10px;">🧹 Limpiar</button>
        <button onclick="forzarProcesamientoPares()" style="margin: 2px; padding: 5px; font-size: 10px;">🚀 Forzar</button>
        <button onclick="this.parentElement.remove()" style="margin: 2px; padding: 5px; font-size: 10px;">❌ Cerrar</button>
      `;
      
      document.body.appendChild(debugContainer);
    }

    // Agregar botones de debug cuando se carga la página
    document.addEventListener('DOMContentLoaded', function() {
      // Agregar botones de debug después de 2 segundos
      setTimeout(agregarBotonesDebug, 2000);
      
      console.log('🔧 Botones de debug agregados. Usa debugLocalStorage() en la consola para ver el estado.');
    });

    // Funciones adicionales del archivo ptpFangio20.html
    document.getElementById('btnDescargarFaltantes').onclick = function() {
      if (!window.paresFaltantes || window.paresFaltantes.length === 0) {
        alert('No hay pares faltantes.');
        return;
      }
      let csv = 'ID_A;ID_B;Falta_A;Falta_B\n';
      window.paresFaltantes.forEach(par => {
        csv += par.join(';') + '\n';
      });
      const blob = new Blob([csv], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pares_faltantes.csv';
      a.click();
      URL.revokeObjectURL(url);
    };

    function mostrarTablaMismoTransporte() {
      const contenedor = document.getElementById('tabla-mismo-transporte');
      if (!contenedor) return;
      const enlaces = JSON.parse(localStorage.getItem('enlacesMismoTransporte') || '[]');
      if (!enlaces.length) {
        contenedor.innerHTML = `<div style="color:#ef4444; text-align:center; margin:32px 0;">
          <i class="fas fa-exclamation-triangle"></i> No hay enlaces procesados con mismo tipo de transporte.
        </div>`;
        return;
      }
      let html = `
        <div class="enlaces-counter">
          <i class="fas fa-chart-line"></i> Total de Enlaces (Permisivo): <span id="total-enlaces-mismo">${enlaces.length}</span>
        </div>
        <div class="action-buttons">
          <button class="btn btn-success" onclick="exportarExcelMismoTransporte()">
            <i class="fas fa-file-excel"></i> Exportar a Excel
          </button>
          <button class="btn btn-secondary" onclick="seleccionarTodosMismoTransporte()">
            <i class="fas fa-check-double"></i> Seleccionar Todos
          </button>
          <button class="btn btn-danger" onclick="eliminarEnlacesSeleccionadosMismo()" id="btnEliminarSeleccionadosMismo" disabled>
            <i class="fas fa-trash"></i> Eliminar Seleccionados
          </button>
          <button id="btnPerfilElevacionMismo" class="btn btn-info" style="display:none; margin-left:8px;">
            <i class="fas fa-mountain"></i> Perfil Elevación
          </button>
        </div>
        <div class="table-container">
          <table id="tabla-mismo-tipo" style="width:100%;border-radius:12px;overflow:hidden;">
            <thead>
              <tr>
                <th><input type="checkbox" id="checkTodosMismo" onclick="toggleSeleccionarTodosMismo(this)"></th>
                <th>ID A</th>
                <th>Nombre A</th>
                <th>Lat A</th>
                <th>Lon A</th>
                <th>Lat A (rad)</th>
                <th>Lon A (rad)</th>
                <th>ID B</th>
                <th>Nombre B</th>
                <th>Lat B</th>
                <th>Lon B</th>
                <th>Lat B (rad)</th>
                <th>Lon B (rad)</th>
                <th>Distancia (km)</th>
                <th>Frecuencia (GHz)</th>
                <th>Disponibilidad</th>
                <th>Altura Torre A</th>
                <th>Altura Torre B</th>
                <th>Altura RAN A</th>
                <th>Altura RAN B</th>
                <th>Transporte A</th>
                <th>Transporte B</th>
                <th>Arrendamiento A</th>
                <th>Arrendamiento B</th>
                <th>On Air A</th>
                <th>On Air B</th>
                <th>Tipo Torre A</th>
                <th>Tipo Torre B</th>
                <th>Estado A</th>
                <th>Estado B</th>
                <th>Factible</th>
                <th>Antenas</th>
                <th>Tipo Enlace</th>
                <th>Análisis</th>
              </tr>
            </thead>
            <tbody>
      `;
      enlaces.forEach((enlaceData, idx) => {
        html += `<tr data-idx="${idx}">`;
        html += `<td><input type="checkbox" class="check-mismo-transporte" onchange="resaltarFilaMismoTransporte(this)"></td>`;
        enlaceData.forEach((val, i) => {
          if (i === enlaceData.length - 1) {
            html += `<td style="text-align:center;">
              <button class="btn btn-info btn-sm" style="width: 140px; font-size: 1rem; font-weight:600; display:flex;align-items:center;justify-content:center;gap:8px;"
                onclick="try{mostrarAnalisisDetallado(JSON.parse(decodeURIComponent(this.dataset.analisis)));}catch(e){alert('No hay análisis detallado disponible.');}" 
                data-analisis="${encodeURIComponent(val)}">
                <i class="fas fa-info-circle"></i> Ver Análisis
              </button>
            </td>`;
          } else {
            html += `<td>${val}</td>`;
          }
        });
        html += `</tr>`;
      });
      html += '</tbody></table></div>';
      contenedor.innerHTML = html;
      const tbody = contenedor.querySelector('tbody');
      let filaSeleccionada = null;
      tbody.addEventListener('click', function(e) {
        const fila = e.target.closest('tr');
        if (!fila) return;
        tbody.querySelectorAll('tr').forEach(f => f.classList.remove('selected'));
        fila.classList.add('selected');
        filaSeleccionada = fila;
        document.getElementById('btnPerfilElevacionMismo').style.display = 'inline-block';
      });
      document.getElementById('btnPerfilElevacionMismo').onclick = function() {
        if (!filaSeleccionada) return;
        const celdas = filaSeleccionada.querySelectorAll('td');
        const datos = {
          idA: celdas[1]?.textContent,
          nombreA: celdas[2]?.textContent,
          latA: celdas[3]?.textContent,
          lonA: celdas[4]?.textContent,
          idB: celdas[7]?.textContent,
          nombreB: celdas[8]?.textContent,
          latB: celdas[9]?.textContent,
          lonB: celdas[10]?.textContent,
          alturaA: celdas[16]?.textContent,
          alturaB: celdas[17]?.textContent,
          frecuencia: celdas[13]?.textContent
        };
        mostrarPerfilElevacionDesdeDatos(datos);
        const perfilDiv = document.getElementById('perfil-elevacion-con-torres');
        if (perfilDiv) {
          perfilDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      };
    }

    function resaltarFilaMismoTransporte(checkbox) {
      const fila = checkbox.closest('tr');
      if (checkbox.checked) {
        fila.classList.add('selected');
      } else {
        fila.classList.remove('selected');
      }
      const algunoSeleccionado = Array.from(document.querySelectorAll('#tabla-mismo-tipo .check-mismo-transporte')).some(cb => cb.checked);
      document.getElementById('btnEliminarSeleccionadosMismo').disabled = !algunoSeleccionado;
    }

    function toggleSeleccionarTodosMismo(master) {
      document.querySelectorAll('#tabla-mismo-tipo .check-mismo-transporte').forEach(cb => cb.checked = master.checked);
      document.getElementById('btnEliminarSeleccionadosMismo').disabled = !master.checked;
    }

    function seleccionarTodosMismoTransporte() {
      document.querySelectorAll('#tabla-mismo-tipo .check-mismo-transporte').forEach(cb => cb.checked = true);
      document.getElementById('btnEliminarSeleccionadosMismo').disabled = false;
    }

    function eliminarEnlacesSeleccionadosMismo() {
      if (!confirm('¿Seguro que deseas eliminar los enlaces seleccionados?')) return;
      const checks = Array.from(document.querySelectorAll('#tabla-mismo-tipo .check-mismo-transporte'));
      const enlaces = JSON.parse(localStorage.getItem('enlacesMismoTransporte') || '[]');
      const nuevos = enlaces.filter((_, idx) => !checks[idx].checked);
      localStorage.setItem('enlacesMismoTransporte', JSON.stringify(nuevos));
      mostrarTablaMismoTransporte();
      document.getElementById('btnEliminarSeleccionadosMismo').disabled = true;
    }

    function exportarExcelMismoTransporte() {
      const tabla = document.getElementById('tabla-mismo-tipo');
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.table_to_sheet(tabla);
      XLSX.utils.book_append_sheet(wb, ws, "MismoTransporte");
      XLSX.writeFile(wb, "enlaces_mismo_transporte.xlsx");
    }

    function exportarFactiblesParaPathloss() {
      const filasNormales = Array.from(document.querySelectorAll('#tabla tbody tr'));
      const filasMismo = [];
      const tablaMismo = document.getElementById('tabla-mismo-tipo');
      if (tablaMismo) {
        Array.from(tablaMismo.querySelectorAll('tbody tr')).forEach(tr => filasMismo.push(tr));
      }
      const filas = filasNormales.concat(filasMismo);
      const factibles = filas.filter(fila => {
        const celdas = fila.querySelectorAll('td');
        const val = celdas[30]?.textContent.trim().toUpperCase();
        return val === 'SÍ' || val.startsWith('FACTIBLE');
      });
      if (factibles.length === 0) {
        alert('No hay enlaces factibles para exportar');
        return;
      }
      const encabezado = [
        'ID A','Nombre A','Latitud A','Longitud A','ID B','Nombre B','Latitud B','Longitud B',
        'Arrendamiento A','Arrendamiento B','Tipo Torre A','Tipo Torre B','Transporte A','Transporte B',
        'Distancia (km)','Frecuencia (GHz)','Altura RAN A','Altura RAN B','Altura Torre A','Altura Torre B',
        'On Air A','On Air B','Antenas'
      ];
      const datos = factibles.map(fila => {
        const c = fila.querySelectorAll('td');
        return [
          c[1]?.textContent,   // ID A
          c[2]?.textContent,   // Nombre A
          c[3]?.textContent,   // Latitud A
          c[4]?.textContent,   // Longitud A
          c[7]?.textContent,   // ID B
          c[8]?.textContent,   // Nombre B
          c[9]?.textContent,   // Latitud B
          c[10]?.textContent,  // Longitud B
          c[22]?.textContent,  // Arrendamiento A
          c[23]?.textContent,  // Arrendamiento B
          c[26]?.textContent,  // Tipo Torre A
          c[27]?.textContent,  // Tipo Torre B
          c[20]?.textContent,  // Transporte A
          c[21]?.textContent,  // Transporte B
          c[13]?.textContent,  // Distancia (km)
          c[14]?.textContent,  // Frecuencia (GHz)
          c[18]?.textContent,  // Altura RAN A
          c[19]?.textContent,  // Altura RAN B
          c[16]?.textContent,  // Altura Torre A
          c[17]?.textContent,  // Altura Torre B
          c[24]?.textContent,  // On Air A
          c[25]?.textContent,  // On Air B
          c[31]?.textContent   // Antenas
        ].join(';');
      });
      const csv = [encabezado.join(';')].concat(datos).join('\n');
      const blob = new Blob([csv], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'enlaces_factibles_pathloss.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function mostrarAnalisisDetallado(factibilidad) {
      const modal = document.getElementById('modal-analisis');
      const icono = document.getElementById('modal-analisis-icono');
      const titulo = document.getElementById('modal-analisis-titulo');
      const resumen = document.getElementById('modal-analisis-resumen');
      const lista = document.getElementById('modal-analisis-lista');
      
      if (factibilidad.factible) {
        icono.innerHTML = '✅';
        icono.style.color = '#10b981';
        titulo.textContent = 'Enlace Factible';
        resumen.textContent = 'Este enlace cumple con los criterios de factibilidad.';
      } else {
        icono.innerHTML = '❌';
        icono.style.color = '#ef4444';
        titulo.textContent = 'Enlace No Factible';
        resumen.textContent = factibilidad.razon || 'El enlace no cumple con los criterios de factibilidad.';
      }
      
      lista.innerHTML = '';
      if (factibilidad.detalles && Array.isArray(factibilidad.detalles)) {
        factibilidad.detalles.forEach(detalle => {
          const li = document.createElement('li');
          li.textContent = detalle;
          lista.appendChild(li);
        });
      }
      
      modal.style.display = 'flex';
    }

    function cerrarModalAnalisis() {
      document.getElementById('modal-analisis').style.display = 'none';
    }

    function agregarOActualizarEnlace() {
      const get = id => document.getElementById(id).value.trim();
      const latA = parseFloat(get('latA'));
      const lonA = parseFloat(get('lonA'));
      const latB = parseFloat(get('latB'));
      const lonB = parseFloat(get('lonB'));
      
      if (!get('idA') || !get('idB')) {
        alert('❌ Error: Debes especificar ambos IDs de torre');
        return;
      }
      
      if (isNaN(latA) || isNaN(lonA) || isNaN(latB) || isNaN(lonB)) {
        alert('❌ Error: Las coordenadas deben ser números válidos');
        return;
      }
      
      const distanciaKm = calcularDistancia(latA, lonA, latB, lonB);
      const frecuencia = asignarFrecuencia(distanciaKm);
      
      const factibilidad = analizarFactibilidad(
        distanciaKm,
        get('ArreA'),
        get('ArreB'),
        get('TransA'),
        get('TransB'),
        get('TorreA'),
        get('TorreB'),
        get('OnA'),
        get('OnB'),
        window.ultimaFactibilidadLOS
      );
      
      const estadoFactible = (factibilidad.advertencia)
        ? 'FACTIBLE (Requiere análisis)'
        : (factibilidad.razon && factibilidad.razon.toUpperCase().includes('NO DISPONIBLE'))
          ? 'NO DISPONIBLE'
          : (factibilidad.factible ? 'SÍ' : 'NO');
      
      const filaDatos = [
        get('idA'), get('nombreA'), get('latA'), get('lonA'),
        document.getElementById('latArad').value,
        document.getElementById('lonArad').value,
        get('idB'), get('nombreB'), get('latB'), get('lonB'),
        document.getElementById('latBrad').value,
        document.getElementById('lonBrad').value,
        distanciaKm.toFixed(6), frecuencia,
        document.getElementById('disponibilidadAnual').value,
        get('alturaA'), get('alturaB'), get('ranA'), get('ranB'),
        get('TransA'), get('TransB'), get('ArreA'), get('ArreB'),
        get('OnA'), get('OnB'), get('TorreA'), get('TorreB'),
        get('EstadoA'), get('EstadoB'),
        estadoFactible,
        factibilidad.diametroAntena,
        factibilidad.tipoEnlace,
        JSON.stringify(factibilidad)
      ];
      
      const tbody = document.querySelector('#tabla tbody');
      const fila = document.createElement('tr');
      
      // Checkbox
      const tdCheck = document.createElement('td');
      const check = document.createElement('input');
      check.type = 'checkbox';
      check.className = 'check-enlace';
      check.onclick = function(e) {
        e.stopPropagation();
        actualizarBotonEliminarSeleccionados();
      };
      tdCheck.appendChild(check);
      fila.appendChild(tdCheck);
      
      // Datos del enlace
      filaDatos.forEach((val, i) => {
        const td = document.createElement('td');
        if (i === 33) {
          const btn = document.createElement('button');
          btn.className = 'btn btn-info btn-sm';
          btn.innerHTML = '<i class="fas fa-info-circle"></i> Ver Análisis';
          btn.onclick = function(e) {
            e.stopPropagation();
            try {
              const analisis = JSON.parse(val);
              mostrarAnalisisDetallado(analisis);
            } catch {
              alert('No hay análisis detallado disponible.');
            }
          };
          td.appendChild(btn);
          td.dataset.analisis = val;
        } else {
          td.textContent = val;
        }
        fila.appendChild(td);
      });
      
      aplicarEstiloFactibilidad(fila, factibilidad.factible, factibilidad.razon);
      tbody.appendChild(fila);
      
      actualizarContadorEnlaces();
      verificarEnlacesVacios();
      guardarEnlacesEnStorage();
      
      mostrarNotificacion('✅ Enlace agregado correctamente', 'success');
      limpiarFormulario();
    }

    function aplicarEstiloFactibilidad(fila, esFactible, razon = "") {
      if (esFactible) {
        fila.style.backgroundColor = '#f0fdf4';
        fila.style.borderLeft = '4px solid #10b981';
      } else {
        fila.style.backgroundColor = '#fef2f2';
        fila.style.borderLeft = '4px solid #ef4444';
      }
      
      if (razon && razon.toUpperCase().includes('ADVERTENCIA')) {
        fila.style.backgroundColor = '#fffbeb';
        fila.style.borderLeft = '4px solid #f59e42';
      }
    }

    function cargarFilaEnFormulario(fila) {
      const celdas = fila.querySelectorAll('td');
      document.getElementById('idA').value = celdas[1]?.textContent || '';
      document.getElementById('nombreA').value = celdas[2]?.textContent || '';
      document.getElementById('latA').value = celdas[3]?.textContent || '';
      document.getElementById('lonA').value = celdas[4]?.textContent || '';
      document.getElementById('alturaA').value = celdas[16]?.textContent || '';
      document.getElementById('ranA').value = celdas[18]?.textContent || '';
      document.getElementById('TransA').value = celdas[20]?.textContent || '';
      document.getElementById('ArreA').value = celdas[22]?.textContent || '';
      document.getElementById('OnA').value = celdas[24]?.textContent || '';
      document.getElementById('TorreA').value = celdas[26]?.textContent || '';
      document.getElementById('EstadoA').value = celdas[28]?.textContent || '';
      
      document.getElementById('idB').value = celdas[7]?.textContent || '';
      document.getElementById('nombreB').value = celdas[8]?.textContent || '';
      document.getElementById('latB').value = celdas[9]?.textContent || '';
      document.getElementById('lonB').value = celdas[10]?.textContent || '';
      document.getElementById('alturaB').value = celdas[17]?.textContent || '';
      document.getElementById('ranB').value = celdas[19]?.textContent || '';
      document.getElementById('TransB').value = celdas[21]?.textContent || '';
      document.getElementById('ArreB').value = celdas[23]?.textContent || '';
      document.getElementById('OnB').value = celdas[25]?.textContent || '';
      document.getElementById('TorreB').value = celdas[27]?.textContent || '';
      document.getElementById('EstadoB').value = celdas[29]?.textContent || '';
      
      actualizarCalculos();
      mostrarPestana('formulario');
    }

    function validarFactibilidadEnTiempoReal() {
      const get = id => document.getElementById(id).value.trim();
      const latA = parseFloat(get('latA'));
      const lonA = parseFloat(get('lonA'));
      const latB = parseFloat(get('latB'));
      const lonB = parseFloat(get('lonB'));
      
      if (!get('idA') || !get('idB') || isNaN(latA) || isNaN(lonA) || isNaN(latB) || isNaN(lonB)) {
        document.getElementById('agregarBtn').disabled = true;
        return;
      }
      
      document.getElementById('agregarBtn').disabled = false;
    }

    function mostrarVistaPrevia() {
      const get = id => document.getElementById(id).value.trim();
      const latA = parseFloat(get('latA'));
      const lonA = parseFloat(get('lonA'));
      const latB = parseFloat(get('latB'));
      const lonB = parseFloat(get('lonB'));
      
      if (!get('idA') || !get('idB') || isNaN(latA) || isNaN(lonA) || isNaN(latB) || isNaN(lonB)) {
        alert('❌ Error: Completa todos los campos requeridos');
        return;
      }
      
      const distanciaKm = calcularDistancia(latA, lonA, latB, lonB);
      const frecuencia = asignarFrecuencia(distanciaKm);
      
      const factibilidad = analizarFactibilidad(
        distanciaKm,
        get('ArreA'),
        get('ArreB'),
        get('TransA'),
        get('TransB'),
        get('TorreA'),
        get('TorreB'),
        get('OnA'),
        get('OnB'),
        window.ultimaFactibilidadLOS
      );
      
      const mensaje = `
📊 Vista Previa del Enlace:

📍 Torre A: ${get('idA')} - ${get('nombreA')}
📍 Torre B: ${get('idB')} - ${get('nombreB')}
📏 Distancia: ${distanciaKm.toFixed(2)} km
📡 Frecuencia: ${frecuencia} GHz
✅ Factible: ${factibilidad.factible ? 'SÍ' : 'NO'}
📋 Tipo: ${factibilidad.tipoEnlace}
📡 Antenas: ${factibilidad.diametroAntena}
      `;
      
      alert(mensaje);
    }

    function eliminarEnlace() {
      const filaSeleccionada = document.querySelector('#tabla tbody tr.selected');
      if (!filaSeleccionada) {
        alert('❌ Error: Selecciona un enlace para eliminar');
        return;
      }
      
      if (confirm('¿Estás seguro de que deseas eliminar este enlace?')) {
        filaSeleccionada.remove();
        actualizarContadorEnlaces();
        verificarEnlacesVacios();
        guardarEnlacesEnStorage();
        mostrarNotificacion('🗑️ Enlace eliminado correctamente', 'info');
      }
    }

    function limpiarFormulario() {
      document.getElementById('idA').value = '';
      document.getElementById('nombreA').value = '';
      document.getElementById('latA').value = '';
      document.getElementById('lonA').value = '';
      document.getElementById('alturaA').value = '';
      document.getElementById('ranA').value = '';
      document.getElementById('TransA').value = '';
      document.getElementById('ArreA').value = '';
      document.getElementById('OnA').value = '';
      document.getElementById('TorreA').value = '';
      document.getElementById('EstadoA').value = '';
      
      document.getElementById('idB').value = '';
      document.getElementById('nombreB').value = '';
      document.getElementById('latB').value = '';
      document.getElementById('lonB').value = '';
      document.getElementById('alturaB').value = '';
      document.getElementById('ranB').value = '';
      document.getElementById('TransB').value = '';
      document.getElementById('ArreB').value = '';
      document.getElementById('OnB').value = '';
      document.getElementById('TorreB').value = '';
      document.getElementById('EstadoB').value = '';
      
      document.getElementById('agregarBtn').disabled = true;
    }

    function exportarExcel() {
      const tabla = document.querySelector('#tabla tbody');
      const filas = tabla.querySelectorAll('tr');
      
      if (filas.length === 0) {
        alert('❌ Error: No hay enlaces para exportar');
        return;
      }
      
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.table_to_sheet(document.getElementById('tabla'));
      XLSX.utils.book_append_sheet(wb, ws, "EnlacesPtP");
      XLSX.writeFile(wb, "enlaces_ptp_fangio.xlsx");
      
      mostrarNotificacion('📊 Excel exportado correctamente', 'success');
    }

    function seleccionarTodo() {
      document.querySelectorAll('#tabla tbody .check-enlace').forEach(cb => cb.checked = true);
      actualizarContadorSeleccionados();
    }

    function deseleccionarTodo() {
      document.querySelectorAll('#tabla tbody .check-enlace').forEach(cb => cb.checked = false);
      actualizarContadorSeleccionados();
    }

    function actualizarContadorSeleccionados() {
      const seleccionados = document.querySelectorAll('#tabla tbody .check-enlace:checked').length;
      const total = document.querySelectorAll('#tabla tbody .check-enlace').length;
      document.getElementById('contadorSeleccionados').textContent = `${seleccionados} de ${total}`;
    }

    function eliminarSeleccionados() {
      const checks = document.querySelectorAll('#tabla tbody .check-enlace:checked');
      if (checks.length === 0) {
        alert('❌ Error: No hay enlaces seleccionados');
        return;
      }
      
      if (confirm(`¿Estás seguro de que deseas eliminar ${checks.length} enlaces?`)) {
        checks.forEach(check => check.closest('tr').remove());
        actualizarContadorEnlaces();
        verificarEnlacesVacios();
        guardarEnlacesEnStorage();
        actualizarContadorSeleccionados();
        mostrarNotificacion(`🗑️ ${checks.length} enlaces eliminados correctamente`, 'info');
      }
    }

    function guardarEnlacesEnStorage() {
      const tabla = document.querySelector('#tabla tbody');
      const filas = tabla.querySelectorAll('tr');
      const enlaces = [];
      
      filas.forEach(fila => {
        const celdas = fila.querySelectorAll('td');
        const enlace = [];
        for (let i = 1; i < celdas.length; i++) {
          if (i === 33 && celdas[i].querySelector('button') && celdas[i].dataset.analisis) {
            enlace.push(celdas[i].dataset.analisis);
          } else {
            enlace.push(celdas[i].textContent);
          }
        }
        enlaces.push(enlace);
      });
      
      localStorage.setItem('enlacesPtP', JSON.stringify(enlaces));
    }

    function cargarEnlacesDeStorage() {
      const enlacesGuardados = localStorage.getItem('enlacesPtP');
      if (!enlacesGuardados) return;
      
      const enlaces = JSON.parse(enlacesGuardados);
      const tbody = document.querySelector('#tabla tbody');
      tbody.innerHTML = '';
      
      enlaces.forEach(enlaceData => {
        const fila = document.createElement('tr');
        
        // Checkbox
        const tdCheck = document.createElement('td');
        const check = document.createElement('input');
        check.type = 'checkbox';
        check.className = 'check-enlace';
        check.onclick = function(e) {
          e.stopPropagation();
          actualizarBotonEliminarSeleccionados();
        };
        tdCheck.appendChild(check);
        fila.appendChild(tdCheck);
        
        // Datos del enlace
        enlaceData.forEach((val, i) => {
          const td = document.createElement('td');
          if (i === enlaceData.length - 1) {
            const btn = document.createElement('button');
            btn.className = 'btn btn-info btn-sm';
            btn.innerHTML = '<i class="fas fa-info-circle"></i> Ver Análisis';
            btn.onclick = function(e) {
              e.stopPropagation();
              try {
                const analisis = JSON.parse(val);
                mostrarAnalisisDetallado(analisis);
              } catch {
                alert('No hay análisis detallado disponible.');
              }
            };
            td.appendChild(btn);
            td.dataset.analisis = val;
          } else {
            td.textContent = val;
          }
          fila.appendChild(td);
        });
        
        tbody.appendChild(fila);
      });
      
      actualizarContadorEnlaces();
      verificarEnlacesVacios();
    }

    function actualizarBotonEliminarSeleccionados() {
      const algunoSeleccionado = Array.from(document.querySelectorAll('#tabla tbody .check-enlace')).some(cb => cb.checked);
      const btn = document.getElementById('btnEliminarSeleccionados');
      if (btn) {
        btn.disabled = !algunoSeleccionado;
      }
    }

    function eliminarEnlacesSeleccionados() {
      if (!confirm('¿Seguro que deseas eliminar los enlaces seleccionados?')) return;
      
      document.querySelectorAll('#tabla tbody .check-enlace:checked').forEach(cb => {
        cb.closest('tr').remove();
      });
      
      actualizarContadorEnlaces();
      verificarEnlacesVacios();
      guardarEnlacesEnStorage();
      actualizarBotonEliminarSeleccionados();
    }

    function seleccionarTodosEnlaces() {
      document.querySelectorAll('#tabla tbody .check-enlace').forEach(cb => cb.checked = true);
      actualizarBotonEliminarSeleccionados();
    }

    function toggleSeleccionarTodos(master) {
      document.querySelectorAll('#tabla tbody .check-enlace').forEach(cb => cb.checked = master.checked);
      actualizarBotonEliminarSeleccionados();
    }

    function guardarEnlacesEnStorageModo(modo) {
      if (modo === "mismo") {
        return;
      }
      const tabla = document.querySelector('#tabla tbody');
      const filas = tabla.querySelectorAll('tr');
      const enlaces = [];
      filas.forEach(fila => {
        const celdas = fila.querySelectorAll('td');
        const enlace = [];
        for (let i = 1; i < celdas.length; i++) {
          if (i === 33 && celdas[i].querySelector('button') && celdas[i].dataset.analisis) {
            enlace.push(celdas[i].dataset.analisis);
          } else {
            enlace.push(celdas[i].textContent);
          }
        }
        enlaces.push(enlace);
      });
      localStorage.setItem('enlacesPtP', JSON.stringify(enlaces));
    }

    function cargarEnlacesDeStorageModo(modo) {
      if (modo === "mismo") {
        mostrarTablaMismoTransporte();
        return;
      }
      const key = 'enlacesPtP';
      const enlacesGuardados = localStorage.getItem(key);
      if (!enlacesGuardados) return;
      const enlaces = JSON.parse(enlacesGuardados);
      const tbody = document.querySelector('#tabla tbody');
      tbody.innerHTML = '';
      enlaces.forEach(enlaceData => {
        const fila = document.createElement('tr');
        const tdCheck = document.createElement('td');
        const check = document.createElement('input');
        check.type = 'checkbox';
        check.className = 'check-enlace';
        check.onclick = function(e) {
          e.stopPropagation();
          actualizarBotonEliminarSeleccionados();
        };
        tdCheck.appendChild(check);
        fila.appendChild(tdCheck);
        enlaceData.forEach((val, i) => {
          const td = document.createElement('td');
          if (i === enlaceData.length - 1) {
            const btn = document.createElement('button');
            btn.className = 'btn btn-info btn-sm';
            btn.innerHTML = '<i class="fas fa-info-circle"></i> Ver Análisis';
            btn.onclick = function(e) {
              e.stopPropagation();
              try {
                const analisis = JSON.parse(val);
                mostrarAnalisisDetallado(analisis);
              } catch {
                alert('No hay análisis detallado disponible.');
              }
            };
            td.appendChild(btn);
            td.dataset.analisis = val;
          } else {
            td.textContent = val;
          }
          fila.appendChild(td);
        });
        tbody.appendChild(fila);
      });
      actualizarContadorEnlaces();
      verificarEnlacesVacios();
    }

    console.log('✅ Función mostrarPestana cargada correctamente');

    // ===== FUNCIONES PARA MEJORAR SCROLL HORIZONTAL =====
    
    // Función para inicializar el scroll horizontal mejorado
    function inicializarScrollHorizontal() {
      const tableContainer = document.querySelector('.table-container-modern');
      const scrollHint = document.querySelector('.scroll-hint');
      
      if (!tableContainer || !scrollHint) return;
      
      // Ocultar hint después de 5 segundos
      setTimeout(() => {
        scrollHint.style.opacity = '0.7';
        setTimeout(() => {
          scrollHint.style.display = 'none';
        }, 2000);
      }, 5000);
      
      // Agregar indicadores de scroll
      let isScrolling = false;
      let scrollTimeout;
      
      tableContainer.addEventListener('scroll', function() {
        if (!isScrolling) {
          isScrolling = true;
          scrollHint.style.display = 'flex';
          scrollHint.style.opacity = '1';
        }
        
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
          isScrolling = false;
          scrollHint.style.opacity = '0.7';
          setTimeout(() => {
            scrollHint.style.display = 'none';
          }, 2000);
        }, 1000);
      });
      
      // Agregar navegación con teclado
      tableContainer.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft') {
          e.preventDefault();
          tableContainer.scrollLeft -= 100;
        } else if (e.key === 'ArrowRight') {
          e.preventDefault();
          tableContainer.scrollLeft += 100;
        }
      });
      
      // Hacer el contenedor focusable para navegación con teclado
      tableContainer.setAttribute('tabindex', '0');
    }
    
    // Función para scroll automático a una columna específica
    function scrollToColumn(columnIndex) {
      const tableContainer = document.querySelector('.table-container-modern');
      const table = document.querySelector('#tabla');
      const headers = table.querySelectorAll('th');
      
      if (columnIndex >= 0 && columnIndex < headers.length) {
        const targetHeader = headers[columnIndex];
        const containerRect = tableContainer.getBoundingClientRect();
        const headerRect = targetHeader.getBoundingClientRect();
        
        const scrollLeft = targetHeader.offsetLeft - containerRect.width / 2 + headerRect.width / 2;
        tableContainer.scrollTo({
          left: scrollLeft,
          behavior: 'smooth'
        });
      }
    }
    
    // Inicializar scroll horizontal cuando se carga la página
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(inicializarScrollHorizontal, 1000);
    });
    
    // Reinicializar cuando se cambia de pestaña
    const originalMostrarPestana = window.mostrarPestana;
    window.mostrarPestana = function(pestana) {
      originalMostrarPestana(pestana);
      setTimeout(inicializarScrollHorizontal, 500);
    };
    
  </script>
</body>
</html>
           
